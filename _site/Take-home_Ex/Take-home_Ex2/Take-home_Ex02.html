<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Foo Jia Yi Samantha">
<meta name="dcterms.date" content="2024-10-13">

<title>IS415-GAA - Take-home Exercise 2 - Part 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">IS415-GAA</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In-class Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercises">    
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex1/In-class_Ex1.html">
 <span class="dropdown-text">In-class Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex2/In-class_Ex2.html">
 <span class="dropdown-text">In-class Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex3/In-class_Ex3.html">
 <span class="dropdown-text">In-class Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex4/In-class_Ex4.html">
 <span class="dropdown-text">In-class Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex5/In-class_Ex5.html">
 <span class="dropdown-text">In-class Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex6/In-class_Ex6.html">
 <span class="dropdown-text">In-class Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex7/In-class_Ex7.html">
 <span class="dropdown-text">In-class Exercise 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex9/In-class_Ex9.html">
 <span class="dropdown-text">In-class Exercise 9</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-on Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercises">    
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex1/Hands-on_Ex1.html">
 <span class="dropdown-text">Hands-on Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex2/Hands-on_Ex2.html">
 <span class="dropdown-text">Hands-on Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex3/Hands-on_Ex3.html">
 <span class="dropdown-text">Hands-on Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex5/Hands-on_Ex5.html">
 <span class="dropdown-text">Hands-on Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex6/Hands-on_Ex6.html">
 <span class="dropdown-text">Hands-on Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex7/Hands-on_Ex7.html">
 <span class="dropdown-text">Hands-on Exercise 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex8/Hands-on_Ex8.html">
 <span class="dropdown-text">Hands-on Exercise 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex9/Hands-on_Ex9.html">
 <span class="dropdown-text">Hands-on Exercise 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex10/Hands-on_Ex10.html">
 <span class="dropdown-text">Hands-on Exercise 10</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex11/Hands-on_Ex11.html">
 <span class="dropdown-text">Hands-on Exercise 11</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take-home Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercises">    
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex1/Take-home_Ex1.html">
 <span class="dropdown-text">Take-home Exercise 1 - Part 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex1/Take-home_Ex1_Part2.html">
 <span class="dropdown-text">Take-home Exercise 1 - Part 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex2/Take-home_Ex02.html">
 <span class="dropdown-text">Take-home Exercise 2 - Part 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex2/Take-home_Ex02_Part2.html">
 <span class="dropdown-text">Take-home Exercise 2 - Part 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex3/Take-home_Ex3.html">
 <span class="dropdown-text">Take-home Exercise 3</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setting-the-scene-drug-abuse-in-thailand" id="toc-setting-the-scene-drug-abuse-in-thailand" class="nav-link active" data-scroll-target="#setting-the-scene-drug-abuse-in-thailand"><strong>1. Setting the Scene: Drug Abuse in Thailand</strong></a></li>
  <li><a href="#methods-used" id="toc-methods-used" class="nav-link" data-scroll-target="#methods-used"><strong>2. Methods Used</strong></a>
  <ul>
  <li><a href="#spatial-autocorrelation" id="toc-spatial-autocorrelation" class="nav-link" data-scroll-target="#spatial-autocorrelation"><strong>2.1 Spatial Autocorrelation</strong></a></li>
  <li><a href="#cluster-and-outlier-analysis" id="toc-cluster-and-outlier-analysis" class="nav-link" data-scroll-target="#cluster-and-outlier-analysis"><strong>2.2 Cluster and Outlier Analysis</strong></a>
  <ul>
  <li><a href="#local-morans-i-and-local-gearys-c" id="toc-local-morans-i-and-local-gearys-c" class="nav-link" data-scroll-target="#local-morans-i-and-local-gearys-c"><strong>2.2.1 Local Moran’s I and Local Geary’s C</strong></a></li>
  <li><a href="#moran-scatterplot" id="toc-moran-scatterplot" class="nav-link" data-scroll-target="#moran-scatterplot"><strong>2.2.2 Moran Scatterplot</strong></a></li>
  <li><a href="#lisa-cluster-map" id="toc-lisa-cluster-map" class="nav-link" data-scroll-target="#lisa-cluster-map"><strong>2.2.3 LISA Cluster Map</strong></a></li>
  </ul></li>
  <li><a href="#emerging-hot-spot-analysis" id="toc-emerging-hot-spot-analysis" class="nav-link" data-scroll-target="#emerging-hot-spot-analysis"><strong>2.3 Emerging Hot Spot Analysis</strong></a></li>
  </ul></li>
  <li><a href="#importing-packages-into-r" id="toc-importing-packages-into-r" class="nav-link" data-scroll-target="#importing-packages-into-r"><strong>3. Importing Packages into R</strong></a></li>
  <li><a href="#importing-datasets-into-r" id="toc-importing-datasets-into-r" class="nav-link" data-scroll-target="#importing-datasets-into-r"><strong>4. Importing Datasets into R</strong></a>
  <ul>
  <li><a href="#importing-geospatial-data" id="toc-importing-geospatial-data" class="nav-link" data-scroll-target="#importing-geospatial-data"><strong>4.1 Importing Geospatial Data</strong></a></li>
  <li><a href="#importing-aspatial-data" id="toc-importing-aspatial-data" class="nav-link" data-scroll-target="#importing-aspatial-data"><strong>4.2 Importing Aspatial Data</strong></a></li>
  <li><a href="#performing-a-join-on-geometry-column" id="toc-performing-a-join-on-geometry-column" class="nav-link" data-scroll-target="#performing-a-join-on-geometry-column"><strong>4.3 Performing a Join on Geometry Column</strong></a></li>
  </ul></li>
  <li><a href="#data-wrangling" id="toc-data-wrangling" class="nav-link" data-scroll-target="#data-wrangling"><strong>5. Data Wrangling</strong></a>
  <ul>
  <li><a href="#reduce-data-size" id="toc-reduce-data-size" class="nav-link" data-scroll-target="#reduce-data-size"><strong>5.1 Reduce Data Size</strong></a></li>
  <li><a href="#fixing-missing-values" id="toc-fixing-missing-values" class="nav-link" data-scroll-target="#fixing-missing-values">5.2 Fixing Missing Values</a>
  <ul>
  <li><a href="#identify-missing-values" id="toc-identify-missing-values" class="nav-link" data-scroll-target="#identify-missing-values">5.2.1 Identify Missing Values</a></li>
  <li><a href="#fix-missing-values-discovered" id="toc-fix-missing-values-discovered" class="nav-link" data-scroll-target="#fix-missing-values-discovered">5.2.2 Fix Missing Values Discovered</a></li>
  </ul></li>
  <li><a href="#create-new-total_cases-column" id="toc-create-new-total_cases-column" class="nav-link" data-scroll-target="#create-new-total_cases-column">5.3 Create New <code>total_cases</code> Column</a></li>
  <li><a href="#create-spacetime-cubes" id="toc-create-spacetime-cubes" class="nav-link" data-scroll-target="#create-spacetime-cubes">5.4 Create Spacetime Cubes</a></li>
  </ul></li>
  <li><a href="#exploratory-geospatial-data-analysis" id="toc-exploratory-geospatial-data-analysis" class="nav-link" data-scroll-target="#exploratory-geospatial-data-analysis">6. Exploratory Geospatial Data Analysis</a>
  <ul>
  <li><a href="#overall-histogram-of-drug-cases" id="toc-overall-histogram-of-drug-cases" class="nav-link" data-scroll-target="#overall-histogram-of-drug-cases">6.1 Overall Histogram of Drug Cases</a></li>
  <li><a href="#histogram-of-drug-cases-by-year" id="toc-histogram-of-drug-cases-by-year" class="nav-link" data-scroll-target="#histogram-of-drug-cases-by-year">6.2 Histogram of Drug Cases by Year</a></li>
  <li><a href="#total-cases-by-drug-case-type" id="toc-total-cases-by-drug-case-type" class="nav-link" data-scroll-target="#total-cases-by-drug-case-type">6.3 Total Cases by Drug Case Type</a></li>
  <li><a href="#overall-plot-of-drug-cases" id="toc-overall-plot-of-drug-cases" class="nav-link" data-scroll-target="#overall-plot-of-drug-cases">6.4 Overall Plot of Drug Cases</a></li>
  <li><a href="#plot-of-drug-cases-by-year" id="toc-plot-of-drug-cases-by-year" class="nav-link" data-scroll-target="#plot-of-drug-cases-by-year">6.5 Plot of Drug Cases by Year</a></li>
  </ul></li>
  <li><a href="#global-measures-of-spatial-autocorrelation" id="toc-global-measures-of-spatial-autocorrelation" class="nav-link" data-scroll-target="#global-measures-of-spatial-autocorrelation">7. Global Measures of Spatial Autocorrelation</a>
  <ul>
  <li><a href="#methods-used-1" id="toc-methods-used-1" class="nav-link" data-scroll-target="#methods-used-1">7.1 Methods Used</a></li>
  <li><a href="#computing-contiguity-neighbours" id="toc-computing-contiguity-neighbours" class="nav-link" data-scroll-target="#computing-contiguity-neighbours">7.2 Computing Contiguity Neighbours</a></li>
  <li><a href="#computing-row-standardised-weight-matrix" id="toc-computing-row-standardised-weight-matrix" class="nav-link" data-scroll-target="#computing-row-standardised-weight-matrix">7.3 <strong>Computing Row-Standardised Weight Matrix</strong></a></li>
  <li><a href="#visualising-contiguity-weights" id="toc-visualising-contiguity-weights" class="nav-link" data-scroll-target="#visualising-contiguity-weights">7.4 Visualising Contiguity Weights</a></li>
  <li><a href="#global-morans-i" id="toc-global-morans-i" class="nav-link" data-scroll-target="#global-morans-i">7.5 Global <em>Moran’s I</em></a>
  <ul>
  <li><a href="#computing-global-morans-i" id="toc-computing-global-morans-i" class="nav-link" data-scroll-target="#computing-global-morans-i">7.5.1 Computing Global <em>Moran’s I</em></a></li>
  <li><a href="#global-morans-i-test" id="toc-global-morans-i-test" class="nav-link" data-scroll-target="#global-morans-i-test">7.5.2 Global <em>Moran’s I</em> Test</a></li>
  <li><a href="#performing-global-morans-i-permutation-test" id="toc-performing-global-morans-i-permutation-test" class="nav-link" data-scroll-target="#performing-global-morans-i-permutation-test"><strong>7.5.3 Performing Global <em>Moran’s I</em></strong> Permutation Test</a></li>
  </ul></li>
  <li><a href="#global-gearys-c-test" id="toc-global-gearys-c-test" class="nav-link" data-scroll-target="#global-gearys-c-test">7.6 Global Geary’s C Test</a>
  <ul>
  <li><a href="#computing-global-gearys-c" id="toc-computing-global-gearys-c" class="nav-link" data-scroll-target="#computing-global-gearys-c">7.6.1 Computing Global <em>Geary’s C</em></a></li>
  <li><a href="#global-geary-cs-test" id="toc-global-geary-cs-test" class="nav-link" data-scroll-target="#global-geary-cs-test">7.5.2 Global <em>Geary C’s</em> Test</a></li>
  <li><a href="#performing-global-gearys-c-permutation-test" id="toc-performing-global-gearys-c-permutation-test" class="nav-link" data-scroll-target="#performing-global-gearys-c-permutation-test"><strong>7.5.3 Performing Global <em>Geary’s C</em></strong> Permutation Test</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#local-indicators-of-spatial-association-lisa" id="toc-local-indicators-of-spatial-association-lisa" class="nav-link" data-scroll-target="#local-indicators-of-spatial-association-lisa">8. Local Indicators of Spatial Association (LISA)</a>
  <ul>
  <li><a href="#local-morans-ii" id="toc-local-morans-ii" class="nav-link" data-scroll-target="#local-morans-ii">8.1 Local <em>Moran’s I<sub>i</sub></em></a>
  <ul>
  <li><a href="#computing-local-morans-ii" id="toc-computing-local-morans-ii" class="nav-link" data-scroll-target="#computing-local-morans-ii">8.1.1 Computing Local <em>Moran’s I<sub>i</sub></em></a></li>
  <li><a href="#visualising-local-morans-ii" id="toc-visualising-local-morans-ii" class="nav-link" data-scroll-target="#visualising-local-morans-ii">8.1.2 Visualising Local <em>Moran’s I<sub>i</sub></em></a></li>
  <li><a href="#visualising-local-morans-ii-p-value" id="toc-visualising-local-morans-ii-p-value" class="nav-link" data-scroll-target="#visualising-local-morans-ii-p-value">8.1.3 Visualising Local <em>Moran’s I<sub>i</sub></em> P-value</a></li>
  <li><a href="#visualising-statistically-significant-local-morans-ii" id="toc-visualising-statistically-significant-local-morans-ii" class="nav-link" data-scroll-target="#visualising-statistically-significant-local-morans-ii">8.1.4 Visualising Statistically Significant Local <em>Moran’s I<sub>i</sub></em></a></li>
  <li><a href="#visualising-statistically-significant-local-morans-ii-by-drug-case" id="toc-visualising-statistically-significant-local-morans-ii-by-drug-case" class="nav-link" data-scroll-target="#visualising-statistically-significant-local-morans-ii-by-drug-case">8.1.5 Visualising Statistically Significant Local <em>Moran’s I<sub>i</sub></em> (By Drug Case)</a>
  <ul class="collapse">
  <li><a href="#case-type-drug-use" id="toc-case-type-drug-use" class="nav-link" data-scroll-target="#case-type-drug-use"><strong>1) Case Type: Drug Use</strong></a></li>
  <li><a href="#case-type-possession" id="toc-case-type-possession" class="nav-link" data-scroll-target="#case-type-possession"><strong>2) Case Type: Possession</strong></a></li>
  <li><a href="#case-type-trafficking" id="toc-case-type-trafficking" class="nav-link" data-scroll-target="#case-type-trafficking"><strong>3) Case Type: Trafficking</strong></a></li>
  <li><a href="#case-type-import-and-export" id="toc-case-type-import-and-export" class="nav-link" data-scroll-target="#case-type-import-and-export"><strong>4) Case Type: Import and Export</strong></a></li>
  <li><a href="#case-type-conspiracy" id="toc-case-type-conspiracy" class="nav-link" data-scroll-target="#case-type-conspiracy"><strong>5) Case Type: Conspiracy</strong></a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take-home Exercise 2 - Part 1</h1>
<p class="subtitle lead">Harnessing Geospatial Methods to Analyse Drug Abuse Patterns in Thailand</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Foo Jia Yi Samantha </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 13, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">October 13, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="setting-the-scene-drug-abuse-in-thailand" class="level2">
<h2 class="anchored" data-anchor-id="setting-the-scene-drug-abuse-in-thailand"><strong>1. Setting the Scene: Drug Abuse in Thailand</strong></h2>
<p>In 2022, <strong>567,609 drug users in ASEAN</strong> were treated, in which Thailand was found to have the <strong>highest number of drug users requiring treatment</strong> among ASEAN countries, followed by Malaysia, Indonesia, Laos, the Philippines, and Singapore. (Kahanto M., et al, 2022) Drug abuse is a significant social issue in Thailand, with profound health, financial, and societal implications. Positioned near the Golden Triangle—one of the largest drug production areas in Asia—Thailand faces ongoing challenges due to its geographical proximity and extensive transportation routes, which facilitate drug trafficking. Within Thailand, drug abuse is particularly <strong>prevalent among the youth</strong>, with approximately <strong>2.7 million young people involved</strong>. Of those aged 15–19, around <strong>300,000 are in need of drug treatment</strong>, and vocational students are disproportionately affected compared to their peers in secondary school.</p>
<p>This underscores the importance of drug treatment in addressing the complex problem of substance abuse and reduces the societal costs associated with drug abuse, such as healthcare expenses, lost productivity, and crime. Hence, to better allocate resources and develop targeted interventions, it is <strong>crucial to understand where drug abuse is most concentrated and how it spreads geographically.</strong> This is where geospatial analysis becomes essential.&nbsp;</p>
<p>In this exercise, I will utilise geospatial analysis methods to explore the province-level dynamics of drug abuse in Thailand. This will involve preparing a study area layer as <code>sf</code> polygon features at the province level, including Bangkok, and creating a drug abuse indicators layer within this study area. Using these extracted data layers, I will conduct <strong>global spatial autocorrelation analysis</strong> using <code>sfdep</code> methods, followed by <strong>local spatial autocorrelation analysis.</strong> Finally, I will describe the spatial patterns revealed by determining whether key indicators are spatially dependent, and identifying trends of clusters, outliers and hotspots over time.</p>
<blockquote class="blockquote">
<p><strong>This take-home exercise consists of two parts:</strong></p>
<ol type="1">
<li><a href="https://is415-samanthafoo.netlify.app/take-home_ex/take-home_ex2/take-home_ex02">Take-home Ex 2 - Part 1</a></li>
<li><a href="https://is415-samanthafoo.netlify.app/take-home_ex/take-home_ex2/take-home_ex02_part2">Take-home Ex 2 - Part 2</a></li>
</ol>
</blockquote>
</section>
<section id="methods-used" class="level2">
<h2 class="anchored" data-anchor-id="methods-used"><strong>2. Methods Used</strong></h2>
<section id="spatial-autocorrelation" class="level3">
<h3 class="anchored" data-anchor-id="spatial-autocorrelation"><strong>2.1 Spatial Autocorrelation</strong></h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clipboard-2006676839.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="524"></p>
</figure>
</div>
<p>This quote from Tobler (1970) highlights the essence of spatial autocorrelation, emphasising the importance of studying how values of the same variable are interconnected across space. By examining spatial dependence, we can better understand local and global patterns and variations. This law suggests that phenomena that are geographically close to each other are more likely to be similar or have some kind of spatial relationship compared to phenomena that are farther apart.&nbsp;</p>
<p>It is also important to note that spatial structure and spatial autocorrelation are inherently interconnected (Tiefelsdorf, 1998):</p>
<ul>
<li><p><strong>Spatial structure</strong> encompasses all the connections through which the autocorrelated phenomenon spreads.</p></li>
<li><p>Without a significant autocorrelated process, spatial structure <strong>cannot be empirically observed.</strong></p></li>
</ul>
<p>Thus, the observed spatial distribution is regarded as a reflection of the underlying spatial process. When spatial autocorrelation is present, the value of a variable at a given observation is connected to the values of that same variable at neighbouring observations:</p>
<p>Configuration of areas showing different types of autocorrelation (Nguyen K. et al., 2022)</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clipboard-3880014486.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="544"></p>
</figure>
</div>
<ul>
<li><p><strong>Positive Spatial Autocorrelation</strong> occurs when similar values of the variable cluster geographically.</p></li>
<li><p><strong>Negative Spatial Autocorrelation</strong> arises when dissimilar values are geographically close, indicating that nearby locations tend to differ more than those that are farther apart. This situation often reflects spatial competition.</p></li>
<li><p>In the <strong>absence of spatial autocorrelation</strong>, the distribution of observations can be considered random.</p></li>
</ul>
</section>
<section id="cluster-and-outlier-analysis" class="level3">
<h3 class="anchored" data-anchor-id="cluster-and-outlier-analysis"><strong>2.2 Cluster and Outlier Analysis</strong></h3>
<p>Cluster and Outlier Analysis can be effectively applied using Local Moran’s I, Local Geary’s C, Moran scatterplots, and LISA Cluster Maps to identify and understand spatial patterns in data. Here’s how each of these methods can be utilised</p>
<section id="local-morans-i-and-local-gearys-c" class="level4">
<h4 class="anchored" data-anchor-id="local-morans-i-and-local-gearys-c"><strong>2.2.1 Local Moran’s I and Local Geary’s C</strong></h4>
<ul>
<li><p><strong>Local Moran’s I</strong>: This statistic assesses local spatial autocorrelation by measuring the degree of similarity of a location’s value to those of its neighbours. It identifies clusters of high or low values (hotspots and cold spots) and outliers (areas where a value is significantly different from its neighbours). By calculating Local Moran’s I for each location, we can highlight areas with significant spatial dependence, helping to identify regions where interventions may be needed.</p></li>
<li><p><strong>Local Geary’s C</strong>: Similar to Local Moran’s I, Local Geary’s C focuses on differences rather than similarities. It quantifies the spatial variation between nearby locations, emphasising dissimilarity. This method can help detect spatial competition, where nearby areas have contrasting values. By using Local Geary’s C, we can uncover regions that may experience conflicting trends or behaviours, providing insights into localised dynamics.</p></li>
</ul>
</section>
<section id="moran-scatterplot" class="level4">
<h4 class="anchored" data-anchor-id="moran-scatterplot"><strong>2.2.2 Moran Scatterplot</strong></h4>
<ul>
<li><p>The <strong>Moran scatterplot</strong> visualises the relationship between the value of a variable at a location and the average value of its neighbours. We can plot scatterplot to represent a location, with the x-axis showing the local mean of neighbouring values and the y-axis showing the local value.&nbsp;</p></li>
<li><p>Plots like this can help us in identifying clusters (high-high or low-low) and outliers (high-low or low-high). The scatterplot can reveal spatial patterns that are not immediately obvious.</p></li>
</ul>
</section>
<section id="lisa-cluster-map" class="level4">
<h4 class="anchored" data-anchor-id="lisa-cluster-map"><strong>2.2.3 LISA Cluster Map</strong></h4>
<ul>
<li><p>A <strong>LISA Cluster Map</strong> visually represents the results of Local Indicators of Spatial Association, indicating the spatial clusters of similar values (hotspots) and outliers.&nbsp;</p></li>
<li><p>I will use these maps to quickly identify regions of interest such that areas identified as <strong>hotspots will be marked in red</strong> to signify high values surrounded by high values, while <strong>cold spots will be marked in blue</strong> for low values surrounded by low values. Outliers will be highlighted in contrasting colours.</p></li>
</ul>
</section>
</section>
<section id="emerging-hot-spot-analysis" class="level3">
<h3 class="anchored" data-anchor-id="emerging-hot-spot-analysis"><strong>2.3 Emerging Hot Spot Analysis</strong></h3>
<p>There are different methods for analysing spatial patterns and detecting hotspots including spatial autocorrelation and cluster analysis. <strong>Emerging Hot Spot Analysis (EHSA)</strong> is a specific spatio-temporal method used to examine hotspots over a designated <strong>observation period</strong>. It integrates two well-known techniques: the traditional <strong>Getis-Ord Gi* statistic</strong> for hotspot detection and the <strong>Mann-Kendall test</strong> for assessing monotonic trends over time. The main goal of EHSA is to analyse how hot and cold spots change over time, focusing on whether these areas are increasing in intensity, decreasing, or remaining constant.</p>
</section>
</section>
<section id="importing-packages-into-r" class="level2">
<h2 class="anchored" data-anchor-id="importing-packages-into-r"><strong>3. Importing Packages into R</strong></h2>
<p>Let’s load all the required packages for conducting our analysis.</p>
<ul>
<li><a href="https://rdrr.io/github/r-spatial/sf/man/sf-package.html"><code>sf</code></a> : provides a standardised way to encode spatial vector data in R environment, facilitating spatial data operations and analysis.</li>
<li><a href="https://rdrr.io/cran/sf/man/st.html"><code>st</code></a> : create simple features from numeric vectors, matrices, or lists, enabling the representation and manipulation of spatial structures in R.</li>
<li><a href="https://www.tidyverse.org/"><code>tidyverse</code></a> : a collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structure.</li>
<li><a href="https://cran.r-project.org/web/packages/spdep/"><code>sfdep</code></a> : for computing spatial weights, global and local spatial autocorrelation statistics. Offers a more streamlined approach with <strong>sf</strong> objects.</li>
<li><a href="https://cran.r-project.org/web/packages/tmap/"><code>tmap</code></a> : for creating static and interactive visualisations and maps.</li>
<li><a href="https://cran.r-project.org/web/packages/ggplot2/"><code>ggplot2</code></a> : for creating advanced visualisations, graphics and maps using the Grammar of Graphics.</li>
<li><a href="https://cran.r-project.org/web/packages/spdep/"><code>knitr</code></a> : for dynamic report generation in R using Literate Programming techniques.</li>
<li><a href="https://cran.r-project.org/web/packages/Kendall/"><code>Kendall</code></a> : for computing the Kendall rank correlation and Mann-Kendall trend test</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, st, tidyverse, lubridate, sfdep, tmap, ggplot2, knitr, Kendall)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="importing-datasets-into-r" class="level2">
<h2 class="anchored" data-anchor-id="importing-datasets-into-r"><strong>4. Importing Datasets into R</strong></h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clipboard-3730540943.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="531"></p>
</figure>
</div>
<p>We will be leveraging two datasets in this exercise. The first dataset to be used is Thailand’s provincial boundary is <code>tha_admbnda_adm1_rtsd_20220121</code> which exists in <strong>ESRI .shp</strong> <strong>format</strong> and is based on the Thailand geographic coordinate system. This dataset is extracted from <a href="https://data.humdata.org/dataset/cod-ab-tha?">Thailand - Subnational Administrative Boundaries</a> via the HDX portal.</p>
<p>The second dataset <code>thai_drug_offenses_2017_2022</code> consists of aspatial data in a <strong>CSV format</strong> that contains reported cases of drug offences in Thailand from 2017 to 2022. The dataset is extracted from <a href="https://www.kaggle.com/datasets/thaweewatboy/thailand-drug-offenses-2017-2022">Thailand Drug Offenses [2017-2022]</a> in Kaggle.</p>
<section id="importing-geospatial-data" class="level3">
<h3 class="anchored" data-anchor-id="importing-geospatial-data"><strong>4.1 Importing Geospatial Data</strong></h3>
<p>In this section, <code>st_read()</code> of sf package will be used to import <code>tha_admbnda_adm1_rtsd_20220121</code> dataset into the R environment. The <strong><code>st_transform()</code></strong> function below converts the CRS of the <strong><code>sf</code></strong> object to EPSG:32647 which maps to Thailand’s UTM zone, particularly for Western/Central parts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>thai_boundary <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial"</span>,<span class="at">layer =</span> <span class="st">"tha_admbnda_adm1_rtsd_20220121"</span>) <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">32647</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `tha_admbnda_adm1_rtsd_20220121' from data source 
  `C:\SamanthaxFoo\IS415-GAA\Take-home_Ex\Take-home_Ex2\data\geospatial' 
  using driver `ESRI Shapefile'
Simple feature collection with 77 features and 16 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(thai_boundary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 77
Columns: 17
$ Shape_Leng &lt;dbl&gt; 2.417227, 1.695100, 1.251111, 1.884945, 3.041716, 1.739908,…
$ Shape_Area &lt;dbl&gt; 0.13133873, 0.07926199, 0.05323766, 0.12698345, 0.21393797,…
$ ADM1_EN    &lt;chr&gt; "Bangkok", "Samut Prakan", "Nonthaburi", "Pathum Thani", "P…
$ ADM1_TH    &lt;chr&gt; "กรุงเทพมหานคร", "สมุทรปราการ", "นนทบุรี", "ปทุมธานี", "พระนครศรีอ…
$ ADM1_PCODE &lt;chr&gt; "TH10", "TH11", "TH12", "TH13", "TH14", "TH15", "TH16", "TH…
$ ADM1_REF   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ ADM1ALT1EN &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ ADM1ALT2EN &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ ADM1ALT1TH &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ ADM1ALT2TH &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ ADM0_EN    &lt;chr&gt; "Thailand", "Thailand", "Thailand", "Thailand", "Thailand",…
$ ADM0_TH    &lt;chr&gt; "ประเทศไทย", "ประเทศไทย", "ประเทศไทย", "ประเทศไทย", "ประเทศ…
$ ADM0_PCODE &lt;chr&gt; "TH", "TH", "TH", "TH", "TH", "TH", "TH", "TH", "TH", "TH",…
$ date       &lt;date&gt; 2019-02-18, 2019-02-18, 2019-02-18, 2019-02-18, 2019-02-18…
$ validOn    &lt;date&gt; 2022-01-22, 2022-01-22, 2022-01-22, 2022-01-22, 2022-01-22…
$ validTo    &lt;date&gt; -001-11-30, -001-11-30, -001-11-30, -001-11-30, -001-11-30…
$ geometry   &lt;MULTIPOLYGON [m]&gt; MULTIPOLYGON (((674339.8 15..., MULTIPOLYGON (…</code></pre>
</div>
</div>
<p>Let’s verify the coordinate reference systems of the <code>thai_boundary</code> object to ensure the assignment of the correct CRS value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(thai_boundary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:32647 
  wkt:
PROJCRS["WGS 84 / UTM zone 47N",
    BASEGEOGCRS["WGS 84",
        ENSEMBLE["World Geodetic System 1984 ensemble",
            MEMBER["World Geodetic System 1984 (Transit)"],
            MEMBER["World Geodetic System 1984 (G730)"],
            MEMBER["World Geodetic System 1984 (G873)"],
            MEMBER["World Geodetic System 1984 (G1150)"],
            MEMBER["World Geodetic System 1984 (G1674)"],
            MEMBER["World Geodetic System 1984 (G1762)"],
            MEMBER["World Geodetic System 1984 (G2139)"],
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]],
            ENSEMBLEACCURACY[2.0]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4326]],
    CONVERSION["UTM zone 47N",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",0,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",99,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",500000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["Navigation and medium accuracy spatial referencing."],
        AREA["Between 96°E and 102°E, northern hemisphere between equator and 84°N, onshore and offshore. China. Indonesia. Laos. Malaysia - West Malaysia. Mongolia. Myanmar (Burma). Russian Federation. Thailand."],
        BBOX[0,96,84,102]],
    ID["EPSG",32647]]</code></pre>
</div>
</div>
<p>Before we delve into further data analysis, it is crucial that we first understand the levels of administration that makes up Thailand today. In particular, Thailand has 4 levels of administration, i.e.&nbsp;<strong>level 0 (country), 1 (province), 2 (district),</strong> and <strong>3 (sub-district) boundaries.</strong> Thailand comprises 76 provinces (known as จังหวัด in Thai or changwat in English), along with one special administrative area, Bangkok, the capital.&nbsp;</p>
<ul>
<li>These provinces function as the main local government units and possess legal personhood.&nbsp;</li>
<li>Each province is subdivided into amphoe (districts), which are further broken down into tambon (sub-districts), representing the next tier of local governance.&nbsp;</li>
<li><strong>For this analysis, I will only focus on the province administration level.</strong></li>
</ul>
<p>We can visualise the structure of our geospatial object as such.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)  </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the provinces of Thailand with labels </span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(thai_boundary) <span class="sc">+</span>   </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="fl">0.3</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span>    </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>()<span class="sc">+</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Provinces of Thailand"</span>,<span class="at">main.title.size =</span> <span class="dv">1</span>,    </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>, <span class="at">legend.show =</span> <span class="cn">FALSE</span>, </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">FALSE</span>   ) <span class="sc">+</span>   </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"ADM1_EN"</span>, <span class="at">size =</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/clipboard-2171615491.png" class="img-fluid"></p>
</section>
<section id="importing-aspatial-data" class="level3">
<h3 class="anchored" data-anchor-id="importing-aspatial-data"><strong>4.2 Importing Aspatial Data</strong></h3>
<p>In this section, <code>read_csv()</code> of <strong>sf</strong> package will be used to import the csv file into the R environment. The output is a R dataframe class containing 5 unique columns of drug offences in Thailand from 2017 - 2022.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>drug_cases <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/thai_drug_offenses_2017_2022.csv"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 7392 Columns: 5
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (3): types_of_drug_offenses, province_th, province_en
dbl (2): fiscal_year, no_cases

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(drug_cases)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  fiscal_year types_of_drug_offenses no_cases province_th   province_en         
        &lt;dbl&gt; &lt;chr&gt;                     &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;               
1        2017 drug_use_cases            11871 กรุงเทพมหานคร  Bangkok             
2        2017 drug_use_cases              200 ชัยนาท         Chai Nat            
3        2017 drug_use_cases              553 นนทบุรี         Nonthaburi          
4        2017 drug_use_cases              450 ปทุมธานี        Pathum Thani        
5        2017 drug_use_cases              378 พระนครศรีอยุธยา Phra Nakhon Si Ayut…
6        2017 drug_use_cases              727 ลพบุรี          Loburi              </code></pre>
</div>
</div>
<table class="caption-top table">
<colgroup>
<col style="width: 24%">
<col style="width: 24%">
<col style="width: 50%">
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Column Name</strong></td>
<td><strong>Data Type</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="even">
<td>fiscal_year</td>
<td><em>&lt;dbl&gt;</em></td>
<td>The fiscal year during which the drug offenses were recorded.</td>
</tr>
<tr class="odd">
<td>types_of_drug_offenses</td>
<td><em>&lt;chr&gt;</em></td>
<td>The specific type or category of drug offence being reported.</td>
</tr>
<tr class="even">
<td>no_cases</td>
<td><em>&lt;dbl&gt;</em></td>
<td>The total number of cases recorded for the specific combination of fiscal year</td>
</tr>
<tr class="odd">
<td>province_th</td>
<td><em>&lt;chr&gt;</em></td>
<td>The name of the province in Thailand, written in Thai.</td>
</tr>
<tr class="even">
<td>province_en</td>
<td><em>&lt;chr&gt;</em></td>
<td>The name of the province in Thailand, written in English.</td>
</tr>
</tbody>
</table>
</section>
<section id="performing-a-join-on-geometry-column" class="level3">
<h3 class="anchored" data-anchor-id="performing-a-join-on-geometry-column"><strong>4.3 Performing a Join on Geometry Column</strong></h3>
<p>Next, we will want to aggregate the total number of drug use cases according to each 77 provinces in Thailand. Here, I use <code>left_join()</code> to associate each drug use case to its respective province (i.e.&nbsp;the geometry of the drug case).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Count rows before the join</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>initial_row_count <span class="ot">&lt;-</span> <span class="fu">nrow</span>(drug_cases)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Perform the join and convert to sf</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>drug_cases <span class="ot">&lt;-</span> drug_cases <span class="sc">%&gt;%</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(thai_boundary <span class="sc">%&gt;%</span> <span class="fu">select</span>(geometry, ADM1_EN, ADM1_PCODE), </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"province_en"</span> <span class="ot">=</span> <span class="st">"ADM1_EN"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Count rows after the join</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>final_row_count <span class="ot">&lt;-</span> <span class="fu">nrow</span>(drug_cases)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Check if rows were dropped</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (initial_row_count <span class="sc">!=</span> final_row_count) {</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Rows were dropped during the join.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Rows before join:"</span>, initial_row_count, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Rows after join:"</span>, final_row_count, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"No rows were dropped during the join.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>No rows were dropped during the join.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(drug_cases)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 7,392
Columns: 7
$ fiscal_year            &lt;dbl&gt; 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017,…
$ types_of_drug_offenses &lt;chr&gt; "drug_use_cases", "drug_use_cases", "drug_use_c…
$ no_cases               &lt;dbl&gt; 11871, 200, 553, 450, 378, 727, 820, 69, 127, 2…
$ province_th            &lt;chr&gt; "กรุงเทพมหานคร", "ชัยนาท", "นนทบุรี", "ปทุมธานี", "พร…
$ province_en            &lt;chr&gt; "Bangkok", "Chai Nat", "Nonthaburi", "Pathum Th…
$ ADM1_PCODE             &lt;chr&gt; "TH10", "TH18", "TH12", "TH13", "TH14", NA, "TH…
$ geometry               &lt;MULTIPOLYGON [m]&gt; MULTIPOLYGON (((674339.8 15..., MU…</code></pre>
</div>
</div>
</section>
</section>
<section id="data-wrangling" class="level2">
<h2 class="anchored" data-anchor-id="data-wrangling"><strong>5. Data Wrangling</strong></h2>
<section id="reduce-data-size" class="level3">
<h3 class="anchored" data-anchor-id="reduce-data-size"><strong>5.1 Reduce Data Size</strong></h3>
<p>To reduce the memory load, we can drop the province names in Thai from our aspatial dataset as it is not relevant for this study.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>drug_cases <span class="ot">&lt;-</span> <span class="fu">subset</span>(drug_cases, <span class="at">select =</span> <span class="fu">c</span>(<span class="sc">-</span>province_th)) </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(drug_cases)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 5 fields (with 1 geometry empty)
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 577383.3 ymin: 1492136 xmax: 710569.3 ymax: 1704842
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 6 × 6
  fiscal_year types_of_drug_offenses no_cases province_en             ADM1_PCODE
        &lt;dbl&gt; &lt;chr&gt;                     &lt;dbl&gt; &lt;chr&gt;                   &lt;chr&gt;     
1        2017 drug_use_cases            11871 Bangkok                 TH10      
2        2017 drug_use_cases              200 Chai Nat                TH18      
3        2017 drug_use_cases              553 Nonthaburi              TH12      
4        2017 drug_use_cases              450 Pathum Thani            TH13      
5        2017 drug_use_cases              378 Phra Nakhon Si Ayuttha… TH14      
6        2017 drug_use_cases              727 Loburi                  &lt;NA&gt;      
# ℹ 1 more variable: geometry &lt;MULTIPOLYGON [m]&gt;</code></pre>
</div>
</div>
<p>We’ll also only retain columns that are most useful from <code>thai_boundary</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>thai_boundary <span class="ot">&lt;-</span> <span class="fu">subset</span>(thai_boundary, <span class="at">select =</span> <span class="fu">c</span>(Shape_Leng, Shape_Area, ADM1_EN, ADM1_PCODE, geometry)) </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(thai_boundary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 4 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 628303 ymin: 1490796 xmax: 712440.5 ymax: 1636901
Projected CRS: WGS 84 / UTM zone 47N
  Shape_Leng Shape_Area                  ADM1_EN ADM1_PCODE
1   2.417227 0.13133873                  Bangkok       TH10
2   1.695100 0.07926199             Samut Prakan       TH11
3   1.251111 0.05323766               Nonthaburi       TH12
4   1.884945 0.12698345             Pathum Thani       TH13
5   3.041716 0.21393797 Phra Nakhon Si Ayutthaya       TH14
6   1.739908 0.07920961                Ang Thong       TH15
                        geometry
1 MULTIPOLYGON (((674339.8 15...
2 MULTIPOLYGON (((687139.8 15...
3 MULTIPOLYGON (((644817.9 15...
4 MULTIPOLYGON (((704086 1575...
5 MULTIPOLYGON (((662941.6 16...
6 MULTIPOLYGON (((643472.8 16...</code></pre>
</div>
</div>
</section>
<section id="fixing-missing-values" class="level3">
<h3 class="anchored" data-anchor-id="fixing-missing-values">5.2 Fixing Missing Values</h3>
<p>There are no troublesome rows in the <code>drug_cases</code> dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(thai_boundary))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(drug_cases))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<section id="identify-missing-values" class="level4">
<h4 class="anchored" data-anchor-id="identify-missing-values">5.2.1 Identify Missing Values</h4>
<p>We can observe <strong><em>192</em></strong> reported offences that do not include the <strong>ADM1_PCODE</strong> as seen from how some rows contain empty values ‘NA’. We are also getting the <strong>192 empty</strong> <code>geometry</code> values as returned from the null test below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>drug_cases <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(ADM1_PCODE)) <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(province_en, ADM1_PCODE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 192 features and 2 fields (with 192 geometries empty)
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: NA ymin: NA xmax: NA ymax: NA
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 192 × 3
   province_en ADM1_PCODE           geometry
   &lt;chr&gt;       &lt;chr&gt;      &lt;MULTIPOLYGON [m]&gt;
 1 Loburi      &lt;NA&gt;                    EMPTY
 2 buogkan     &lt;NA&gt;                    EMPTY
 3 Loburi      &lt;NA&gt;                    EMPTY
 4 buogkan     &lt;NA&gt;                    EMPTY
 5 Loburi      &lt;NA&gt;                    EMPTY
 6 buogkan     &lt;NA&gt;                    EMPTY
 7 Loburi      &lt;NA&gt;                    EMPTY
 8 buogkan     &lt;NA&gt;                    EMPTY
 9 Loburi      &lt;NA&gt;                    EMPTY
10 buogkan     &lt;NA&gt;                    EMPTY
# ℹ 182 more rows</code></pre>
</div>
</div>
<p>The root cause of this problem lies in how these two province names were incorrectly spelled in the <strong>province_en</strong> column of <code>drug_casses</code> , causing an incomplete <code>left_join()</code> to be executed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(drug_cases[<span class="sc">!</span><span class="fu">complete.cases</span>(<span class="fu">st_drop_geometry</span>(drug_cases)), ][<span class="fu">c</span>(<span class="st">'province_en'</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 2 features and 1 field (with 2 geometries empty)
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: NA ymin: NA xmax: NA ymax: NA
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 2 × 2
  province_en           geometry
  &lt;chr&gt;       &lt;MULTIPOLYGON [m]&gt;
1 Loburi                   EMPTY
2 buogkan                  EMPTY</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>thai_boundary <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ADM1_EN <span class="sc">==</span> <span class="st">"Lop Buri"</span> <span class="sc">|</span> ADM1_EN <span class="sc">==</span> <span class="st">"Bueng Kan"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ADM1_PCODE, ADM1_EN) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  ADM1_PCODE ADM1_EN                                                    geometry
  &lt;chr&gt;      &lt;chr&gt;                                            &lt;MULTIPOLYGON [m]&gt;
1 TH16       Lop Buri  (((751293.3 1742960, 751337.4 1742928, 751437.2 1742942,…
2 TH38       Bueng Kan (((965496 2045531, 965625.5 2045528, 965836.6 2045537, 9…</code></pre>
</div>
</div>
</section>
<section id="fix-missing-values-discovered" class="level4">
<h4 class="anchored" data-anchor-id="fix-missing-values-discovered">5.2.2 Fix Missing Values Discovered</h4>
<p>Let’s fix these NA values by transforming the two province names to their correct names.</p>
<ul>
<li><strong>Step 1</strong>: Replace Loburi –&gt; Lop Buri, buogkan –&gt; Bueng Kan</li>
<li><strong>Step 2:</strong> Replace ‘NA’ <code>ADM1_PCDOE</code> with the correct province code - TH16 and TH38 for Lop Buri and Bueng Kan respectively</li>
<li><strong>Step 3:</strong> Replace the existing geometry column in <code>drug_cases</code> with the right geometry</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the geometry for Lop Buri</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>lop_buri_geometry <span class="ot">&lt;-</span> drug_cases <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(province_en <span class="sc">==</span> <span class="st">"Lop Buri"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">first_geometry =</span> <span class="fu">st_union</span>(geometry)) <span class="sc">%&gt;%</span>  </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(first_geometry)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the geometry for Bueng Kan</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>bueng_kan_geometry <span class="ot">&lt;-</span> drug_cases <span class="sc">%&gt;%</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(province_en <span class="sc">==</span> <span class="st">"Bueng Kan"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">first_geometry =</span> <span class="fu">st_union</span>(geometry)) <span class="sc">%&gt;%</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(first_geometry)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix incorrect province names</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>drug_cases <span class="ot">&lt;-</span> drug_cases <span class="sc">%&gt;%</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">province_en =</span> <span class="fu">case_when</span>(</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>      province_en <span class="sc">==</span> <span class="st">"Loburi"</span> <span class="sc">~</span> <span class="st">"Lop Buri"</span>,</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>      province_en <span class="sc">==</span> <span class="st">"buogkan"</span> <span class="sc">~</span> <span class="st">"Bueng Kan"</span>,</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> province_en  </span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix empty province code</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>drug_cases <span class="ot">&lt;-</span> drug_cases <span class="sc">%&gt;%</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ADM1_PCODE =</span> <span class="fu">ifelse</span>(province_en <span class="sc">==</span> <span class="st">"Lop Buri"</span> <span class="sc">&amp;</span> </span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">is.na</span>(ADM1_PCODE),<span class="st">"TH16"</span>, </span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">ifelse</span>(province_en <span class="sc">==</span> <span class="st">"Bueng Kan"</span> <span class="sc">&amp;</span> </span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">is.na</span>(ADM1_PCODE),<span class="st">"TH38"</span>, ADM1_PCODE)))</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix empty geometry</span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>thai_boundary_no_geom <span class="ot">&lt;-</span> thai_boundary <span class="sc">%&gt;%</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ADM1_EN, geometry)</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>drug_cases <span class="ot">&lt;-</span> drug_cases <span class="sc">%&gt;%</span></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(thai_boundary_no_geom, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"province_en"</span> <span class="ot">=</span> <span class="st">"ADM1_EN"</span>)) </span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>drug_cases <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(drug_cases)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We have successfully removed all NA values found in <code>drug_cases</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(drug_cases))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
</section>
</section>
<section id="create-new-total_cases-column" class="level3">
<h3 class="anchored" data-anchor-id="create-new-total_cases-column">5.3 Create New <code>total_cases</code> Column</h3>
<p>Next, I create a new dataframe <code>drug_cases_province</code> to count the total number of cases per province.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>drug_cases_province <span class="ot">&lt;-</span> drug_cases <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province_en) <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_cases =</span> <span class="fu">sum</span>(no_cases), </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">ADM1_PCODE =</span> <span class="fu">first</span>(ADM1_PCODE),              </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">geometry =</span> <span class="fu">first</span>(geometry),</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>                           </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(drug_cases_province)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 77 features and 3 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 325178.8 ymin: 620860.6 xmax: 1213656 ymax: 2263241
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 77 × 4
   province_en   total_cases ADM1_PCODE                                 geometry
   &lt;chr&gt;               &lt;dbl&gt; &lt;chr&gt;                            &lt;MULTIPOLYGON [m]&gt;
 1 Amnat Charoen       35435 TH37       (((1137720 1809629, 1137724 1809622, 11…
 2 Ang Thong           16168 TH15       (((643472.8 1636469, 643496 1636423, 64…
 3 Bangkok            286480 TH10       (((674339.8 1543300, 674382.3 1543278, …
 4 Bueng Kan           35287 TH38       (((965496 2045531, 965625.5 2045528, 96…
 5 Buri Ram            57352 TH31       (((921217 1750212, 921217 1750211, 9212…
 6 Chachoengsao        53514 TH24       (((722656.1 1546054, 722796 1546041, 72…
 7 Chai Nat            15310 TH18       (((620165.4 1704256, 620291.4 1704247, …
 8 Chaiyaphum          64497 TH36       (((772997.4 1851276, 773104.5 1851216, …
 9 Chanthaburi         31473 TH22       (((853764.8 1360716, 853783.1 1360713, …
10 Chiang Mai         121812 TH50       (((554883.3 2226795, 555000.6 2226791, …
# ℹ 67 more rows</code></pre>
</div>
</div>
<p>I will also create a new <code>drug_cases_province_year</code> to aggregate the total number of cases for each province and based on each year, regardless of drug offense type.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>drug_cases_province_year <span class="ot">&lt;-</span> drug_cases <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province_en, fiscal_year) <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fiscal_year =</span> <span class="fu">first</span>(fiscal_year),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_cases =</span> <span class="fu">sum</span>(no_cases), </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">ADM1_PCODE =</span> <span class="fu">first</span>(ADM1_PCODE),              </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">geometry =</span> <span class="fu">first</span>(geometry),</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>                           </span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(drug_cases_province_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 462 features and 4 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 325178.8 ymin: 620860.6 xmax: 1213656 ymax: 2263241
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 462 × 5
   province_en   fiscal_year total_cases ADM1_PCODE                     geometry
   &lt;chr&gt;               &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;                &lt;MULTIPOLYGON [m]&gt;
 1 Amnat Charoen        2017        5076 TH37       (((1137720 1809629, 1137724…
 2 Amnat Charoen        2018        5651 TH37       (((1137720 1809629, 1137724…
 3 Amnat Charoen        2019        7339 TH37       (((1137720 1809629, 1137724…
 4 Amnat Charoen        2020        3949 TH37       (((1137720 1809629, 1137724…
 5 Amnat Charoen        2021        8961 TH37       (((1137720 1809629, 1137724…
 6 Amnat Charoen        2022        4459 TH37       (((1137720 1809629, 1137724…
 7 Ang Thong            2017        1614 TH15       (((643472.8 1636469, 643496…
 8 Ang Thong            2018        2717 TH15       (((643472.8 1636469, 643496…
 9 Ang Thong            2019        2781 TH15       (((643472.8 1636469, 643496…
10 Ang Thong            2020        2636 TH15       (((643472.8 1636469, 643496…
# ℹ 452 more rows</code></pre>
</div>
</div>
</section>
<section id="create-spacetime-cubes" class="level3">
<h3 class="anchored" data-anchor-id="create-spacetime-cubes">5.4 Create Spacetime Cubes</h3>
<p>We will also utilise the new s3 class introduced by Edzer Pebesma (2012) from the <code>sfdep</code> package to better represent spatio-temporal data (source code can be found <a href="https://github.com/edzer/spacetime">here</a>).</p>
<p>A <strong>spacetime object</strong> is considered a <strong>spacetime cube</strong> when each location in the dataset has a corresponding value for every point in time. In other words, the dataset contains a regular time series for each location. Hence, the concept of a <code>spacetime</code> cube can be valuable for understanding how the spatial patterns of these drug cases evolve over time.</p>
<ul>
<li><p>In ESRI terminology, the basic unit of a spacetime cube is called a <strong>bin</strong> which represents a unique combination of a specific geographic location and a particular time index.</p></li>
<li><p>The collection of all locations for a given time point forms a <strong>time slice</strong>.</p></li>
<li><p>Similarly, for a single location, the set of bins across all time points is referred to as a <strong>bin time-series</strong>.</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clipboard-431442936.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="396"></p>
</figure>
</div>
<p>Before we construct our <code>spacetime</code> cube object, we need to carry out data wrangling to prepare the requred data. It is worth noting that geometries are currently stored as <code>Multipolygon</code> rather than <code>Polygon</code> data. Hence, for the creation of the space-time object, I will need to split the <code>Multipolygon</code> geometries into individual <code>Polygon</code> components, then retain the largest polygon for each province.</p>
<ul>
<li><strong>Split Multipolygon into Polygon</strong>: we will use <code>st_cast</code> to convert <code>Multipolygon</code> geometries into <code>Polygon</code> geometries.</li>
<li><strong>Retain the Largest Polygon</strong>: For each province, we can calculate the area of each polygon and retain only the polygon with the largest area into <code>geo</code>.</li>
<li><strong>Convert the sf Attribute Data to a Dataframe</strong>: The <code>spacetime()</code> function will require useful attributes from <code>drug_cases_province_year</code> (e.g.&nbsp;total_cases) which will also require the geometry column to be dropped.</li>
<li><strong>Create the Space-Time Cube</strong>: After preparing the data, I’ll be able to use this for space-time analysis.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Split multipolygon into individual polygons and compute area</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>provinces_split <span class="ot">&lt;-</span> thai_boundary <span class="sc">%&gt;%</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area =</span> <span class="fu">st_area</span>(geometry))</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Retain the largest polygon for each province</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>geo <span class="ot">&lt;-</span> provinces_split <span class="sc">%&gt;%</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ADM1_PCODE) <span class="sc">%&gt;%</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(area <span class="sc">==</span> <span class="fu">max</span>(area)) <span class="sc">%&gt;%</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ADM1_PCODE, geometry)  </span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Prepare the data without geometry for analysis</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>df_drug_cases <span class="ot">&lt;-</span> <span class="fu">st_drop_geometry</span>(drug_cases_province_year) <span class="sc">%&gt;%</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ADM1_PCODE, province_en, fiscal_year, total_cases)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Ensure there are no duplicate rows in the data</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>df_drug_cases <span class="ot">&lt;-</span> <span class="fu">distinct</span>(df_drug_cases)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect the result</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_drug_cases)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  ADM1_PCODE province_en   fiscal_year total_cases
  &lt;chr&gt;      &lt;chr&gt;               &lt;dbl&gt;       &lt;dbl&gt;
1 TH37       Amnat Charoen        2017        5076
2 TH37       Amnat Charoen        2018        5651
3 TH37       Amnat Charoen        2019        7339
4 TH37       Amnat Charoen        2020        3949
5 TH37       Amnat Charoen        2021        8961
6 TH37       Amnat Charoen        2022        4459</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure output is an sf object</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(geo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure output is a dataframe object</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(df_drug_cases)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
<p>With the data prepared, we can now create the <code>spacetime</code> object called <code>drug_cases_spt</code> using the following data:</p>
<ul>
<li><p><strong>data:</strong> <code>df_drug_cases</code></p></li>
<li><p><strong>geometry:</strong> <code>st_data</code></p></li>
<li><p><strong>location identifier:</strong> <code>ADM1_PCODE</code></p></li>
<li><p><strong>time:</strong> <code>fiscal_year</code></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the spacetime object</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>drug_cases_spt <span class="ot">&lt;-</span> <span class="fu">spacetime</span>(</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.data =</span> df_drug_cases,      </span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">.geometry =</span> geo, </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">.loc_col =</span> <span class="st">"ADM1_PCODE"</span>,     </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">.time_col =</span> <span class="st">"fiscal_year"</span>,    </span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">active =</span> <span class="st">"data"</span>               </span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if it's a valid spacetime cube</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is_spacetime_cube</span>(drug_cases_spt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>A key takeaway and something to note, we need to dissolve the <code>MULTIPOLYGON</code> data to a <code>GEOMETRY</code> spatial object, else it will lead to an error where duplicated geometry is found. Additionally, after multiple trials and errors, I figured out that this error will also surface if the .data and .geometry parameters don’t receive a <strong>dataframe</strong> and <strong>sf</strong> object respectively.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clipboard-317917080.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="498"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="exploratory-geospatial-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-geospatial-data-analysis">6. Exploratory Geospatial Data Analysis</h2>
<section id="overall-histogram-of-drug-cases" class="level3">
<h3 class="anchored" data-anchor-id="overall-histogram-of-drug-cases">6.1 Overall Histogram of Drug Cases</h3>
<p>I employed the <code>geom_histogram</code> function of the <code>ggplot</code> package to plot histogram distributions of the spread of the number of drug cases found in Thailand from 2017 to 2022.</p>
<p>Overall, the number of cases appears to be relatively right-skewed with some outliers indicating a significantly high number of drug cases.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(drug_cases, <span class="fu">aes</span>(<span class="at">x =</span> no_cases)) <span class="sc">+</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">20</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="st">"skyblue2"</span>) <span class="sc">+</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Number of Cases"</span>, <span class="at">y =</span> <span class="st">"Count"</span>, <span class="at">title =</span> <span class="st">"Histogram of Total Drug Cases in Thailand (2017-2022)"</span>) <span class="sc">+</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/clipboard-1063489729.png" class="img-fluid"></p>
</section>
<section id="histogram-of-drug-cases-by-year" class="level3">
<h3 class="anchored" data-anchor-id="histogram-of-drug-cases-by-year">6.2 Histogram of Drug Cases by Year</h3>
<p>Based on each year category, we see that there is a similar pattern of drug cases skewed towards the lower end with an uneven distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create histogram for each year</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>drug_cases_2017 <span class="ot">&lt;-</span> <span class="fu">filter</span>(drug_cases, fiscal_year <span class="sc">==</span> <span class="dv">2017</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>hist_2017 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(drug_cases_2017, <span class="fu">aes</span>(<span class="at">x =</span> no_cases)) <span class="sc">+</span> </span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">20</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="st">"skyblue3"</span>) <span class="sc">+</span> </span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Number of Cases"</span>, <span class="at">y =</span> <span class="st">"Count"</span>, <span class="at">title =</span> <span class="st">"Drug Cases in 2017"</span>) <span class="sc">+</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">9</span>) </span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>drug_cases_2018 <span class="ot">&lt;-</span> <span class="fu">filter</span>(drug_cases, fiscal_year <span class="sc">==</span> <span class="dv">2018</span>)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>hist_2018 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(drug_cases_2018, <span class="fu">aes</span>(<span class="at">x =</span> no_cases)) <span class="sc">+</span> </span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">20</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="st">"skyblue3"</span>) <span class="sc">+</span> </span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Number of Cases"</span>, <span class="at">y =</span> <span class="st">"Count"</span>, <span class="at">title =</span> <span class="st">"Drug Cases in 2018"</span>) <span class="sc">+</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">9</span>)</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>drug_cases_2019 <span class="ot">&lt;-</span> <span class="fu">filter</span>(drug_cases, fiscal_year <span class="sc">==</span> <span class="dv">2019</span>)</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>hist_2019 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(drug_cases_2019, <span class="fu">aes</span>(<span class="at">x =</span> no_cases)) <span class="sc">+</span> </span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">20</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="st">"skyblue3"</span>) <span class="sc">+</span> </span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Number of Cases"</span>, <span class="at">y =</span> <span class="st">"Count"</span>, <span class="at">title =</span> <span class="st">"Drug Cases in 2019"</span>) <span class="sc">+</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">9</span>)</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>drug_cases_2020 <span class="ot">&lt;-</span> <span class="fu">filter</span>(drug_cases, fiscal_year <span class="sc">==</span> <span class="dv">2020</span>)</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>hist_2020 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(drug_cases_2020, <span class="fu">aes</span>(<span class="at">x =</span> no_cases)) <span class="sc">+</span> </span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">20</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="st">"skyblue3"</span>) <span class="sc">+</span> </span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Number of Cases"</span>, <span class="at">y =</span> <span class="st">"Count"</span>, <span class="at">title =</span> <span class="st">"Drug Cases in 2020"</span>) <span class="sc">+</span></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">9</span>)</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>drug_cases_2021 <span class="ot">&lt;-</span> <span class="fu">filter</span>(drug_cases, fiscal_year <span class="sc">==</span> <span class="dv">2021</span>)</span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>hist_2021 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(drug_cases_2021, <span class="fu">aes</span>(<span class="at">x =</span> no_cases)) <span class="sc">+</span> </span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">20</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="st">"skyblue3"</span>) <span class="sc">+</span> </span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Number of Cases"</span>, <span class="at">y =</span> <span class="st">"Count"</span>, <span class="at">title =</span> <span class="st">"Drug Cases in 2021"</span>) <span class="sc">+</span></span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">9</span>)</span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a>drug_cases_2022 <span class="ot">&lt;-</span> <span class="fu">filter</span>(drug_cases, fiscal_year <span class="sc">==</span> <span class="dv">2022</span>)</span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a>hist_2022 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(drug_cases_2022, <span class="fu">aes</span>(<span class="at">x =</span> no_cases)) <span class="sc">+</span> </span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">20</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="st">"skyblue3"</span>) <span class="sc">+</span> </span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Number of Cases"</span>, <span class="at">y =</span> <span class="st">"Count"</span>, <span class="at">title =</span> <span class="st">"Drug Cases in 2022"</span>) <span class="sc">+</span></span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">9</span>)</span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrange all histograms in a grid layout</span></span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(hist_2017, hist_2018, hist_2019, hist_2020, hist_2021, hist_2022, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/clipboard-1227396748.png" class="img-fluid"></p>
<p><img src=".png" class="img-fluid"></p>
</section>
<section id="total-cases-by-drug-case-type" class="level3">
<h3 class="anchored" data-anchor-id="total-cases-by-drug-case-type">6.3 Total Cases by Drug Case Type</h3>
<p>Next, we can take a peak into the spread of number of drug offense based on the drug case type. It appears that the highest number of drug case types involve drug use, drug possession and trafficking cases, while drug export cases is discovered to be the least in number of offenses.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>drug_cases_category_sum <span class="ot">&lt;-</span> drug_cases_type <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">category =</span> <span class="fu">case_when</span>(</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    types_of_drug_offenses <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"drug_use_cases"</span>, <span class="st">"suspects_in_drug_use_cases"</span>) <span class="sc">~</span> <span class="st">"Drug Use Cases"</span>,</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    types_of_drug_offenses <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"possession_cases"</span>, <span class="st">"suspects_in_possession_cases"</span>, <span class="st">"possession_with_intent_to_distribute_cases"</span>, <span class="st">"suspects_in_possession_with_intent_to_distribute_cases"</span>) <span class="sc">~</span> <span class="st">"Possession Cases"</span>,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    types_of_drug_offenses <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"trafficking_cases"</span>, <span class="st">"suspects_in_trafficking_cases"</span>) <span class="sc">~</span> <span class="st">"Trafficking Cases"</span>,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    types_of_drug_offenses <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"production_cases"</span>, <span class="st">"suspects_in_production_cases"</span>) <span class="sc">~</span> <span class="st">"Production Cases"</span>,</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    types_of_drug_offenses <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"import_cases"</span>, <span class="st">"suspects_in_import_cases"</span>, <span class="st">"export_cases"</span>, <span class="st">"suspects_in_export_cases"</span>) <span class="sc">~</span> <span class="st">"Import/Export Cases"</span>,</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    types_of_drug_offenses <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"conspiracy_cases"</span>, <span class="st">"suspects_in_conspiracy_cases"</span>) <span class="sc">~</span> <span class="st">"Conspiracy Cases"</span>,</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other"</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(category) <span class="sc">%&gt;%</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_cases_sum =</span> <span class="fu">sum</span>(total_cases))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(drug_cases_type, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(types_of_drug_offenses, total_cases), <span class="at">y =</span> total_cases, <span class="at">fill =</span> category)) <span class="sc">+</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> total_cases), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span>  <span class="co"># Add total cases labels</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Total Number of Drug Cases by Drug Offense Type"</span>,</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Drug Case Type"</span>,</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Total Cases"</span>) <span class="sc">+</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Blues"</span>) <span class="sc">+</span> </span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">16</span>) <span class="sc">+</span>  </span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),  </span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),   </span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span>  </span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()  <span class="co"># Flip the bars horizontally</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/clipboard-953256980.png" class="img-fluid"></p>
</section>
<section id="overall-plot-of-drug-cases" class="level3">
<h3 class="anchored" data-anchor-id="overall-plot-of-drug-cases">6.4 Overall Plot of Drug Cases</h3>
<p>As such, an <strong><em>quantile</em></strong> interval will be more suitable in plotting the total number of cases for each province as shown in the tmap output below. Additionally, we can use the default break of <strong>5</strong> to capture a suitable level of granularity across all provinces. For comparison purposes, I will also plot the <strong><em>equal</em></strong> scale as shown.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First plot using quantile interval</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>plot_quantile <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(drug_cases_province) <span class="sc">+</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"total_cases"</span>, </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"quantile"</span>, </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">n =</span> <span class="dv">5</span>,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Number of Drug Cases"</span>) <span class="sc">+</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Distribution of Drug Cases in Thailand </span><span class="sc">\n</span><span class="st"> by Province (Quantile Interval)"</span>,</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.7</span>,</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.45</span>, </span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"8star"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>() <span class="sc">+</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Second plot using equal interval</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>plot_equal <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(drug_cases_province) <span class="sc">+</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"total_cases"</span>, </span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"equal"</span>, </span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">n =</span> <span class="dv">5</span>,</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Number of Drug Cases"</span>) <span class="sc">+</span></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Distribution of Drug Cases in Thailand </span><span class="sc">\n</span><span class="st"> by Province (Equal Interval)"</span>,</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.7</span>,</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.45</span>, </span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"8star"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>() <span class="sc">+</span></span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine both plots side by side</span></span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(plot_quantile, plot_equal, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/clipboard-234682238.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-tip callout-titled" title="Observations">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Observations
</div>
</div>
<div class="callout-body-container callout-body">
<p>Overall, we can observe that the highest number of drug cases are found in the <strong>north-western, central, eastern and southern</strong> provinces of Thailand as seen in the darker regions. Namely..</p>
<ul>
<li>North-west: Chiang Mai, Chiang Rai</li>
<li>Central: Chaiyaphum, Khon Kaen and Nakhon-Ratchasima</li>
<li>East: Sisaket, Ubon-Ratchathani</li>
<li>South: Surat Thani, Nakhon Si Thammarat, Phuket</li>
</ul>
<p>It is worth noting that smaller provinces are likely to be lighter in shade due to their smaller geographic area.</p>
</div>
</div>
</section>
<section id="plot-of-drug-cases-by-year" class="level3">
<h3 class="anchored" data-anchor-id="plot-of-drug-cases-by-year">6.5 Plot of Drug Cases by Year</h3>
<p>When we further categorise the drug cases by year, we can see that there is an even spread of cases</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>plot_quantile_year <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(drug_cases_province_year) <span class="sc">+</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"total_cases"</span>, </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"quantile"</span>, </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>) <span class="sc">+</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_facets</span>(<span class="at">by=</span><span class="st">"fiscal_year"</span>, <span class="at">free.coords =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Distribution of Drug Cases in Thailand </span><span class="sc">\n</span><span class="st"> by Province for Each Year (Quantile Interval)"</span>,</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.7</span>,</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.45</span>, </span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) </span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>plot_quantile_year</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/clipboard-1946072980.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-tip callout-titled" title="Observations">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Observations
</div>
</div>
<div class="callout-body-container callout-body">
<p>When the drug cases are visualised by year, we can observe consistent patterns where high drug abuse cases are consistently located at the Southern parts of Thailand. Central Thailand in 2017 showed an average number of drug cases but this increased in the 2018 and continues to increase in the following years till 2022. In 2022, central Thailand faces a high concentration of drug cases which appears to have spread to its neighbouring provinces, particularly with the greatest spread in 2021.</p>
</div>
</div>
<p>Similar observations can be found when plotting the drug cases using the <code>knitr</code> package as shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create temporal maps</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>temporal_maps <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(drug_cases_province_year) <span class="sc">+</span>  </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"total_cases"</span>,  </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">palette =</span> <span class="st">"Blues"</span>,  </span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">style =</span> <span class="st">"quantile"</span>, </span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">title =</span> <span class="st">"Drug Cases"</span>) <span class="sc">+</span> </span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.title.size =</span> <span class="fl">1.8</span>,</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_facets</span>(<span class="at">along =</span> <span class="st">"fiscal_year"</span>, <span class="at">free.coords =</span> <span class="cn">FALSE</span>)</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate animation</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_animation</span>(temporal_maps, <span class="at">filename =</span> <span class="st">"thailand_drugs_temporal.gif"</span>, </span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">delay =</span> <span class="dv">150</span>, <span class="at">width =</span> <span class="dv">1000</span>, <span class="at">height =</span> <span class="dv">1200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/thailand_drugs_temporal.gif" class="img-fluid" width="664"></p>
</section>
</section>
<section id="global-measures-of-spatial-autocorrelation" class="level2">
<h2 class="anchored" data-anchor-id="global-measures-of-spatial-autocorrelation">7. Global Measures of Spatial Autocorrelation</h2>
<p>The Second Law of Geography articulated by Waldo Tobler in 1970, states that spatial relationships (or correlations) can vary depending on the context and the specific characteristics of different regions. This concept of <strong>spatial non-stationarity</strong> can be effectively measured and analysed using <strong>spatial autocorrelation statistics</strong>.</p>
<section id="methods-used-1" class="level3">
<h3 class="anchored" data-anchor-id="methods-used-1">7.1 Methods Used</h3>
<p>This section delves into analysing the spatial autocorrelation of our drug cases dataset and assessing how the presence of drug abuse in a province may influence and form clusters around it.</p>
<p>Spatial relationships are characterised by their <strong>multidirectional</strong> and <strong>multilateral</strong> nature, setting them apart from temporal relationships, which are linear and follow a past-present-future sequence. The <strong>codifying process of spatial relationships,</strong> illustrated in the figure below, enables the transformation of complex geographic space into a structured dataset suitable for computer analysis.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clipboard-2507849526.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="454"></p>
</figure>
</div>
<p>There are multiple approaches to defining spatial neighbours. Two most common methods are:</p>
<ol type="1">
<li><p><strong>Adjacency Measures</strong>: establish links between spatial units that are directly adjacent to one another. In this context, spatial units are considered neighbours if they share a boundary or a point.</p></li>
<li><p><strong>Distance Measures</strong>: selects neighbours based on proximity, where the nearest points to a given spatial unit are identified as neighbours. This approach considers varying distances, enabling a more nuanced understanding of spatial relationships beyond mere adjacency.</p>
<ul>
<li><strong>Rook Criterion</strong>: Neighbours are areas that share a common edge via horizontal and vertical connections between spatial units.</li>
<li><strong>Bishop Criterion</strong>: Neighbours are areas that share a common corner but not necessarily an edge. This approach is similar to the diagonal movements.</li>
<li><strong>Queen Criterion</strong>: Neighbours are areas that share either an edge or corner, which includes both vertical, horizontal, and diagonal connections.</li>
</ul></li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clipboard-1656372088.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="500"></p>
</figure>
</div>
</section>
<section id="computing-contiguity-neighbours" class="level3">
<h3 class="anchored" data-anchor-id="computing-contiguity-neighbours">7.2 Computing Contiguity Neighbours</h3>
<p>I decided to use the Queen criterion in deriving our <strong>neighbour list object</strong> since it covers the most neighbours of the three. To do so, we will utilise the <code>st_contiguity()</code> function from the <code>sfdep</code> package to create contiguity weight matrices for the study area. This function generates a list of neighbors based on provinces that <strong>share</strong> <strong>contiguous boundaries.</strong> It is worth noting that the function only supports the rook and queen criteria which is suitable for our analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>thailand_nb_q <span class="ot">&lt;-</span> <span class="fu">st_contiguity</span>(drug_cases_province<span class="sc">$</span>geometry, <span class="at">queen=</span><span class="cn">TRUE</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(thailand_nb_q)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 77 
Number of nonzero links: 352 
Percentage nonzero weights: 5.93692 
Average number of links: 4.571429 
1 region with no links:
48
2 disjoint connected subgraphs
Link number distribution:

 0  1  2  3  4  5  6  7  8  9 
 1  1  5 17 15 17 10  5  4  2 
1 least connected region:
71 with 1 link
2 most connected regions:
17 69 with 9 links</code></pre>
</div>
</div>
<p>Each number returned above is an ID assigned to each province from the <code>st_contiguity()</code> function. Let’s find out the specific provinces highlighted by the summary above!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>province_ids <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">region_id =</span> <span class="fu">seq_along</span>(drug_cases_province<span class="sc">$</span>province_en),</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">province_en =</span> drug_cases_province<span class="sc">$</span>province_en,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_cases =</span> drug_cases_province<span class="sc">$</span>total_cases</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>province_ids[province_ids<span class="sc">$</span>region_id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">17</span>, <span class="dv">48</span>, <span class="dv">69</span>, <span class="dv">71</span>), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   region_id province_en total_cases
17        17   Khon Kaen       93905
48        48      Phuket       75321
69        69         Tak       23530
71        71        Trat       13496</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Observations">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Observations
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>I can observe a total of 77 provinces (regions) in the dataset with <strong>352 neighbouring links</strong> between the provinces</li>
<li>There is <strong>roughly 5.94% non-zero neighbour relationships</strong>. This indicates only a small proportion of total possible connections have neighbours.</li>
<li>On average, we can also observe that <strong>each province</strong> has <strong>4.57 neighbouring regions.</strong></li>
<li><strong>Region</strong> <strong>48</strong> (Phuket province) has <strong>no neighbouring regions</strong></li>
<li><strong>Region 71</strong> (Trat province) is one of the <strong>least connected provinces</strong> with only 1 neighbouring region</li>
<li><strong>Regions 17</strong> (Khon Kaen province) and <strong>69</strong> (Tak province) are the two provinces with the <strong>most neighbours</strong>, each sharing boundaries with 9 other provinces</li>
</ul>
</div>
</div>
</section>
<section id="computing-row-standardised-weight-matrix" class="level3">
<h3 class="anchored" data-anchor-id="computing-row-standardised-weight-matrix">7.3 <strong>Computing Row-Standardised Weight Matrix</strong></h3>
<p>Next, I attempt to calculate spatial weights but the <strong>isolated region (48)</strong> is causing issues as spatial weights calculations require all regions to have neighbors.</p>
<p>To resolve the issue caused by the isolated region, I will use the <code>allow_zero = TRUE</code> option when calculating spatial weights, which will assign zero as a lagged value to allow the analysis to proceed despite isolated regions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>thailand_wt <span class="ot">&lt;-</span> <span class="fu">st_weights</span>(thailand_nb_q, <span class="at">style =</span> <span class="st">"W"</span>, <span class="at">allow_zero =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will mutate the newly created neighbour list object&nbsp;<code>thailand_nb_1</code> and weight matrix&nbsp;<code>thailand_wt</code>&nbsp;into our existing&nbsp;<code>drug_cases_province</code>. This results in a newly created object called <code>wm_1</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>wm_q <span class="ot">&lt;-</span> drug_cases_province <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nb =</span> thailand_nb_q,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">wt =</span> thailand_wt,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">.before =</span> <span class="dv">1</span>) </span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>wm_q</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 77 features and 5 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 325178.8 ymin: 620860.6 xmax: 1213656 ymax: 2263241
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 77 × 6
   nb        wt     province_en total_cases ADM1_PCODE                  geometry
 * &lt;nb&gt;      &lt;list&gt; &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;             &lt;MULTIPOLYGON [m]&gt;
 1 &lt;int [3]&gt; &lt;dbl&gt;  Amnat Char…       35435 TH37       (((1137720 1809629, 1137…
 2 &lt;int [4]&gt; &lt;dbl&gt;  Ang Thong         16168 TH15       (((643472.8 1636469, 643…
 3 &lt;int [6]&gt; &lt;dbl&gt;  Bangkok          286480 TH10       (((674339.8 1543300, 674…
 4 &lt;int [3]&gt; &lt;dbl&gt;  Bueng Kan         35287 TH38       (((965496 2045531, 96562…
 5 &lt;int [5]&gt; &lt;dbl&gt;  Buri Ram          57352 TH31       (((921217 1750212, 92121…
 6 &lt;int [8]&gt; &lt;dbl&gt;  Chachoengs…       53514 TH24       (((722656.1 1546054, 722…
 7 &lt;int [4]&gt; &lt;dbl&gt;  Chai Nat          15310 TH18       (((620165.4 1704256, 620…
 8 &lt;int [4]&gt; &lt;dbl&gt;  Chaiyaphum        64497 TH36       (((772997.4 1851276, 773…
 9 &lt;int [5]&gt; &lt;dbl&gt;  Chanthaburi       31473 TH22       (((853764.8 1360716, 853…
10 &lt;int [5]&gt; &lt;dbl&gt;  Chiang Mai       121812 TH50       (((554883.3 2226795, 555…
# ℹ 67 more rows</code></pre>
</div>
</div>
</section>
<section id="visualising-contiguity-weights" class="level3">
<h3 class="anchored" data-anchor-id="visualising-contiguity-weights">7.4 Visualising Contiguity Weights</h3>
<p>Let’s also visualise the Queen’s neighbour map. Here, we retrieve the centroid coordinates of each province by combining the longitude and latitude into a single object via <code>st_centroid()</code>. The outputs of the coordinate looks correct as shown.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract centroid geometries</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>centroids <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(drug_cases_province)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(centroids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 645239 ymin: 1505514 xmax: 1115483 ymax: 2013040
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 6 × 4
  province_en   total_cases ADM1_PCODE           geometry
  &lt;chr&gt;               &lt;dbl&gt; &lt;chr&gt;             &lt;POINT [m]&gt;
1 Amnat Charoen       35435 TH37        (1115483 1765518)
2 Ang Thong           16168 TH15         (645239 1617118)
3 Bangkok            286480 TH10       (675514.6 1523087)
4 Bueng Kan           35287 TH38       (998785.3 2013040)
5 Buri Ram            57352 TH31       (925999.3 1642136)
6 Chachoengsao        53514 TH24       (762475.6 1505514)</code></pre>
</div>
</div>
<p>Now, let’s plot the contiguity weights using the Queen’s method for all provinces.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot all regions (showing the boundaries)</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(drug_cases_province<span class="sc">$</span>geometry, <span class="at">border =</span> <span class="st">"lightgrey"</span>, <span class="at">main =</span> <span class="st">"Queen's Contiguity Weights (Including All Regions)"</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each region and plot neighbors if they exist</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(thailand_nb_q)) {</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if the region has neighbors</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(thailand_nb_q[[i]]) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (neighbor <span class="cf">in</span> thailand_nb_q[[i]]) {</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>      current_coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(centroids[i, ])</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>      neighbor_coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(centroids[neighbor, ])</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Create a LINESTRING directly from the two centroid coordinates</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>      combined_geom <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(current_coords[<span class="dv">1</span>], current_coords[<span class="dv">2</span>],</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>                                 neighbor_coords[<span class="dv">1</span>], neighbor_coords[<span class="dv">2</span>]),</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Draw lines between the current region and its neighbour</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lines</span>(combined_geom, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clipboard-1805425517.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Observations">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Observations
</div>
</div>
<div class="callout-body-container callout-body">
<p>We cam observe that most connections between the centroids of each province is found at the <strong>lower central regions</strong> of Thailand which shows signs of higher interactivity between provinces here. Surprisingly, there are fewer connecting relationships between provinces in the central parts of Thailand.</p>
</div>
</div>
</section>
<section id="global-morans-i" class="level3">
<h3 class="anchored" data-anchor-id="global-morans-i">7.5 Global <em>Moran’s I</em></h3>
<p>Moran’s I is a inferential static measure of the correlation between a variable and the values of its neighbouring regions to <strong>determine statistical significance</strong>. It reflects the <strong>extent</strong> to which <strong>individual features deviate</strong> from the <strong>overall values</strong> in the study area, assessing the <strong>similarity</strong> between each region and its neighbours, and averages these evaluations.</p>
<p>To examine spatial autocorrelation, we must test the following hypotheses:</p>
<ul>
<li><strong>Null Hypothesis (H0)</strong>: This states that there is either <strong><em>no</em></strong> spatial autocorrelation (H0) or that <strong><em>negative</em></strong> spatial autocorrelation exists (H0).</li>
<li><strong>Alternative Hypothesis (H1)</strong>: This suggests that <strong><em>positive</em></strong> spatial autocorrelation is present.</li>
</ul>
<p>The values of Moran’s I typically range from -1 to 1.</p>
<ul>
<li><strong>-1</strong> is perfect clustering of dissimilar values (perfect dispersion).</li>
<li><strong>0</strong> is no autocorrelation (perfect randomness.)</li>
<li><strong>+1</strong> indicates perfect clustering of similar values (the opposite of dispersion).</li>
</ul>
<section id="computing-global-morans-i" class="level4">
<h4 class="anchored" data-anchor-id="computing-global-morans-i">7.5.1 Computing Global <em>Moran’s I</em></h4>
<p>I will employ the <a href="https://sfdep.josiahparry.com/reference/global_moran"><code>global_moran()</code></a>&nbsp;function to compute the Moran’s I value which outputs a tibble dataframe. The <code>zero.policy</code> has been set to <code>TRUE</code> to allow the function to appropriately handle areas with no neighbours.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>moranI <span class="ot">&lt;-</span> <span class="fu">global_moran</span>(wm_q<span class="sc">$</span>total_cases,</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>                       wm_q<span class="sc">$</span>nb,</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>                       wm_q<span class="sc">$</span>wt, </span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(moranI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ I: num 0.119
 $ K: num 15.8</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Observations">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Observations
</div>
</div>
<div class="callout-body-container callout-body">
<p>Based on the outputs…</p>
<ul>
<li><p>The <strong>Moran’s I</strong> value of <code>0.119</code> suggests a slight positive spatial autocorrelation, indicating clustering of similar values (e.g., areas with similar drug case counts).</p></li>
<li><p>The <strong>K</strong> value of <code>15.8</code> indicates that each region, on average, has about 15.8 neighbours, which is a moderate level of connectivity among the regions being analysed.</p></li>
</ul>
</div>
</div>
</section>
<section id="global-morans-i-test" class="level4">
<h4 class="anchored" data-anchor-id="global-morans-i-test">7.5.2 Global <em>Moran’s I</em> Test</h4>
<p>The Global Moran’s I test, which can be performed using the <code>global_moran_test()</code> function from the <code>sfdep</code> package, is a tool for assessing spatial autocorrelation. The main objective of this test is to <strong>ascertain the presence of systemic spatial variations of drug abuse cases</strong>. In other words, how the number of drug cases in each province vary according to its surrounding provinces compared to that under spatial randomness.</p>
<p>For this analysis, we will specify <code>alternative = "greater"</code> in line with our alternative hypothesis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">global_moran_test</span>(wm_q<span class="sc">$</span>total_cases,</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>                       wm_q<span class="sc">$</span>nb,</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>                       wm_q<span class="sc">$</span>wt,</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">zero.policy =</span> <span class="cn">TRUE</span>,</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">alternative =</span> <span class="st">"greater"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  x  
weights: listw  
n reduced by no-neighbour observations  

Moran I statistic standard deviate = 1.8848, p-value = 0.02973
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.117752268      -0.013333333       0.004837196 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Observations">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Observations
</div>
</div>
<div class="callout-body-container callout-body">
<p>The calculated Moran I statistic returns a positive value of <strong>0.118,</strong> suggesting <strong>positive spatial autocorrelation</strong> and a tendency for similar values to be <strong>more clustered together</strong> than would be expected by chance. Hence, the spatial distribution of drug cases is not random.</p>
<p>The standard deviation (or z-score)of the observed Moran I statistic is <strong>1.8848 s.d. away from the expected value</strong> (which is typically 0 under the null hypothesis). The positive s.d. indicates that the observed clustering is stronger than what would be expected under the null hypothesis.</p>
<p>Since the <strong>p-value of 0.02973</strong> &lt; <strong>alpha value of 0.05</strong>, assuming a 95% confience interval, there is <strong>statistically significant evidence</strong> to reject the null hypothesis (which posits that there is no spatial autocorrelation) in favour of the alternative hypothesis, confirming that positive spatial autocorrelation is present in the data.</p>
</div>
</div>
</section>
<section id="performing-global-morans-i-permutation-test" class="level4">
<h4 class="anchored" data-anchor-id="performing-global-morans-i-permutation-test"><strong>7.5.3 Performing Global <em>Moran’s I</em></strong> Permutation Test</h4>
<p>From a frequentist approach, sampling the p-value once is not sufficient for determining the long-run behaviour of estimators and tests. Hence, let us strengthen our findings by repeated sampling, that is to perform <strong>Monte Carlo simulation</strong> and then, observe the results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>gmoran_MC <span class="ot">&lt;-</span> <span class="fu">global_moran_perm</span>(wm_q<span class="sc">$</span>total_cases,</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>                  wm_q<span class="sc">$</span>nb,</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>                  wm_q<span class="sc">$</span>wt,</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">zero.policy =</span> <span class="cn">TRUE</span>,</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nsim =</span> <span class="dv">999</span>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>gmoran_MC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  x 
weights: listw  
number of simulations + 1: 1000 

statistic = 0.11775, observed rank = 957, p-value = 0.086
alternative hypothesis: two.sided</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is always good practice to use&nbsp;<code>set.seed()</code>&nbsp;before performing simulation. This is to ensure that the computation is reproducible.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Observations">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Observations
</div>
</div>
<div class="callout-body-container callout-body">
<p>After 1000 simulations, our observed result confirms that the p-value is indeed <strong>smaller than the alpha value of 0.05</strong> and the <strong>Moran I statistic is &gt; 0</strong>. Hence, we can <strong>reject the H0</strong> in favour of H1, meaning that the results of <code>global_moran_test()</code> test is stable and statistically significant, and spatial distribution of drug cases resemble clustering distribution patterns.</p>
</div>
</div>
<p>Now, we can analyse the spatial distribution of drug cases in a histogram and its summary statistics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(gmoran_MC<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>]) <span class="sc">+</span> </span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">colour=</span><span class="st">"black"</span>, <span class="at">fill=</span><span class="st">"skyblue"</span>) <span class="sc">+</span> </span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(gmoran_MC<span class="sc">$</span>res)), <span class="at">color =</span> <span class="st">'red'</span>) <span class="sc">+</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of Simulated Moran's I For Thailand's Drug Cases"</span>,</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Simulated Moran's I"</span>,</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Occurences"</span>) <span class="sc">+</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span> </span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/clipboard-2351023385.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary Statistics</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gmoran_MC<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-0.19043 -0.06200 -0.01834 -0.01352  0.03085  0.32088 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Observations">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Observations
</div>
</div>
<div class="callout-body-container callout-body">
<p>We can confirm that the <strong>observed Moran I statistic</strong> <strong>(0.11775)</strong> is <strong>higher</strong> than the <strong>median (−0.01834)</strong> and <strong>mean (−0.01352)</strong> of the simulated values. This suggests that the observed spatial pattern is more clustered than what would be expected if the values were randomly distributed.</p>
</div>
</div>
</section>
</section>
<section id="global-gearys-c-test" class="level3">
<h3 class="anchored" data-anchor-id="global-gearys-c-test">7.6 Global Geary’s C Test</h3>
<p>In practice, when analysing spatial data, it is often recommended to use both Geary’s C and Moran’s I to gain a more comprehensive understanding of spatial patterns. However, <strong>Geary’s C</strong> can <strong>often fail to detect localised clustering</strong> compared to other spatial autocorrelation tests like Moran’s I.</p>
<ul>
<li><p><strong>Geary’s C is more sensitive to local dissimilarities</strong> between individual pairs of neighbouring areas rather than overall clustering, which makes it less effective at identifying larger-scale spatial structures or clusters.</p></li>
<li><p><strong>Moran’s I is better at identifying global patterns</strong> of clustering, where areas with similar values are grouped together in broader spatial clusters.</p></li>
</ul>
<p>Nonetheless, let’s explore what Geary’s C results look like for us.</p>
<section id="computing-global-gearys-c" class="level4">
<h4 class="anchored" data-anchor-id="computing-global-gearys-c">7.6.1 Computing Global <em>Geary’s C</em></h4>
<p><strong>Geary’s C test</strong> is developed by Geary (1954), which examines the intensity of a specific characteristic in spatial objects using a weight matrix. It can be performed using <code>global_c_test()</code> of the <code>sfdep</code> package in R, similar to how we conducted the Global Moran’s I test for evaluating spatial autocorrelation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">global_c</span>(</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  wm_q<span class="sc">$</span>total_cases, </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  wm_q<span class="sc">$</span>nb, </span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  wm_q<span class="sc">$</span>wt,</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">allow_zero =</span> <span class="cn">TRUE</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$C
[1] 0.9878824

$K
[1] 15.80246</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Observations">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Observations
</div>
</div>
<div class="callout-body-container callout-body">
<p>The Geary’s C statistic returned is <code>0.9879</code> which, unlike the results returned by <em>Moran’s I,</em> suggests a <strong>weak positive spatial autocorrelation</strong> since it is very close to <strong>1</strong>, indicating little to no spatial autocorrelation. As mentioned, Geary’s C tends to focus on local clusters which might miss larger clusters.</p>
</div>
</div>
</section>
<section id="global-geary-cs-test" class="level4">
<h4 class="anchored" data-anchor-id="global-geary-cs-test">7.5.2 Global <em>Geary C’s</em> Test</h4>
<p>Let us perform the Geary C’s Test which can be implemented using <code>global_c_test()</code> from the <code>sfdep</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">global_c_test</span>(wm_q<span class="sc">$</span>total_cases,</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>                  wm_q<span class="sc">$</span>nb,</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>                  wm_q<span class="sc">$</span>wt,</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">allow_zero =</span> <span class="cn">TRUE</span>,</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">alternative =</span> <span class="st">"greater"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Geary C test under randomisation

data:  x 
weights: listw  
n reduced by no-neighbour observations 

Geary C statistic standard deviate = 0.22762, p-value = 0.41
alternative hypothesis: Expectation greater than statistic
sample estimates:
Geary C statistic       Expectation          Variance 
       0.97488398        1.00000000        0.01217483 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Observations">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Observations
</div>
</div>
<div class="callout-body-container callout-body">
<p>After performing the Geary C test, we can observe that…</p>
<ul>
<li><p><strong>Geary’s C statistic</strong> is close to <strong>1</strong>, suggesting <strong>little or no global spatial autocorrelation</strong>.</p></li>
<li><p>The <strong>p-value of 0.41</strong> indicates that the observed pattern is <strong>not significantly different from random</strong>.</p></li>
<li><p>Therefore, the data does not show strong spatial clustering or dispersal, and the spatial distribution of values is likely random.</p></li>
</ul>
</div>
</div>
</section>
<section id="performing-global-gearys-c-permutation-test" class="level4">
<h4 class="anchored" data-anchor-id="performing-global-gearys-c-permutation-test"><strong>7.5.3 Performing Global <em>Geary’s C</em></strong> Permutation Test</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>ggeary_MC <span class="ot">&lt;-</span> <span class="fu">global_c_perm</span>(wm_q<span class="sc">$</span>total_cases,</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>                  wm_q<span class="sc">$</span>nb,</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>                  wm_q<span class="sc">$</span>wt,</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">allow_zero =</span> <span class="cn">TRUE</span>,</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">alternative =</span> <span class="st">"greater"</span>,</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nsim =</span> <span class="dv">999</span>)</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>ggeary_MC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Geary C

data:  x 
weights: listw  
number of simulations + 1: 1000 

statistic = 0.97488, observed rank = 459, p-value = 0.459
alternative hypothesis: greater</code></pre>
</div>
</div>
<p>We can see that the distribution of drug cases resulting from the Geary’s C permutation test has a <strong>much higher</strong> <strong>mean (0.9851)</strong> and <strong>median (0.9860) t</strong>han what was outputted by the Global Moran’s I test. Likewise, the observed Geary’s C statistics of 0.97488 suggests that the data does not show strong clustering/dispersed, but is random.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary Statistics</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ggeary_MC<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.4489  0.9151  0.9859  0.9882  1.0662  1.3445 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(ggeary_MC<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>]) <span class="sc">+</span> </span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">colour=</span><span class="st">"black"</span>, <span class="at">fill=</span><span class="st">"skyblue"</span>) <span class="sc">+</span> </span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(ggeary_MC<span class="sc">$</span>res)), <span class="at">color =</span> <span class="st">'red'</span>) <span class="sc">+</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of Simulated Geary's C For Thailand's Drug Cases"</span>,</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Simulated Geary's C"</span>,</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Occurences"</span>) <span class="sc">+</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span> </span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/clipboard-4160189896.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-tip callout-titled" title="Observations">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Observations
</div>
</div>
<div class="callout-body-container callout-body">
<p>As shown, Geary’s C indeed indicated randomness since it doesn’t detect the <strong>global pattern</strong> of spatial clustering very well, even when such a pattern is present. Geary’s C sensitivity to local differences between pairs of neighbours could make it <strong>miss larger, global clustering patterns</strong> and conclude that the spatial distribution is more random than it actually is. Hence, the Global Moran’s I test is more relevant in identifying overall clustering on a global-scale, i.e at a national scale, rather than by provinces.</p>
</div>
</div>
</section>
</section>
</section>
<section id="local-indicators-of-spatial-association-lisa" class="level2">
<h2 class="anchored" data-anchor-id="local-indicators-of-spatial-association-lisa">8. Local Indicators of Spatial Association (LISA)</h2>
<p>Previously, we used <em>Global Moran’s I</em> and <em>Geary’s C</em> in which we discovered whether spatial clustering exists across the whole Thailand region.</p>
<p>However, I would also like to perform local spatial autocorrelation to identify specific areas of clustering <strong>at a local level</strong> using LISA methods (Anselin, 1995). If these methods detect significant local clusters, it can help confirm that there are indeed clustered patterns that Geary’s C might have missed.</p>
<section id="local-morans-ii" class="level3">
<h3 class="anchored" data-anchor-id="local-morans-ii">8.1 Local <em>Moran’s I<sub>i</sub></em></h3>
<section id="computing-local-morans-ii" class="level4">
<h4 class="anchored" data-anchor-id="computing-local-morans-ii">8.1.1 Computing Local <em>Moran’s I<sub>i</sub></em></h4>
<p><strong>Local Moran’s I<sub>i</sub></strong> is an extension of <strong>Global Moran’s I</strong>, designed to identify <strong>local clusters</strong> and <strong>spatial outliers</strong> within a dataset. <strong>Local Moran’s I<sub>i</sub></strong> provides a measure of autocorrelation at individual locations, identifying where significant clustering or outliers exist.</p>
<p>Let’s utilise the&nbsp;<code>local_moran()</code>&nbsp;function of <strong>sfdep</strong> to handle the computations. Once again, we’ll set <code>zero.policy</code> to <strong>TRUE</strong> to allow the analysis to continue despite the one province with 0 neighbours.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>lisa <span class="ot">&lt;-</span> wm_q <span class="sc">%&gt;%</span> </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">local_moran =</span> <span class="fu">local_moran</span>(total_cases, nb, wt, </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">zero.policy =</span> <span class="cn">TRUE</span>, <span class="at">nsim =</span> <span class="dv">99</span>),</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">.before =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(local_moran)</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>lisa</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 77 features and 17 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 325178.8 ymin: 620860.6 xmax: 1213656 ymax: 2263241
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 77 × 18
        ii      eii   var_ii   z_ii   p_ii p_ii_sim p_folded_sim skewness
     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;
 1 -0.125  -0.0343  0.0590   -0.375 0.708      0.48         0.24   -1.38 
 2  0.318  -0.0464  0.236     0.750 0.453      0.54         0.27   -0.943
 3  0.136  -0.607   2.84      0.441 0.659      0.68         0.34    0.261
 4  0.119   0.00744 0.0477    0.510 0.610      0.66         0.33   -1.85 
 5  0.0356 -0.0157  0.00322   0.904 0.366      0.36         0.18    1.36 
 6  0.0430 -0.00211 0.000311  2.56  0.0105     0.06         0.03    0.994
 7  0.604  -0.0901  0.306     1.25  0.210      0.06         0.03   -1.86 
 8  0.144  -0.00995 0.0329    0.847 0.397      0.26         0.13    1.80 
 9 -0.106  -0.0109  0.0559   -0.403 0.687      0.52         0.26   -1.17 
10 -0.534   0.0101  0.680    -0.660 0.509      0.58         0.29    1.02 
# ℹ 67 more rows
# ℹ 10 more variables: kurtosis &lt;dbl&gt;, mean &lt;fct&gt;, median &lt;fct&gt;, pysal &lt;fct&gt;,
#   nb &lt;nb&gt;, wt &lt;list&gt;, province_en &lt;chr&gt;, total_cases &lt;dbl&gt;, ADM1_PCODE &lt;chr&gt;,
#   geometry &lt;MULTIPOLYGON [m]&gt;</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="How to read the table output">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
How to read the table output
</div>
</div>
<div class="callout-body-container callout-body">
<p>The output from the <code>local_moran()</code> function is an <code>sf</code> data frame that includes the following columns: <code>ii, eii, var_ii, z_ii, p_ii, p_ii_sim,</code> and<code>p_folded_sim.</code></p>
<ul>
<li><strong>ii</strong>: This represents the local Moran statistic.</li>
<li><strong>eii</strong>: This denotes the expected value of the local Moran statistic; for <code>localmoran_perm</code>, it corresponds to the means from the permutation samples.</li>
<li><strong>var_ii</strong>: This indicates the variance of the local Moran statistic; for <code>localmoran_perm</code>, it reflects the standard deviations from the permutation samples.</li>
<li><strong>z_ii</strong>: This is the standard deviation of the local Moran statistic; for <code>localmoran_perm</code>, it is calculated based on the means and standard deviations from the permutation samples.</li>
<li><strong>p_ii</strong>: This is the p-value for the local Moran statistic, derived using the <code>pnorm()</code> function; for <code>localmoran_perm</code>, it utilizes standard deviations based on the means and standard deviations from the permutation samples.</li>
<li><strong>p_ii_sim</strong>: For <code>localmoran_perm()</code>, this represents the rank of the observed statistic in relation to a uniform distribution for [0, 1] p-values, using the specified alternative hypothesis.</li>
<li><strong>p_folded_sim</strong>: This reflects the simulation of ranked p-values within the folded range of [0, 0.5], based on a specific implementation found in the <a href="https://github.com/pysal/esda/blob/4a63e0b5df1e754b17b5f1205bcadcbecc5e061/esda/crand.py#L211-L213">GitHub repository</a>.</li>
</ul>
</div>
</div>
</section>
<section id="visualising-local-morans-ii" class="level4">
<h4 class="anchored" data-anchor-id="visualising-local-morans-ii">8.1.2 Visualising Local <em>Moran’s I<sub>i</sub></em></h4>
<p>To ease our analysis, an approach we can take is to plot the local Moran’s I values across to visualise the observed values across each province. We’ll use a choropleth map from the <code>tmap</code> package to analyse the spatial patterns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(lisa) <span class="sc">+</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"ii"</span>, </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#B3EBF2"</span>,<span class="st">"green1"</span>,<span class="st">"orange"</span>,<span class="st">"red"</span>),</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Local Moran's I"</span>,</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="cn">NA</span>,</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.hist =</span> <span class="cn">TRUE</span>, </span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.is.portrait =</span> <span class="cn">TRUE</span>,</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.hist.z =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Province-Level Spatial Autocorrelation </span><span class="sc">\n</span><span class="st">of Drug Cases in Study Area (Thailand)"</span>,</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.7</span>,</span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.hist.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>,<span class="st">"bottom"</span>),</span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">asp =</span> <span class="fl">1.1</span>,</span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"8star"</span>, <span class="at">text.size =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"TOP"</span>)) <span class="sc">+</span></span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"LEFT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">text.size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">labels.size =</span> <span class="fl">0.6</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/clipboard-3631018759.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-tip callout-titled" title="Observations">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Observations
</div>
</div>
<div class="callout-body-container callout-body">
<p>The local spatial autocorrelation using <em>Moran’s I</em> outputs a total of <strong>4 different regions</strong>, each with a different range of Moran’s I value.</p>
<ul>
<li>Provinces in <strong><em>blue</em></strong> indicate a local Moran’s I value ranging from -1 to 0 with <strong>low-high</strong> spatial association or <strong>no similarity</strong> with its neighbours.
<ul>
<li>These province are outliers since they exhibit <strong>lower intensity of drug cases</strong> <strong>compared to its surrounding provinces</strong> where drug cases are higher in intensity</li>
</ul></li>
<li>Provinces in <strong><em>green, orange and red</em></strong> has a local Moran’s I value ranging from 0 to 3 with <strong>high-high</strong> spatial association.
<ul>
<li>These provinces tend to exhibit a high incidence of drug cases and are surrounded by other provinces with <strong>similarly high values.</strong></li>
<li>Samut Prakan province <strong>(in red)</strong> shows the <strong>strongest clustering effect</strong> i.e.&nbsp;it is strongly associated with its high drug-cases neighbours.</li>
<li>Followed by Nakhon Si Thammarat <strong>(in orange)</strong> which shows the 2nd strongest clustering effect.</li>
</ul></li>
</ul>
<p>Overall, the spatial autocorrelation of drug cases is a prevalent and widespread issue across provinces in Thailand. The two provinces, Samut Prakan and Nakhon Si Thammarat, suggests to be <strong>high-risk regions</strong> for the spread of drug cases.</p>
<p>However, for a complete understanding of these spatial autocorrelation patterns, we are required to evaluate the <strong>statistical significance</strong> associated with each Local Moran’s I value.</p>
</div>
</div>
</section>
<section id="visualising-local-morans-ii-p-value" class="level4">
<h4 class="anchored" data-anchor-id="visualising-local-morans-ii-p-value">8.1.3 Visualising Local <em>Moran’s I<sub>i</sub></em> P-value</h4>
<p>As mentioned in the section above, we shall not hastily conclude the clustering results observed. Instead, let us also evaluate whether the observed clustering (high-high or low-low) is <strong>statistically significant</strong> or <strong>could have occurred by chance</strong>. Hence, we can derive the p-values from Local Moran’s I by using the <code>p_ii_sim</code> field to determine statistical signficance across provinces.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove lisa record with 0 neighbours</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>lisa_clean <span class="ot">&lt;-</span> lisa <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_ii_sim))</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(lisa_clean) <span class="sc">+</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"p_ii_sim"</span>, </span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"green3"</span>,<span class="st">"lightyellow"</span>,<span class="st">"orange"</span>,<span class="st">"orange4"</span>,<span class="st">"red"</span>),</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"p-value"</span>,</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="cn">NA</span>,</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.hist =</span> <span class="cn">TRUE</span>, </span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.is.portrait =</span> <span class="cn">TRUE</span>,</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.hist.z =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Statistical Signifance of Spatial Autocorrelation</span><span class="sc">\n</span><span class="st"> of Drug Cases in Study Area (Thailand)"</span>,</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.7</span>,</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.hist.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>,<span class="st">"bottom"</span>),</span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">asp =</span> <span class="fl">1.1</span>,</span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"8star"</span>, <span class="at">text.size =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"TOP"</span>)) <span class="sc">+</span></span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"LEFT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">text.size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">labels.size =</span> <span class="fl">0.6</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/clipboard-2441982802.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-tip callout-titled" title="Observations">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Observations
</div>
</div>
<div class="callout-body-container callout-body">
<p>From the map above, not every province exhibits statistically significant Local <em>Moran I’s</em> value (i.e.&nbsp;p-value &lt; 0.05)</p>
</div>
</div>
</section>
<section id="visualising-statistically-significant-local-morans-ii" class="level4">
<h4 class="anchored" data-anchor-id="visualising-statistically-significant-local-morans-ii">8.1.4 Visualising Statistically Significant Local <em>Moran’s I<sub>i</sub></em></h4>
<p>With that said, I would like to switch our focus to provinces that display statistically significant local <em>Moran’s I</em> values. To execute this, I will attempt to <strong>remove</strong> all local <em>Moran’s I</em> values with <strong>p-values greater than 0.05</strong>. Subsequently, I will use the <code>tmap</code> function to plot the choropleth of statistically significant local spatial autocorrelation on the map of Thailand.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>lisa_sig <span class="ot">&lt;-</span> lisa  <span class="sc">%&gt;%</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(p_ii_sim <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(lisa)<span class="sc">+</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(lisa_sig) <span class="sc">+</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"ii"</span>, </span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"skyblue4"</span>,<span class="st">"skyblue"</span>,<span class="st">"lightblue1"</span>,<span class="st">"yellow"</span>,</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"orange"</span>,<span class="st">"orange4"</span>,<span class="st">"red"</span>),</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Local Moran's I (p-value &lt; 0.05)"</span>,</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="cn">NA</span>,</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.hist =</span> <span class="cn">TRUE</span>, </span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.is.portrait =</span> <span class="cn">TRUE</span>,</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.hist.z =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Statistical Signifance of Spatial Autocorrelation</span><span class="sc">\n</span><span class="st"> of Drug Cases in Study Area (Thailand)"</span>,</span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.7</span>,</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.hist.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>,<span class="st">"bottom"</span>),</span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">asp =</span> <span class="fl">1.1</span>,</span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"8star"</span>, <span class="at">text.size =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"TOP"</span>)) <span class="sc">+</span></span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"LEFT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">text.size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">labels.size =</span> <span class="fl">0.6</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/clipboard-1697590140.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-tip callout-titled" title="Observations">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Observations
</div>
</div>
<div class="callout-body-container callout-body">
<p>Previously, we mentioned that spatial autocorrelation of drug cases is widespread across provinces in Thailand, particularly in the provinces, Samut Prakan and Nakhon Si Thammarat. However, we can see that majority of provinces in Thailand is in fact <strong>not statistically significant</strong>. As such, we cannot conclude that most of these provinces are <strong>high-risk regions</strong> for the spread of drug cases.</p>
<p><strong>Potential Spill-over of Drug Cases in Central Thailand</strong></p>
<ul>
<li><p>Central provinces <strong>(in orange)</strong>, Kamphaeng-Phet and Nakhon Sawan, suggests to have some levels of high drug clusters, as shown from its low local <em>Moran’s I</em> values ranging from <strong>0.2 to 0.4.</strong></p></li>
<li><p>Moreover, a neighbouring province <strong>(in red)</strong> has an even higher local <em>Moran’s I</em> observed <strong>(0.6 to 0.8)</strong>,indicating that it has the strongest association with its neighbours where both itself and its neighbours exhibit strong clustering of high number of drug cases.</p></li>
<li><p>This poses a significant risk of drug cases spreading into other neighbouring provinces without adequate law enforcements and control, since this region has already become concentrated with high drug activites cumulatively across the years.</p></li>
<li><p>On the other hand, a province located in further down in southern Thailand <strong>(dark blue)</strong> displayed high clustering of low drug cases, as observed from its strongly negative local <em>Moran’s I</em> of <strong>-0.6 to -0.4</strong>.</p></li>
</ul>
<p><strong>Other interesting findings</strong></p>
<p>We can also observe that the provinces <strong>in gray</strong> are not statistically signifcant enough, especially provinces which displayed <strong>negative autocorrelation</strong> (i.e.&nbsp;<strong>&lt; 0</strong> Moran’s I) previously. This means that a <strong>low-high</strong> spatial association is, in reality, not observable in the spread of drug cases in Thailand.</p>
</div>
</div>
</section>
<section id="visualising-statistically-significant-local-morans-ii-by-drug-case" class="level4">
<h4 class="anchored" data-anchor-id="visualising-statistically-significant-local-morans-ii-by-drug-case">8.1.5 Visualising Statistically Significant Local <em>Moran’s I<sub>i</sub></em> (By Drug Case)</h4>
<p>I will categorise the dataset by the following drug case type to ease my analysis of how varying types of drug offense might display spatial dependence/independence from one province to another.</p>
<blockquote class="blockquote">
<p><strong>Drug Use Cases:</strong> Instances of individuals using drugs.</p>
<ul>
<li><code>drug_use_cases</code></li>
<li><code>suspects_in_drug_use_cases</code></li>
</ul>
<p><strong>Possession Cases</strong>: Instances where individuals are found with drugs and/or evidence suggesting intent to sell or distribute.</p>
<ul>
<li><code>possession_cases</code></li>
<li><code>suspects_in_possession_cases</code></li>
<li><code>possession_with_intent_to_distribute_cases</code></li>
<li><code>suspects_in_possession_with_intent_to_distribute_cases</code></li>
</ul>
<p><strong>Trafficking Cases:</strong> Instances related to the illegal trade of drugs.</p>
<ul>
<li><code>trafficking_cases</code></li>
<li><code>suspects_in_trafficking_cases</code></li>
</ul>
<p><strong>Production Cases:</strong> Instances involving the manufacture or cultivation of drugs.</p>
<ul>
<li><code>production_cases</code></li>
<li><code>suspects_in_production_cases</code></li>
</ul>
<p><strong>Import/Export Cases:</strong> Instances related to the illegal importation &amp; exportation of drugs.</p>
<ul>
<li><code>import_cases</code></li>
<li><code>suspects_in_import_cases</code></li>
<li><code>export_cases</code></li>
<li><code>suspects_in_export_cases</code></li>
</ul>
<p><strong>Conspiracy Cases:</strong> Instances where individuals conspire to commit drug-related offenses.</p>
<ul>
<li><code>conspiracy_cases</code></li>
<li><code>suspects_in_conspiracy_cases</code></li>
</ul>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute Moran I's by Drug Case</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sfdep)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for Moran's I calculation after filtering</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>compute_morans_I <span class="ot">&lt;-</span> <span class="cf">function</span>(filtered_data) {</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>  thailand_nb_q <span class="ot">&lt;-</span> <span class="fu">st_contiguity</span>(filtered_data<span class="sc">$</span>geometry, <span class="at">queen =</span> <span class="cn">TRUE</span>)</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>  thailand_wt <span class="ot">&lt;-</span> <span class="fu">st_weights</span>(thailand_nb_q, <span class="at">style =</span> <span class="st">"W"</span>, <span class="at">allow_zero =</span> <span class="cn">TRUE</span>)</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>  filtered_data <span class="ot">&lt;-</span> filtered_data <span class="sc">%&gt;%</span></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">nb =</span> thailand_nb_q, <span class="at">wt =</span> thailand_wt) <span class="sc">%&gt;%</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">local_moran =</span> <span class="fu">local_moran</span>(total_cases, nb, wt, </span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">zero.policy =</span> <span class="cn">TRUE</span>,</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">nsim =</span> <span class="dv">99</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(local_moran)</span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(filtered_data)</span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a><span class="co"># General function to process different types of drug offenses</span></span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>process_cases <span class="ot">&lt;-</span> <span class="cf">function</span>(offense_types) {</span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>  drug_cases <span class="sc">%&gt;%</span></span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(types_of_drug_offenses <span class="sc">%in%</span> offense_types) <span class="sc">%&gt;%</span></span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(province_en) <span class="sc">%&gt;%</span></span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">total_cases =</span> <span class="fu">sum</span>(no_cases),</span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">ADM1_PCODE =</span> <span class="fu">first</span>(ADM1_PCODE),</span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">geometry =</span> <span class="fu">first</span>(geometry),</span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb88-33"><a href="#cb88-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">compute_morans_I</span>()</span>
<span id="cb88-34"><a href="#cb88-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-35"><a href="#cb88-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-36"><a href="#cb88-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Define offense types for each category</span></span>
<span id="cb88-37"><a href="#cb88-37" aria-hidden="true" tabindex="-1"></a>drug_use_offenses <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"drug_use_cases"</span>, <span class="st">"suspects_in_drug_use_cases"</span>)</span>
<span id="cb88-38"><a href="#cb88-38" aria-hidden="true" tabindex="-1"></a>possession_offenses <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"possession_cases"</span>, <span class="st">"suspects_in_possession_cases"</span>, </span>
<span id="cb88-39"><a href="#cb88-39" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"possession_with_intent_to_distribute_cases"</span>, </span>
<span id="cb88-40"><a href="#cb88-40" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"suspects_in_possession_with_intent_to_distribute_cases"</span>)</span>
<span id="cb88-41"><a href="#cb88-41" aria-hidden="true" tabindex="-1"></a>trafficking_offenses <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"trafficking_cases"</span>, <span class="st">"suspects_in_trafficking_cases"</span>)</span>
<span id="cb88-42"><a href="#cb88-42" aria-hidden="true" tabindex="-1"></a>import_export_offenses <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"import_cases"</span>, <span class="st">"suspects_in_import_cases"</span>, </span>
<span id="cb88-43"><a href="#cb88-43" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"export_cases"</span>, <span class="st">"suspects_in_export_cases"</span>)</span>
<span id="cb88-44"><a href="#cb88-44" aria-hidden="true" tabindex="-1"></a>conspiracy_offenses <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"conspiracy_cases"</span>, <span class="st">"suspects_in_conspiracy_cases"</span>)</span>
<span id="cb88-45"><a href="#cb88-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-46"><a href="#cb88-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Process each type of offense</span></span>
<span id="cb88-47"><a href="#cb88-47" aria-hidden="true" tabindex="-1"></a>drug_use_cases <span class="ot">&lt;-</span> <span class="fu">process_cases</span>(drug_use_offenses)</span>
<span id="cb88-48"><a href="#cb88-48" aria-hidden="true" tabindex="-1"></a>possession_cases <span class="ot">&lt;-</span> <span class="fu">process_cases</span>(possession_offenses)</span>
<span id="cb88-49"><a href="#cb88-49" aria-hidden="true" tabindex="-1"></a>trafficking_cases <span class="ot">&lt;-</span> <span class="fu">process_cases</span>(trafficking_offenses)</span>
<span id="cb88-50"><a href="#cb88-50" aria-hidden="true" tabindex="-1"></a>import_export_cases <span class="ot">&lt;-</span> <span class="fu">process_cases</span>(import_export_offenses)</span>
<span id="cb88-51"><a href="#cb88-51" aria-hidden="true" tabindex="-1"></a>conspiracy_cases <span class="ot">&lt;-</span> <span class="fu">process_cases</span>(conspiracy_offenses)</span>
<span id="cb88-52"><a href="#cb88-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-53"><a href="#cb88-53" aria-hidden="true" tabindex="-1"></a><span class="co"># For significant cases</span></span>
<span id="cb88-54"><a href="#cb88-54" aria-hidden="true" tabindex="-1"></a>significant_cases <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb88-55"><a href="#cb88-55" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">%&gt;%</span></span>
<span id="cb88-56"><a href="#cb88-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(p_ii_sim <span class="sc">&lt;</span> <span class="fl">0.05</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">paste</span>(ADM1_PCODE, province_en))</span>
<span id="cb88-57"><a href="#cb88-57" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-58"><a href="#cb88-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-59"><a href="#cb88-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter significant cases for each offense type</span></span>
<span id="cb88-60"><a href="#cb88-60" aria-hidden="true" tabindex="-1"></a>drug_use_cases_sig <span class="ot">&lt;-</span> <span class="fu">significant_cases</span>(drug_use_cases)</span>
<span id="cb88-61"><a href="#cb88-61" aria-hidden="true" tabindex="-1"></a>possession_cases_sig <span class="ot">&lt;-</span> <span class="fu">significant_cases</span>(possession_cases)</span>
<span id="cb88-62"><a href="#cb88-62" aria-hidden="true" tabindex="-1"></a>trafficking_cases_sig <span class="ot">&lt;-</span> <span class="fu">significant_cases</span>(trafficking_cases)</span>
<span id="cb88-63"><a href="#cb88-63" aria-hidden="true" tabindex="-1"></a>import_export_cases_sig <span class="ot">&lt;-</span> <span class="fu">significant_cases</span>(import_export_cases)</span>
<span id="cb88-64"><a href="#cb88-64" aria-hidden="true" tabindex="-1"></a>conspiracy_cases_sig <span class="ot">&lt;-</span> <span class="fu">significant_cases</span>(conspiracy_cases)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="case-type-drug-use" class="level5">
<h5 class="anchored" data-anchor-id="case-type-drug-use"><strong>1) Case Type: Drug Use</strong></h5>
<div class="cell">
<details class="code-fold">
<summary>Plot Moran’s I and P-values</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Moran I's (red to green)</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>drug_use_moran_i <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(drug_use_cases) <span class="sc">+</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"ii"</span>, </span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#FF0000"</span>, <span class="st">"#FF4D4D"</span>, <span class="st">"#FF6666"</span>,</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"#CCFFCC"</span>, <span class="st">"#66CC66"</span>, <span class="st">"#4CAF50"</span>),</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">title =</span> <span class="st">"Local Moran's I"</span>,</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">midpoint =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Overall Spatial Autocorrelation</span><span class="sc">\n</span><span class="st">of Drug Cases (Drug Use)"</span>,</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.7</span>,</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"8star"</span>, <span class="at">text.size =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"TOP"</span>)) <span class="sc">+</span></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"LEFT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">text.size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a><span class="co"># p-values (red, orange, yellow, green)</span></span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>drug_use_p_values <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thai_boundary)<span class="sc">+</span></span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(drug_use_cases_sig) <span class="sc">+</span></span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"p_ii_sim"</span>, </span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#d21b1c"</span>,<span class="st">"#ec9a64"</span>,<span class="st">"#E5D96E"</span>,<span class="st">"#c9e3d2"</span>),</span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a>              <span class="at">title =</span> <span class="st">"p-value"</span>,</span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a>              <span class="at">midpoint =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Statistically Significant Spatial Autocorrelation</span><span class="sc">\n</span><span class="st">of Drug Cases (Drug Use)"</span>,</span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb89-31"><a href="#cb89-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.7</span>,</span>
<span id="cb89-32"><a href="#cb89-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb89-33"><a href="#cb89-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb89-34"><a href="#cb89-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb89-35"><a href="#cb89-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb89-36"><a href="#cb89-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb89-37"><a href="#cb89-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"8star"</span>, <span class="at">text.size =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"TOP"</span>)) <span class="sc">+</span></span>
<span id="cb89-38"><a href="#cb89-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"LEFT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">text.size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb89-39"><a href="#cb89-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span>
<span id="cb89-40"><a href="#cb89-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-41"><a href="#cb89-41" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(drug_use_moran_i, drug_use_p_values, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="images/clipboard-2820920240.png" class="img-fluid"></p>
<div class="cell">
<details class="code-fold">
<summary>Codes to plot map for statistically significant Moran’s I values</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>drug_use_cases_sig <span class="ot">&lt;-</span> drug_use_cases_sig <span class="sc">%&gt;%</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ii_rounded =</span> <span class="fu">paste</span>(province_en, <span class="st">":"</span>, <span class="fu">round</span>(ii, <span class="dv">3</span>)))</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(drug_use_cases) <span class="sc">+</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">id =</span> <span class="st">"label"</span>) <span class="sc">+</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(drug_use_cases_sig) <span class="sc">+</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"ii"</span>, </span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#E4F1EB"</span>, <span class="st">"#F5F3A6"</span>, <span class="st">"#E5D96E"</span>,</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"#ec9a64"</span>, <span class="st">"#d21b1c"</span>),</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Local Moran's I (p &lt; 0.05)"</span>,</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="cn">NA</span>,</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">id =</span> <span class="st">"label"</span>) <span class="sc">+</span></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"ii_rounded"</span>, </span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.4</span>, </span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">col =</span> <span class="st">"white"</span>,</span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">bg.color =</span> <span class="st">"black"</span>,</span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">bg.alpha =</span> <span class="fl">0.6</span>,  </span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">auto.placement =</span> <span class="cn">TRUE</span>, </span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">just =</span> <span class="st">"right"</span>,  </span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">id =</span> <span class="st">"province_en"</span>) <span class="sc">+</span> </span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adding layout elements for map styling</span></span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Statistical Significance of Spatial Autocorrelation</span><span class="sc">\n</span><span class="st">of Drug Use Cases in Study Area"</span>,</span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.7</span>,</span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.hist.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>,<span class="st">"bottom"</span>),</span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">asp =</span> <span class="fl">1.1</span>,</span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb90-36"><a href="#cb90-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-37"><a href="#cb90-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adding a compass for orientation</span></span>
<span id="cb90-38"><a href="#cb90-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"8star"</span>, <span class="at">text.size =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"TOP"</span>)) <span class="sc">+</span></span>
<span id="cb90-39"><a href="#cb90-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-40"><a href="#cb90-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adding a scale bar for map accuracy</span></span>
<span id="cb90-41"><a href="#cb90-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"LEFT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">text.size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb90-42"><a href="#cb90-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-43"><a href="#cb90-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adding grid with transparency</span></span>
<span id="cb90-44"><a href="#cb90-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">labels.size =</span> <span class="fl">0.6</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="images/clipboard-1434275424.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-tip callout-titled" title="Observations">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Observations
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Overall Observations</strong></p>
<p>When it comes to cases where individuals were found using drugs illegally, we can see that majority of these provinces did not display statistically significant (p&lt;0.05) Local <em>Moran I’s</em> values.</p>
<p><strong>Observations of statistically significant values</strong></p>
<p>On the higher range of Local <em>Moran’s I</em> values, we can see that <strong>Samut Prakan province in red</strong> (top right plot) displayed a <strong>strong</strong> <strong>p-value of 0.020 to 0.025</strong> which corresponds with a <strong>high positive</strong> Local <em>Moran’s I</em> value of 0.7 to 0.8 (bottom plot). This indicates that the province is indeed distinctly part of a group of similar high-value neighbours, hinting at a pronounced hotspot.</p>
<p>In the same bottom plot, we see that adjacent to the red region mentioned above, is a province in <strong>light green</strong>. To me, this is interesting as it suggests that this province has <strong>weaker clustering effects</strong>, meaning that its location has slightly higher number of drug cases than its neighbours but not as high as the province in red. There is a possibility that the spread of drug cases has not spilled to its other neighbours.</p>
</div>
</div>
</section>
<section id="case-type-possession" class="level5">
<h5 class="anchored" data-anchor-id="case-type-possession"><strong>2) Case Type: Possession</strong></h5>
<div class="cell">
<details class="code-fold">
<summary>Plot Moran’s I and P-values</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Moran I's (blue, green, light yellow, yellow, orange, red)</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>possession_moran_i <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(possession_cases) <span class="sc">+</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"ii"</span>, </span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#E6F4FA"</span>,<span class="st">"#c9e3d2"</span>, <span class="st">"#E1ECBB"</span>,</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"#E5D96E"</span>, <span class="st">"#ec9a64"</span>, <span class="st">"#d21b1c"</span>),</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">title =</span> <span class="st">"Local Moran's I"</span>,</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">midpoint =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Overall Spatial Autocorrelation</span><span class="sc">\n</span><span class="st">of Drug Cases (Possession)"</span>,</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.7</span>,</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"8star"</span>, <span class="at">text.size =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"TOP"</span>)) <span class="sc">+</span></span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"LEFT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">text.size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a><span class="co"># p-values (red, orange, yellow, green)</span></span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>possession_p_values <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thai_boundary)<span class="sc">+</span></span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(possession_cases_sig) <span class="sc">+</span></span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"p_ii_sim"</span>, </span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#d21b1c"</span>,<span class="st">"#ec9a64"</span>,<span class="st">"#E5D96E"</span>,<span class="st">"#c9e3d2"</span>),</span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a>              <span class="at">title =</span> <span class="st">"p-value"</span>,</span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a>              <span class="at">midpoint =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Statistically Significant Spatial Autocorrelation</span><span class="sc">\n</span><span class="st">of Drug Cases (Possession)"</span>,</span>
<span id="cb91-30"><a href="#cb91-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb91-31"><a href="#cb91-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.7</span>,</span>
<span id="cb91-32"><a href="#cb91-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb91-33"><a href="#cb91-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb91-34"><a href="#cb91-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb91-35"><a href="#cb91-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb91-36"><a href="#cb91-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb91-37"><a href="#cb91-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"8star"</span>, <span class="at">text.size =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"TOP"</span>)) <span class="sc">+</span></span>
<span id="cb91-38"><a href="#cb91-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"LEFT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">text.size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb91-39"><a href="#cb91-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span>
<span id="cb91-40"><a href="#cb91-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-41"><a href="#cb91-41" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(possession_moran_i, possession_p_values, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="images/clipboard-3254231149.png" class="img-fluid"></p>
<div class="cell">
<details class="code-fold">
<summary>Codes to plot map for statistically significant Moran’s I values</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>possession_cases_sig <span class="ot">&lt;-</span> possession_cases_sig <span class="sc">%&gt;%</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ii_rounded =</span> <span class="fu">paste</span>(province_en, <span class="st">":"</span>, <span class="fu">round</span>(ii, <span class="dv">3</span>)))</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(possession_cases) <span class="sc">+</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">id =</span> <span class="st">"label"</span>) <span class="sc">+</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(possession_cases_sig) <span class="sc">+</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"ii"</span>, </span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#E4F1EB"</span>, <span class="st">"#F5F3A6"</span>, <span class="st">"#E5D96E"</span>,</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"#ec9a64"</span>, <span class="st">"#d21b1c"</span>),</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Local Moran's I (p &lt; 0.05)"</span>,</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="cn">NA</span>,</span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">id =</span> <span class="st">"label"</span>) <span class="sc">+</span></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"ii_rounded"</span>, </span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.4</span>, </span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">col =</span> <span class="st">"white"</span>,</span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">bg.color =</span> <span class="st">"black"</span>,</span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">bg.alpha =</span> <span class="fl">0.6</span>,  </span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">just =</span> <span class="st">"right"</span>,  </span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">id =</span> <span class="st">"province_en"</span>) <span class="sc">+</span> </span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adding layout elements for map styling</span></span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Statistical Significance of Spatial Autocorrelation</span><span class="sc">\n</span><span class="st">of Drug Possession Cases in Study Area"</span>,</span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.7</span>,</span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.hist.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>,<span class="st">"bottom"</span>),</span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">asp =</span> <span class="fl">1.1</span>,</span>
<span id="cb92-34"><a href="#cb92-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb92-35"><a href="#cb92-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-36"><a href="#cb92-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adding a compass for orientation</span></span>
<span id="cb92-37"><a href="#cb92-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"8star"</span>, <span class="at">text.size =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"TOP"</span>)) <span class="sc">+</span></span>
<span id="cb92-38"><a href="#cb92-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-39"><a href="#cb92-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adding a scale bar for map accuracy</span></span>
<span id="cb92-40"><a href="#cb92-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"LEFT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">text.size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb92-41"><a href="#cb92-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-42"><a href="#cb92-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adding grid with transparency</span></span>
<span id="cb92-43"><a href="#cb92-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">labels.size =</span> <span class="fl">0.6</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="images/clipboard-1055200682.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-tip callout-titled" title="Observations">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Observations
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Observations of statistically significant values</strong></p>
<p>For drug cases found to be in possession and/or with the intent of distributing drugs, there are <strong>high levels of clustering</strong> of such cases in provinces located at the <strong>West</strong> of Thailand as observed from their higher Local <em>Moran I’s</em> values <strong>(in orange &amp; red regions)</strong>, ranging from 0.2 to 0.6.</p>
<p>Interestingly, the Nakhon Pathom province displayed a low Local <em>Moran’s I</em> value of <strong>-0.247</strong>, meaning it has <strong>significantly lower</strong> number of drug cases than its neighbours <strong>(light green)</strong>. Ironically, it is situated beside the Nonthaburi province <strong>(red)</strong> which has a <strong>high</strong> Local <em>Moran’s I</em> value of <strong>0.464</strong>, indicating that Nakhon Pathom province is not part of the significantly high clustering of drug cases observed by its neighbour. This could signal signs of <strong><em>boundary effects</em></strong> where there is <strong>no</strong> <strong>spill-over effect</strong> found in Nakkon Pathom.</p>
</div>
</div>
</section>
<section id="case-type-trafficking" class="level5">
<h5 class="anchored" data-anchor-id="case-type-trafficking"><strong>3) Case Type: Trafficking</strong></h5>
<div class="cell">
<details class="code-fold">
<summary>Plot Moran’s I and P-values</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Moran I's (blue, green, yellow, orange, red)</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>trafficking_moran_i <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(trafficking_cases) <span class="sc">+</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"ii"</span>, </span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#E6F4FA"</span>,<span class="st">"#c9e3d2"</span>,</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"#E5D96E"</span>, <span class="st">"#ec9a64"</span>, <span class="st">"#d21b1c"</span>),</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">title =</span> <span class="st">"Local Moran's I"</span>,</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">midpoint =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Overall Spatial Autocorrelation</span><span class="sc">\n</span><span class="st">of Drug Cases (Trafficking)"</span>,</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.7</span>,</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"8star"</span>, <span class="at">text.size =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"TOP"</span>)) <span class="sc">+</span></span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"LEFT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">text.size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a><span class="co"># p-values (red, orange, yellow, green)</span></span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>trafficking_p_values <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thai_boundary)<span class="sc">+</span></span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(trafficking_cases_sig) <span class="sc">+</span></span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"p_ii_sim"</span>, </span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#d21b1c"</span>,<span class="st">"#ec9a64"</span>,<span class="st">"#E5D96E"</span>,<span class="st">"#c9e3d2"</span>),</span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a>              <span class="at">title =</span> <span class="st">"p-value"</span>,</span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a>              <span class="at">midpoint =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Statistically Significant Spatial Autocorrelation</span><span class="sc">\n</span><span class="st">of Drug Cases (Trafficking)"</span>,</span>
<span id="cb93-30"><a href="#cb93-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb93-31"><a href="#cb93-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.7</span>,</span>
<span id="cb93-32"><a href="#cb93-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb93-33"><a href="#cb93-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb93-34"><a href="#cb93-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb93-35"><a href="#cb93-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb93-36"><a href="#cb93-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb93-37"><a href="#cb93-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"8star"</span>, <span class="at">text.size =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"TOP"</span>)) <span class="sc">+</span></span>
<span id="cb93-38"><a href="#cb93-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"LEFT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">text.size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb93-39"><a href="#cb93-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span>
<span id="cb93-40"><a href="#cb93-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-41"><a href="#cb93-41" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(trafficking_moran_i, trafficking_p_values, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="images/clipboard-3403556708.png" class="img-fluid"></p>
<div class="cell">
<details class="code-fold">
<summary>Codes to plot map for statistically significant</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>trafficking_cases_sig <span class="ot">&lt;-</span> trafficking_cases_sig <span class="sc">%&gt;%</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ii_rounded =</span> <span class="fu">paste</span>(province_en, <span class="st">":"</span>, <span class="fu">round</span>(ii, <span class="dv">3</span>)))</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(trafficking_cases) <span class="sc">+</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">id =</span> <span class="st">"label"</span>) <span class="sc">+</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(trafficking_cases_sig) <span class="sc">+</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"ii"</span>, </span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#E6F4FA"</span>, <span class="st">"#c9e3d2"</span>, <span class="st">"#ec9a64"</span>, <span class="st">"#d21b1c"</span>),</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Local Moran's I (p &lt; 0.05)"</span>,</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="cn">NA</span>,</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">id =</span> <span class="st">"label"</span>) <span class="sc">+</span></span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adding text labels for the 'ii' values over the provinces with a black background</span></span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"ii_rounded"</span>, </span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.4</span>, </span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">col =</span> <span class="st">"white"</span>,</span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">bg.color =</span> <span class="st">"black"</span>,</span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">bg.alpha =</span> <span class="fl">0.6</span>,  </span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">just =</span> <span class="st">"right"</span>,  </span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">id =</span> <span class="st">"province_en"</span>) <span class="sc">+</span> </span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adding layout elements for map styling</span></span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Statistical Significance of Spatial Autocorrelation</span><span class="sc">\n</span><span class="st">of Trafficking Cases in Study Area"</span>,</span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.7</span>,</span>
<span id="cb94-30"><a href="#cb94-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb94-31"><a href="#cb94-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb94-32"><a href="#cb94-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb94-33"><a href="#cb94-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.hist.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb94-34"><a href="#cb94-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>,<span class="st">"bottom"</span>),</span>
<span id="cb94-35"><a href="#cb94-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">asp =</span> <span class="fl">1.1</span>,</span>
<span id="cb94-36"><a href="#cb94-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb94-37"><a href="#cb94-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-38"><a href="#cb94-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adding a compass for orientation</span></span>
<span id="cb94-39"><a href="#cb94-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"8star"</span>, <span class="at">text.size =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"TOP"</span>)) <span class="sc">+</span></span>
<span id="cb94-40"><a href="#cb94-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-41"><a href="#cb94-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adding a scale bar for map accuracy</span></span>
<span id="cb94-42"><a href="#cb94-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"LEFT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">text.size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb94-43"><a href="#cb94-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-44"><a href="#cb94-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adding grid with transparency</span></span>
<span id="cb94-45"><a href="#cb94-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">labels.size =</span> <span class="fl">0.6</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="images/clipboard-3336495180.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-tip callout-titled" title="Observations">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Observations
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Observations of statistically significant values</strong></p>
<p>Likewise, we see some statistically significant observations in the extreme south of Thailand <strong>(light green)</strong> in the Songkhla province which appears to have <strong>slightly higher</strong> number of drug trafficking cases than its neighbours.</p>
<p>Songkhla is a <strong>key transportation hub</strong> with its capital Hat Yai having strong transportation links by <strong>road, rail, and air</strong>, making it a strategic point for drug traffickers to move illicit drugs. However, we aren’t sure where these drugs are illegally traded to/from since <em>Moran’s I</em> is relatively low, meaning there is <strong>low spatial dependence</strong> with its neighbours.</p>
<p>Si Sa Ket province <strong>(in red)</strong> suggests to have significant clustering of drug cases with <strong>high</strong> Local <em>Moran I’s</em> values of 2.26. The province has high number of drugs being trafficked and is likewise surrounded by neighbouring provinces with similarly high values, suggesting <strong>spatial dependence.</strong></p>
</div>
</div>
</section>
<section id="case-type-import-and-export" class="level5">
<h5 class="anchored" data-anchor-id="case-type-import-and-export"><strong>4) Case Type: Import and Export</strong></h5>
<div class="cell">
<details class="code-fold">
<summary>Plot Moran’s I and P-values</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Moran I's (blue, green, yellow, orange, red)</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>import_export_moran_i <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(import_export_cases) <span class="sc">+</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"ii"</span>, </span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#E6F4FA"</span>,<span class="st">"#c9e3d2"</span>,</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"#E5D96E"</span>, <span class="st">"#ec9a64"</span>, <span class="st">"#d21b1c"</span>),</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">title =</span> <span class="st">"Local Moran's I"</span>,</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">midpoint =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Overall Spatial Autocorrelation</span><span class="sc">\n</span><span class="st">of Drug Cases (Import &amp; Export)"</span>,</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.7</span>,</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"8star"</span>, <span class="at">text.size =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"TOP"</span>)) <span class="sc">+</span></span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"LEFT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">text.size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a><span class="co"># p-values (red, orange, yellow, green)</span></span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a>import_export_p_values <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thai_boundary)<span class="sc">+</span></span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(import_export_cases_sig) <span class="sc">+</span></span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"p_ii_sim"</span>, </span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#d21b1c"</span>,<span class="st">"#ec9a64"</span>,<span class="st">"#E5D96E"</span>,<span class="st">"#c9e3d2"</span>),</span>
<span id="cb95-27"><a href="#cb95-27" aria-hidden="true" tabindex="-1"></a>              <span class="at">title =</span> <span class="st">"p-value"</span>,</span>
<span id="cb95-28"><a href="#cb95-28" aria-hidden="true" tabindex="-1"></a>              <span class="at">midpoint =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb95-29"><a href="#cb95-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Statistically Significant Spatial Autocorrelation</span><span class="sc">\n</span><span class="st">of Drug Cases (Import &amp; Export)"</span>,</span>
<span id="cb95-30"><a href="#cb95-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb95-31"><a href="#cb95-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.7</span>,</span>
<span id="cb95-32"><a href="#cb95-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb95-33"><a href="#cb95-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb95-34"><a href="#cb95-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb95-35"><a href="#cb95-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb95-36"><a href="#cb95-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb95-37"><a href="#cb95-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"8star"</span>, <span class="at">text.size =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"TOP"</span>)) <span class="sc">+</span></span>
<span id="cb95-38"><a href="#cb95-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"LEFT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">text.size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb95-39"><a href="#cb95-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span>
<span id="cb95-40"><a href="#cb95-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-41"><a href="#cb95-41" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(import_export_moran_i, import_export_p_values, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="images/clipboard-1020581922.png" class="img-fluid"></p>
<div class="cell">
<details class="code-fold">
<summary>Codes to plot map for statistically significant Moran’s I values</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>import_export_cases_sig <span class="ot">&lt;-</span> import_export_cases_sig <span class="sc">%&gt;%</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ii_rounded =</span> <span class="fu">paste</span>(province_en, <span class="st">":"</span>, <span class="fu">round</span>(ii, <span class="dv">3</span>)))</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(import_export_cases) <span class="sc">+</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">id =</span> <span class="st">"label"</span>) <span class="sc">+</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(import_export_cases_sig) <span class="sc">+</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"ii"</span>, </span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#E4F1EB"</span>,<span class="st">"#E5D96E"</span>,<span class="st">"#ec9a64"</span>,<span class="st">"#d21b1c"</span>),</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Local Moran's I (p &lt; 0.05)"</span>,</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="cn">NA</span>,</span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">id =</span> <span class="st">"label"</span>) <span class="sc">+</span></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"ii_rounded"</span>, </span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.4</span>, </span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">col =</span> <span class="st">"white"</span>,</span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">bg.color =</span> <span class="st">"black"</span>,</span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">bg.alpha =</span> <span class="fl">0.6</span>,  </span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">just =</span> <span class="st">"right"</span>,  </span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">id =</span> <span class="st">"province_en"</span>) <span class="sc">+</span> </span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adding layout elements for map styling</span></span>
<span id="cb96-24"><a href="#cb96-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Statistical Significance of Spatial Autocorrelation</span><span class="sc">\n</span><span class="st">of Import &amp; Export Cases in Study Area"</span>,</span>
<span id="cb96-25"><a href="#cb96-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb96-26"><a href="#cb96-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.7</span>,</span>
<span id="cb96-27"><a href="#cb96-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb96-28"><a href="#cb96-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb96-29"><a href="#cb96-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb96-30"><a href="#cb96-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.hist.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb96-31"><a href="#cb96-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>,<span class="st">"bottom"</span>),</span>
<span id="cb96-32"><a href="#cb96-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">asp =</span> <span class="fl">1.1</span>,</span>
<span id="cb96-33"><a href="#cb96-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb96-34"><a href="#cb96-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-35"><a href="#cb96-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adding a compass for orientation</span></span>
<span id="cb96-36"><a href="#cb96-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"8star"</span>, <span class="at">text.size =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"TOP"</span>)) <span class="sc">+</span></span>
<span id="cb96-37"><a href="#cb96-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-38"><a href="#cb96-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adding a scale bar for map accuracy</span></span>
<span id="cb96-39"><a href="#cb96-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"LEFT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">text.size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb96-40"><a href="#cb96-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-41"><a href="#cb96-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adding grid with transparency</span></span>
<span id="cb96-42"><a href="#cb96-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">labels.size =</span> <span class="fl">0.6</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="images/clipboard-4029994052.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-tip callout-titled" title="Observations">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Observations
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Observations of statistically significant values</strong></p>
<p>We can observe another interesting occurrence of two provinces, Satun <strong>(red)</strong> and Phatthalung <strong>(blue)</strong> being geographically close, but showing very different importing and exporting of drug patterns where the former has a <strong>high positive</strong> <em>Moran I’s value</em> <strong>(6 to 8)</strong> while the latter has a <strong>negative</strong> observation <strong>(-2 to 0)</strong>. This contrast highlights a spatial disparity where one province (Phatthalung) has significantly fewer import/export of drugs, while its neighbour (Satun) is part of a import/export drug hotspot.</p>
</div>
</div>
</section>
<section id="case-type-conspiracy" class="level5">
<h5 class="anchored" data-anchor-id="case-type-conspiracy"><strong>5) Case Type: Conspiracy</strong></h5>
<div class="cell">
<details class="code-fold">
<summary>Plot Moran’s I and P-values</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Moran I's (blue, green, light yellow, yellow, orange, orangered, red)</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>conspiracy_moran_i <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(conspiracy_cases) <span class="sc">+</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"ii"</span>, </span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#E6F4FA"</span>,<span class="st">"green2"</span>,<span class="st">"#c9e3d2"</span>, <span class="st">"#E1ECBB"</span>,</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"#E5D96E"</span>, <span class="st">"#ec9a64"</span>,<span class="st">"#d21b1c"</span>),</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">title =</span> <span class="st">"Local Moran's I"</span>,</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">midpoint =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Overall Spatial Autocorrelation</span><span class="sc">\n</span><span class="st">of Drug Cases (Conspiracy)"</span>,</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.7</span>,</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"8star"</span>, <span class="at">text.size =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"TOP"</span>)) <span class="sc">+</span></span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"LEFT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">text.size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true" tabindex="-1"></a><span class="co"># p-values (red, orange, yellow, green)</span></span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true" tabindex="-1"></a>conspiracy_p_values <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thai_boundary)<span class="sc">+</span></span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb97-24"><a href="#cb97-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb97-25"><a href="#cb97-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(conspiracy_cases_sig) <span class="sc">+</span></span>
<span id="cb97-26"><a href="#cb97-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"p_ii_sim"</span>, </span>
<span id="cb97-27"><a href="#cb97-27" aria-hidden="true" tabindex="-1"></a>              <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#d21b1c"</span>,<span class="st">"#ec9a64"</span>,<span class="st">"#E5D96E"</span>,<span class="st">"#c9e3d2"</span>),</span>
<span id="cb97-28"><a href="#cb97-28" aria-hidden="true" tabindex="-1"></a>              <span class="at">title =</span> <span class="st">"p-value"</span>,</span>
<span id="cb97-29"><a href="#cb97-29" aria-hidden="true" tabindex="-1"></a>              <span class="at">midpoint =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb97-30"><a href="#cb97-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Statistically Significant Spatial Autocorrelation</span><span class="sc">\n</span><span class="st">of Drug Cases (Conspiracy)"</span>,</span>
<span id="cb97-31"><a href="#cb97-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb97-32"><a href="#cb97-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.7</span>,</span>
<span id="cb97-33"><a href="#cb97-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb97-34"><a href="#cb97-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb97-35"><a href="#cb97-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb97-36"><a href="#cb97-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb97-37"><a href="#cb97-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb97-38"><a href="#cb97-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"8star"</span>, <span class="at">text.size =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"TOP"</span>)) <span class="sc">+</span></span>
<span id="cb97-39"><a href="#cb97-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"LEFT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">text.size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb97-40"><a href="#cb97-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span>
<span id="cb97-41"><a href="#cb97-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-42"><a href="#cb97-42" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(conspiracy_moran_i, conspiracy_p_values, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="images/clipboard-4112380333.png" class="img-fluid"></p>
<div class="cell">
<details class="code-fold">
<summary>Codes to plot map for statistically significant Moran’s I values</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>conspiracy_cases_sig <span class="ot">&lt;-</span> conspiracy_cases_sig <span class="sc">%&gt;%</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ii_rounded =</span> <span class="fu">paste</span>(province_en, <span class="st">":"</span>, <span class="fu">round</span>(ii, <span class="dv">3</span>)))</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(conspiracy_cases) <span class="sc">+</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">id =</span> <span class="st">"label"</span>) <span class="sc">+</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(conspiracy_cases_sig) <span class="sc">+</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"ii"</span>, </span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#c9e3d2"</span>, <span class="st">"#E1ECBB"</span>, <span class="st">"#E5D96E"</span>, </span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"#ec9a64"</span>, <span class="st">"orangered"</span>, <span class="st">"#d21b1c"</span>),</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Local Moran's I (p &lt; 0.05)"</span>,</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="cn">NA</span>,</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">id =</span> <span class="st">"label"</span>) <span class="sc">+</span></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"ii_rounded"</span>, </span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.4</span>, </span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">col =</span> <span class="st">"white"</span>,</span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">bg.color =</span> <span class="st">"black"</span>,</span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">bg.alpha =</span> <span class="fl">0.6</span>,  </span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">auto.placement =</span> <span class="cn">TRUE</span>, </span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">just =</span> <span class="st">"right"</span>,  </span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">id =</span> <span class="st">"province_en"</span>) <span class="sc">+</span> </span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adding layout elements for map styling</span></span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Statistical Significance of Spatial Autocorrelation</span><span class="sc">\n</span><span class="st">of Conspiracy Cases in Study Area"</span>,</span>
<span id="cb98-27"><a href="#cb98-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb98-28"><a href="#cb98-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">0.7</span>,</span>
<span id="cb98-29"><a href="#cb98-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb98-30"><a href="#cb98-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb98-31"><a href="#cb98-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb98-32"><a href="#cb98-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.hist.size =</span> <span class="fl">0.6</span>,</span>
<span id="cb98-33"><a href="#cb98-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>,<span class="st">"bottom"</span>),</span>
<span id="cb98-34"><a href="#cb98-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">asp =</span> <span class="fl">1.1</span>,</span>
<span id="cb98-35"><a href="#cb98-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb98-36"><a href="#cb98-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-37"><a href="#cb98-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adding a compass for orientation</span></span>
<span id="cb98-38"><a href="#cb98-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"8star"</span>, <span class="at">text.size =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"RIGHT"</span>, <span class="st">"TOP"</span>)) <span class="sc">+</span></span>
<span id="cb98-39"><a href="#cb98-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-40"><a href="#cb98-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adding a scale bar for map accuracy</span></span>
<span id="cb98-41"><a href="#cb98-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">position =</span> <span class="fu">c</span>(<span class="st">"LEFT"</span>, <span class="st">"BOTTOM"</span>), <span class="at">text.size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb98-42"><a href="#cb98-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-43"><a href="#cb98-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adding grid with transparency</span></span>
<span id="cb98-44"><a href="#cb98-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">labels.size =</span> <span class="fl">0.6</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="images/clipboard-3000597324.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-tip callout-titled" title="Observations">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Observations
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Observations of statistically significant values</strong></p>
<p>Cases where individuals conspire to commit drug-related offenses produces a wider spread of statistically significant observations. In North-Western Thailand, provinces like Chang Mai, Lampang and Phayao <strong>(green)</strong> showed <strong>slightly higher</strong> number of conspiracy cases than its neighbours, with <strong>little spatial dependence</strong> on its neighbouring provinces.</p>
<p>On the other hand, provinces like Bangkok and Samut Prakan <strong>(orange &amp; red)</strong> were found adjacent to each other and displayed <strong>high spatial dependence</strong> with its neighbours where both provinces are part of clusters with <strong>similarly high</strong> number of such conspiracy drug cases. What’s interesting is these provinces are <strong>situated beside</strong> provinces which displayed <strong>low spatiald dependence</strong>, e.g.&nbsp;Nonthaburi, Pathum Thani and Chacheongsao <strong>(light green)</strong>.</p>
<p>This reflects <strong>spatial heterogeneity</strong>, where we have areas of intense clustering of high drug cases <strong>(orange &amp; red)</strong> adjacent to areas of intense clustering of low values. <strong>(light green)</strong></p>
</div>
</div>
<p><a href="https://is415-samanthafoo.netlify.app/take-home_ex/take-home_ex2/take-home_ex02_Part2">Continue to Part 2 &gt;</a></p>


</section>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>