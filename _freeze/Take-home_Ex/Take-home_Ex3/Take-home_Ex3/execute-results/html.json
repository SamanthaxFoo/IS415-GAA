{
  "hash": "7b217c4868c50b4042e8f85d1c0c082e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take-home Exercise 3\"\nsubtitle: \"Navigating Jakarta’s Traffic Network Using Grab Posisi Data\"\nauthor: \"Foo Jia Yi Samantha\"\ndate-modified: 11/03/2024\ndate: 11/03/2024\nformat: \n  html:\n    toc-depth: 5\nexecute: \n  eval: true\n  echo: true\n  freeze: true\n---\n\n\n# 1. Overview\n\nIn this Take-Home Exercise, I will be leveraging the [Grab Posisi dataset](https://engineering.grab.com/grab-posisi) to analyse Jakarta's growing need for on-demand ride-hailing services like Grab, given its increasing pace of urbanisation, particularly in areas with high Points of Interests (POIs).\n\nFeel free to move over to my team's Netlify site for a more in-depth understanding of our project scope and our progress: <https://is415-projectgrab-g2.netlify.app/>\n\nWith that said, let's begin with my contributions to the project. In this exercise, I will ddelve into two aspects of the project - **exploratory data analysis (EDA), exploratory spatial data analysis (ESDA)** and **Origin-Destination spatial analysis** on the Grab dataset. My goal is to experiment with as many charts as possible, e.g. heatmaps, Kernel Density Estimation (KDE), to answer critical questions that will be useful in informing us of **ride-hailing demand, traffic hotspots, and movement patterns** around key locations in Jakarta. Eventually, the most useful charts will be selected in the final project.\n\n# 2. Let's Set Up!\n\n## 2.1 Installing Required Packages\n\nFirstly, let us begin by loading these requiring libraries into our R environment.\n\n-   [`tidyverse`](https://www.tidyverse.org/) : a collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structure.\n\n-   [`ggplot2`](https://cran.r-project.org/web/packages/ggplot2/) : for creating advanced visualisations, graphics and maps using the Grammar of Graphics.\n\n-   [`patchwork`](https://patchwork.data-imaginist.com/) and [gridExtra](https://cran.r-project.org/web/packages/gridExtra/index.html): for arranging multiple ggplot2 maps beside each other\n\n-   [`ggalluvial`](https://cran.r-project.org/web/packages/ggalluvial/vignettes/ggalluvial.html): allows for building flow diagrams between origin and destination locations, similar to a sankey diagram.\n\n-   [`sf`](https://cran.r-project.org/web/packages/sf/index.html): for spatial data handling\n\n-   [`fmsb`](https://cran.r-project.org/web/packages/fmsb/index.html): for plotting radarcharts in R\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse, ggplot2, patchwork, ggalluvial, gridExtra, sf, fmsb)\n```\n:::\n\n\n## 2.2 Importing Datasets\n\nAs mentioned, I will be using the Grab Posisi dataset for Jakarta which contains GPS pings from Grab vehicles, including **timestamps, route data, and vehicle type** (motorcycle/car).\n\nIn addition, my team will be delving into the **district** administration level to offer more meaningful analysis that is still computationally suitable for this project. We have also **further augmented** the dataset by including data categories such as, POIs, weather, population size.\n\n**Datasets used in this project**\n\n1.  Jakarta Point of interests (POIs): <https://data.humdata.org/dataset/hotosm_idn_points_of_interest>\n\n2.  Weather API <https://www.weatherbit.io/>\n\n3.  Jakarta Population Density Data: <https://storymaps.arcgis.com/stories/36e38ceefab0455eb6059a734381723c>\n\n4.  Jakarta Map: <https://data.humdata.org/dataset/cod-ab-idn>\n\n5.  Grab Possi: <https://engineering.grab.com/grab-posisi>\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrips <- readRDS(\"data/aspatial/trip_data.rds\")\npois <- readRDS(\"data/aspatial/jakarta_pois.rds\")\npopulation <- read_csv(\"data/aspatial/jakarta_township_population.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 264 Columns: 5\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (4): province, city, district, township\ndbl (1): population_2019\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n:::\n\n\nThe `trips` tibble dataframe contains **55,995** unique Grab trips based on every 1 second GPS ping. This dataset also includes useful variables such as the `driving_mode` (car / motorcycle), `total_duration_minutes`, `total_distance_km`, location data (`origin_district` & `destination_district`) and time data (`origin_day` & `origin_hour`). I will be most interested in knowing where a Grab trip ends, i.e. its destination district, across which periods of the day and week.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(trips)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 55,995\nColumns: 32\n$ trj_id                              <chr> \"1\", \"10000\", \"10002\", \"10003\", \"1…\n$ driving_mode                        <chr> \"car\", \"motorcycle\", \"motorcycle\",…\n$ origin_time                         <dttm> 2019-04-11 14:17:35, 2019-04-16 0…\n$ destination_time                    <dttm> 2019-04-11 14:36:24, 2019-04-16 0…\n$ total_duration_minutes              <dbl> 18.816667, 9.450000, 21.300000, 32…\n$ total_distance_km                   <dbl> 5.943848, 2.809531, 8.040161, 16.8…\n$ average_speed_kmh                   <dbl> 18.952926, 17.838289, 22.648340, 3…\n$ origin_rawlat                       <dbl> -6.197622, -6.248311, -6.249766, -…\n$ origin_rawlng                       <dbl> 106.7690, 106.9304, 106.9682, 106.…\n$ destination_rawlat                  <dbl> -6.239817, -6.229177, -6.235125, -…\n$ destination_rawlng                  <dbl> 106.8019, 106.9470, 106.8970, 106.…\n$ origin_lat                          <dbl> -2939149, -2993318, -3001902, -295…\n$ origin_lng                          <dbl> 13499453, 13554146, 13569122, 1355…\n$ destination_lat                     <dbl> -2962961, -2989069, -2980935, -300…\n$ destination_lng                     <dbl> 13504006, 13564901, 13543389, 1350…\n$ origin_province                     <chr> \"jakarta\", \"jakarta\", \"outside of …\n$ origin_city                         <chr> \"kota jakarta barat\", \"kota jakart…\n$ origin_district                     <chr> \"kebon jeruk\", \"duren sawit\", \"out…\n$ destination_province                <chr> \"jakarta\", \"outside of jakarta\", \"…\n$ destination_city                    <chr> \"kota jakarta selatan\", \"outside o…\n$ destination_district                <chr> \"kebayoran baru\", \"outside of jaka…\n$ origin_datetime                     <dttm> 2019-04-11 14:17:35, 2019-04-16 0…\n$ destination_datetime                <dttm> 2019-04-11 14:36:24, 2019-04-16 0…\n$ origin_day                          <chr> \"thursday\", \"tuesday\", \"monday\", \"…\n$ origin_hour                         <dbl> 14, 0, 5, 10, 23, 7, 4, 4, 2, 10, …\n$ destination_day                     <chr> \"thursday\", \"tuesday\", \"monday\", \"…\n$ destination_hour                    <dbl> 14, 1, 6, 11, 23, 7, 4, 4, 4, 10, …\n$ origin_time_cluster                 <chr> \"afternoon lull\", \"midnight peak\",…\n$ destination_time_cluster            <chr> \"afternoon lull\", \"midnight peak\",…\n$ origin_date                         <date> 2019-04-11, 2019-04-16, 2019-04-0…\n$ origin_weather_description          <chr> \"broken clouds\", \"scattered clouds…\n$ origin_weather_description_category <chr> \"not_rain\", \"not_rain\", \"Outside o…\n```\n\n\n:::\n:::\n\n\n::: callout-note\nGrab trips from **outside of Jakarta** and moving out of Jakarta are attributed to the outer islands of Jakarta, namely the **Kepulauan Seribu Regency,** which are chains of islands in the North of Jakarta's coasts.\n:::\n\nThis dataset contains all **unique** **9,685 POIs** found within each district of Jakarta. This will give us insights on how Grab is demanded based on the availability of POIs across different districts.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(pois)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 9,685\nColumns: 11\n$ poi_name <chr> \"TK Sekolah Kemurnian I\", \"PAUD Melati X\", \"Posyandu Cempaka\"…\n$ province <chr> \"jakarta\", \"jakarta\", \"jakarta\", \"jakarta\", \"jakarta\", \"jakar…\n$ city     <chr> \"kota jakarta barat\", \"kota jakarta timur\", \"kota jakarta tim…\n$ district <chr> \"taman sari\", \"pasar rebo\", \"pasar rebo\", \"cilandak\", \"koja\",…\n$ category <chr> \"Facilities_Services\", \"Facilities_Services\", \"Essentials\", \"…\n$ poi_type <chr> \"kindergarten\", \"kindergarten\", \"clinic\", \"kindergarten\", \"co…\n$ geometry <POINT [m]> POINT (13527881 -2927558), POINT (13508901 -3013973), P…\n$ lat_4326 <dbl> -6.146429, -6.334694, -6.331832, -6.313693, -6.124969, -6.340…\n$ lng_4326 <dbl> 106.8132, 106.8634, 106.8456, 106.7959, 106.9196, 106.8066, 1…\n$ lat_5580 <dbl> -2927558, -3013973, -3009066, -2991388, -2940921, -3004218, -…\n$ lng_5580 <dbl> 13527881, 13508901, 13502345, 13486227, 13575632, 13484988, 1…\n```\n\n\n:::\n:::\n\n\nThirdly, the `population` dataframe contains all population counts in **2019** down to the township level. We will need to perform some data wrangling to summarise it to the **district** level later.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(population)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 264\nColumns: 5\n$ province        <chr> \"Jakarta\", \"Jakarta\", \"Jakarta\", \"Jakarta\", \"Jakarta\",…\n$ city            <chr> \"Kota Jakarta Utara\", \"Kota Jakarta Barat\", \"Kota Jaka…\n$ district        <chr> \"Pademangan\", \"Tambora\", \"Kramat Jati\", \"Jatinegara\", …\n$ township        <chr> \"ancol\", \"angke\", \"bale kambang\", \"bali mester\", \"bamb…\n$ population_2019 <dbl> 4921, 1545, 3774, 2762, 2667, 1724, 2938, 3774, 982, 2…\n```\n\n\n:::\n:::\n\n\n# 3. Data Wrangling\n\n## 3.1 Categorising Point of interests Data\n\nI assisted my team mate, Jia Le, with handling some of the data cleaning process of the project. This includes **re-categorising** the **205 POIs** identified for each district into its correct category as the initial categories were previously classified wrongly.\n\nThere are a total of **9 unique categories** that needed some re-categorisation.\n\n-   Facilities_Services\n-   Essentials\n-   Offices_Business\n-   Cultural_Attractions\n-   Restaurants_Food\n-   Recreation_Entertainment\n-   Others\n-   Shops\n-   Tourism_Spots\n\nFor instance, the 'taxi' POI was initially classified as 'Others' instead of something more related like **'Facilities_Services'**.\n\n![](images/clipboard-1845745824.png){width=\"727\"}\n\n## 3.2 Aggregate the Population Dataset\n\nIt is worth noting that we have two lakes that are considered districts here - Danau Sunter and Danau Sunter DII - which explains why they have 0 population size. We also do not have population data for districts outside of Jakarta here.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npopulation <- population %>%\n  group_by(district) %>%\n  summarise(population_count = sum(population_2019))\n\n# Inspect\npopulation\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 44 × 2\n   district         population_count\n   <chr>                       <dbl>\n 1 Cakung                      38710\n 2 Cempaka Putih                7440\n 3 Cengkareng                  40470\n 4 Cilandak                    16880\n 5 Cilincing                   37471\n 6 Cipayung                    21336\n 7 Ciracas                     30015\n 8 Danau Sunter                    0\n 9 Danau Sunter Dll                0\n10 Duren Sawit                 38150\n# ℹ 34 more rows\n```\n\n\n:::\n:::\n\n\n## 3.3 Prepare the Augmented *POIs* Dataset\n\nFor a more useful analysis, we can break it down by POI category types and get the count of POIs within each category for each district, as shown in the `pois_num` tibble below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Count the number of POIs by district\npois_num <- pois %>%\n  st_drop_geometry() %>%\n  group_by(district) %>%\n  summarise(num_of_pois = n(), .groups = 'drop')\n\n# Inspect\npois_num\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 44 × 2\n   district         num_of_pois\n   <chr>                  <int>\n 1 cakung                    56\n 2 cempaka putih             38\n 3 cengkareng               298\n 4 cilandak                 242\n 5 cilincing                119\n 6 cipayung                  56\n 7 ciracas                  126\n 8 danau sunter               1\n 9 danau sunter dll           3\n10 duren sawit              173\n# ℹ 34 more rows\n```\n\n\n:::\n:::\n\n\n## 3.4 Preprare the Augmented *Trips* Dataset\n\nI noticed that we have records where destination districts are found outside of Jakarta's boundary. For the purpose of analysing Grab trends within Jakarta, I will filter these trip records out.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrips <- trips %>%\n  filter(destination_district != \"outside of jakarta\" |\n         origin_district != \"outside of jakarta\")\n\n# Inspect\nhead(trips)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 32\n  trj_id driving_mode origin_time         destination_time   \n  <chr>  <chr>        <dttm>              <dttm>             \n1 1      car          2019-04-11 14:17:35 2019-04-11 14:36:24\n2 10000  motorcycle   2019-04-16 00:51:24 2019-04-16 01:00:51\n3 10002  motorcycle   2019-04-08 05:55:41 2019-04-08 06:16:59\n4 10003  car          2019-04-19 10:52:34 2019-04-19 11:24:44\n5 10007  car          2019-04-11 07:05:00 2019-04-11 07:28:56\n6 10012  car          2019-04-20 02:38:54 2019-04-20 04:05:16\n# ℹ 28 more variables: total_duration_minutes <dbl>, total_distance_km <dbl>,\n#   average_speed_kmh <dbl>, origin_rawlat <dbl>, origin_rawlng <dbl>,\n#   destination_rawlat <dbl>, destination_rawlng <dbl>, origin_lat <dbl>,\n#   origin_lng <dbl>, destination_lat <dbl>, destination_lng <dbl>,\n#   origin_province <chr>, origin_city <chr>, origin_district <chr>,\n#   destination_province <chr>, destination_city <chr>,\n#   destination_district <chr>, origin_datetime <dttm>, …\n```\n\n\n:::\n:::\n\n\nNext, I will leverage the `trips` tibble dataframe to group all trips by `destination_district` and summarise them by number of trips, average duration (minutes) and average distance travelled (km).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrips_dest <- trips %>%\n  group_by(destination_district) %>%\n  summarise(\n    num_of_trips = n(), \n    avg_duration_minutes = mean(total_duration_minutes, na.rm = TRUE), \n    avg_distance_km = mean(total_distance_km, na.rm = TRUE)  \n  ) %>%\n  rename(district = destination_district) %>%\n  mutate(district = tolower(district))\n\ntrips_origin <- trips %>%\n  group_by(origin_district) %>%\n  summarise(\n    num_of_trips = n(), \n    avg_duration_minutes = mean(total_duration_minutes, na.rm = TRUE), \n    avg_distance_km = mean(total_distance_km, na.rm = TRUE)  \n  ) %>%\n  rename(district = origin_district) %>%\n  mutate(district = tolower(district))\n```\n:::\n\n\nI will also join the `pois_num` dataframe to `trips_dest` and `trips_origin` by the **district** column so we can append the total number of POIs for each destination district.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrips_dest_pois <- trips_dest %>%\n  inner_join(pois_num, by = \"district\")\n\ntrips_origin_pois <- trips_origin %>%\n  inner_join(pois_num, by = \"district\")\n```\n:::\n\n\nLet's also include the population data from the `population` dataframe we imported into R.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# For the destination\ndistrict_dest <- trips_dest_pois %>%\n  left_join(population %>% mutate(district = tolower(district)), \n            by = \"district\")\n\ndistrict_dest\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 44 × 6\n   district        num_of_trips avg_duration_minutes avg_distance_km num_of_pois\n   <chr>                  <int>                <dbl>           <dbl>       <int>\n 1 cakung                   844                 21.5            6.40          56\n 2 cempaka putih            392                 19.1            6.13          38\n 3 cengkareng              1120                 19.9            6.20         298\n 4 cilandak                 905                 20.1            5.78         242\n 5 cilincing                277                 24.4            7.24         119\n 6 cipayung                 552                 22.5            7.08          56\n 7 ciracas                  546                 22.6            7.03         126\n 8 danau sunter              17                 17.3            5.21           1\n 9 danau sunter d…           33                 16.9            5.00           3\n10 duren sawit              877                 21.1            6.32         173\n# ℹ 34 more rows\n# ℹ 1 more variable: population_count <dbl>\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# For the origin\ndistrict_origin <- trips_origin_pois %>%\n  left_join(population %>% mutate(district = tolower(district)), \n            by = \"district\")\n\ndistrict_origin\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 44 × 6\n   district        num_of_trips avg_duration_minutes avg_distance_km num_of_pois\n   <chr>                  <int>                <dbl>           <dbl>       <int>\n 1 cakung                   628                 22.2            6.56          56\n 2 cempaka putih            460                 17.9            5.52          38\n 3 cengkareng               928                 20.2            6.00         298\n 4 cilandak                 830                 20.4            6.09         242\n 5 cilincing                266                 24.7            7.30         119\n 6 cipayung                 481                 22.9            7.09          56\n 7 ciracas                  607                 23.1            7.38         126\n 8 danau sunter               4                 19.4            8.55           1\n 9 danau sunter d…           34                 21.3            7.54           3\n10 duren sawit              891                 21.3            6.39         173\n# ℹ 34 more rows\n# ℹ 1 more variable: population_count <dbl>\n```\n\n\n:::\n:::\n\n\n# 4. Exploratory Data Analysis (EDA)\n\nIn this EDA process, I will leverage the datasets we've imported and wrangled to identify charts that produce the most interesting insights in terms of traffic pattersn, demand for Grab trends, temporal trends and POI analysis.\n\n## 4.1 Traffic Trends & Demand Distribution\n\n### **4.1.1 Distribution of Trips Origin and Destination By District**\n\nIn terms of trip origins, districts such as Setia Budi, Grogol Petamburan, and Kebayoran Baru have the **highest traffic volumes** moving out of the district, indicating areas of high trip demand. In terms of trip destinations, districts such as Tanah A bang and Setia Budi are most popular for Grab trips. In contrast, districts like Johar Baru, Dananu Sunter DII, and Danau Sunter experience the **lowest traffic volumes**, suggesting potential areas of **under-service** or potentially **low demand for Grab services**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Count trips for origin districts\norigin_counts <- trips %>%\n  count(origin_district) %>%\n  rename(total_trips = n)\n\n# Count trips for destination districts\ndestination_counts <- trips %>%\n  count(destination_district) %>%\n  rename(total_trips = n)\n\n# Create a bar plot for origin districts\np1 <- ggplot(origin_counts, aes(x = reorder(origin_district, -total_trips), y = total_trips)) +\n  geom_bar(stat = \"identity\", fill = \"skyblue2\") +\n  theme_gray() +\n  labs(title = \"Total Number of Grab Trips per Origin District\",\n       x = \"Origin District\",\n       y = \"Number of Trips\") +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\"), # Center and style the title\n    axis.text.x = element_text(angle = 45, hjust = 1)\n  )\n\n# Create a bar plot for destination districts\np2 <- ggplot(destination_counts, aes(x = reorder(destination_district, -total_trips), y = total_trips)) +\n  geom_bar(stat = \"identity\", fill = \"pink2\") +\n  theme_gray() +\n  labs(title = \"Total Number of Grab Trips per Destination District\",\n       x = \"Destination District\",\n       y = \"Number of Trips\") +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\"), # Center and style the title\n    axis.text.x = element_text(angle = 45, hjust = 1)\n  )\n\np1 / p2 \n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-13-1.png){width=960}\n:::\n:::\n\n\nWe can also inspect how the population size of each district influences the number of trips taken to and from each district. Generally, districts with a **high number of trips per capita** from **origin** also displayed **more frequent** trips taken into the district.\n\nInitially, there are districts with the **highest trips per capita** but in reality, they do NOT correspond to **high number of trips** (previous chart). For instance, Danau Sunter DII and Danau Sunter are districts with the lowest number of trips but since they also have a population of 0, resulting in a **seemingly high** number of trips per capita. Hence, we remove trip data from these two districts since it is not possible to divide a value by 0!\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Prepare data\"}\ndestination_data <- district_dest %>%\n  select(district, population_count, num_of_trips) %>%\n  filter(district != \"Danau Sunter Dll\" & district != \"Danau Sunter\") %>%\n  mutate(trips_per_capita_dest = num_of_trips / population_count) %>%\n  rename(district = district)\n\norigin_data <- district_origin %>%\n  select(district, population_count, num_of_trips) %>%\n  filter(district != \"Danau Sunter Dll\" & district != \"Danau Sunter\") %>%\n  mutate(trips_per_capita_origin = num_of_trips / population_count) %>%\n  rename(district = district)\n\ncombined_data <- destination_data %>%\n  select(district, trips_per_capita = trips_per_capita_dest) %>%\n  mutate(trip_type = \"Destination\") %>%\n  bind_rows(\n    origin_data %>%\n      select(district, trips_per_capita = trips_per_capita_origin) %>%\n      mutate(trip_type = \"Origin\")\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create the line plot for trips per capita with specified colors and theme\nggplot(combined_data, aes(x = district, y = trips_per_capita, color = trip_type, group = trip_type)) +\n  geom_line(size = 1.2) +\n  geom_point(size = 2) +\n  labs(\n    title = \"Number of Trips Per Capita by District\",\n    x = \"District\",\n    y = \"Trips Per Capita\"\n  ) +\n  theme_gray() +\n  theme(\n    plot.title = element_text(size = 16, face = \"bold\", hjust = 0.5), \n    axis.text.x = element_text(angle = 90, hjust = 1)\n  ) +\n  scale_color_manual(values = c(\"Origin\" = \"lightblue3\", \"Destination\" = \"pink3\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-15-1.png){width=960}\n:::\n:::\n\n\nInstead, we can just separate the number of trips and the population size as such. Generally, we do not see any trends, meaning that the population size has no effect on the number of trips taken.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Prepare data\"}\ndistrict_data <- district_dest %>%\n  select(district, population_count, num_of_trips) %>%\n  rename(trips = num_of_trips)\n\ndistrict_data <- district_data %>%\n  bind_rows(\n    district_origin %>%\n      select(district, population_count, num_of_trips) %>%\n      rename(trips = num_of_trips)\n  ) %>%\n  group_by(district) %>%\n  summarise(\n    population_count = mean(population_count, na.rm = TRUE),\n    total_trips = mean(trips, na.rm = TRUE)\n  ) %>%\n  arrange(desc(population_count))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(district_data) +\n  geom_line(aes(x = reorder(district, population_count), y = total_trips, group = 1, color = \"Average Trips Taken\"), size = 1.2) +  # Updated label\n  geom_line(aes(x = reorder(district, population_count), y = population_count * max(total_trips) / max(population_count), group = 2, color = \"Population Count\"), size = 1.2) +\n  geom_point(aes(x = reorder(district, population_count), y = total_trips, color = \"Average Trips Taken\"), size = 3) +  # Updated label\n  geom_point(aes(x = reorder(district, population_count), y = population_count * max(total_trips) / max(population_count), color = \"Population Count\"), size = 3) +\n  labs(\n    title = \"Mean Number of Trips and Population Count by District\",\n    x = \"District\",\n    y = \"Mean Number of Trips\",\n    color = \"Legend\"\n  ) +\n  theme_gray() +\n  theme(\n    plot.title = element_text(size = 16, face = \"bold\", hjust = 0.5),  # Center, bold, size 16\n    axis.text.x = element_text(angle = 90, hjust = 1),\n    legend.position = \"top\"\n  ) +\n  scale_color_manual(values = c(\"Average Trips Taken\" = \"lightblue3\", \"Population Count\" = \"pink3\")) +  # Updated color mapping\n  scale_y_continuous(\n    sec.axis = sec_axis(~ . * max(district_data$population_count) / max(district_data$total_trips), name = \"Population Count\")  # Secondary axis\n  )\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-17-1.png){width=960}\n:::\n:::\n\n\n### **4.1.2 *Top* Origins and Destinations for Ride-hailing Trips**\n\nNext, we will prepare the top 5 districts with the most number of Grab trips based on trip origin and trip destinations.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate top 5 districts for origin_district\ntop_5_origin_districts <- trips %>%\n  count(origin_district) %>%\n  rename(total_trips = n) %>%\n  arrange(desc(total_trips)) %>%\n  slice(1:5)\n\n# Calculate top 5 districts for destination_district\ntop_5_destination_districts <- trips %>%\n  count(destination_district) %>%\n  rename(total_trips = n) %>%\n  arrange(desc(total_trips)) %>%\n  slice(1:5)\n```\n:::\n\n\nBy plotting a bar chart, we can identify districts with the most demand for Grab services for both in-flow and out-flow of Grab trips. In particular, we can see that districts with most Grab trips **originating** from it **corresponds** with the highest number of Grab trips **arriving into it** (e.g. Setia Budi).\n\nSuch alignment suggests that these districts function as key hubs of movement within the city, likely due to high-density residential, commercial, or mixed-use areas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot for Top 5 Origin Districts\np1 <- ggplot(top_5_origin_districts, aes(y = reorder(origin_district, total_trips), x = total_trips)) +\n  geom_bar(stat = \"identity\", fill = \"skyblue\") +\n  theme_gray() +\n  labs(title = \"Most Popular Origin Districts\", y = \"District\", x = \"Number of Trips\") +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\")\n  )\n\n# Plot for Top 5 Destination Districts\np2 <- ggplot(top_5_destination_districts, aes(y = reorder(destination_district, total_trips), x = total_trips)) +\n  geom_bar(stat = \"identity\", fill = \"pink2\") +\n  theme_gray() +\n  labs(title = \"Most Popular Destination Districts\", y = \"District\", x = \"Number of Trips\") +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\")\n  )\n\np1 + p2\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-19-1.png){width=960}\n:::\n:::\n\n\n### **4.1.3 *Least popular* origins and destinations for ride-hailing trips**\n\nWe can also gather origin and destination districts with the least trips by arranging the `total_trips` in descending order and filtering districts with the **lowest 5** number of trips.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Prepare data\"}\norig_count <- trips %>%\n  count(origin_district) %>%\n  rename(trips = n) %>%\n  arrange(trips)\n\ndest_count <- trips %>%\n  count(destination_district) %>%\n  rename(trips = n) %>%\n  arrange(trips)\n\nbottom_5_orig <- orig_count %>%\n  slice_head(n = 5)\n\nbottom_5_dest <- dest_count %>%\n  slice_head(n = 5)\n\nbottom_5_orig$origin_district <- factor(bottom_5_orig$origin_district, \n                                        levels = bottom_5_orig$origin_district)\nbottom_5_dest$destination_district <- factor(bottom_5_dest$destination_district, \n                                             levels = bottom_5_dest$destination_district)\n```\n:::\n\n\nHere I plot the `geom_bar()` of the ggplot2 package. The results aligns with what we mentioned earlier, where the same origin districts with the least out-flow of Grab trips also happen to be districts with the least in-flow of Grab trips.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- ggplot(bottom_5_orig, aes(y = origin_district, x = trips)) +\n  geom_bar(stat = \"identity\", fill = \"lightblue\") +\n  labs(title = \"Least Popular Origin Districts\", y = \"District\", x = \"Trips\") +\n  theme_gray() +\n  theme(plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\"))\n\np2 <- ggplot(bottom_5_dest, aes(y = destination_district, x = trips)) +\n  geom_bar(stat = \"identity\", fill = \"pink2\") +\n  labs(title = \"Least Popular Destination Districts\", y = \"District\", x = \"Trips\") +\n  theme_gray() +\n  theme(plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\"))\n\np1 + p2\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-21-1.png){width=960}\n:::\n:::\n\n\n### 4.1.4 Popularity of Districts Based on Driving Mode\n\nWhen using the `geom_density()` function to create density plots, we can see a smoothed version of the trip distance (in kilometres), further drilled down by the mode of driving (car vs motorcycle). There is almost no difference in relative distance travelled by cars or motorcycles.\n\nFor **longer distances traveled**, cars are slightly more preferredthan motorcycles, while for **shorter** trip distances, both driving modes are **equally demanded**.Thus, we only see **some instances** where **cars are preferred** for when journeys are longer.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(trips, aes(x = total_distance_km, fill = driving_mode)) +\n  geom_density(alpha = 0.8) +\n  labs(title = \"Trip Distance (km) by Driving Mode (All Trips)\",\n       x = \"Total Distance (km)\",\n       y = \"Density\") +\n  theme_gray() +\n  theme(plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\")) +\n  scale_fill_manual(values = c(\"lightblue\", \"pink2\"))\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\nThis is the adjusted plot when we completely remove all trips with origins and destinations outside of Jakarta. The distance of Grab journeys significantly decrease from 80km to \\~20km, and observations of popularity of the driving mode remains the same.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrips_inside_jakarta <- trips %>%\n  filter(origin_district != 'Outside of Jakarta', destination_district != 'Outside of Jakarta')\n\nggplot(trips_inside_jakarta, aes(x = total_distance_km, fill = driving_mode)) +\n  geom_density(alpha = 0.8) +\n  labs(title = \"Trip Distance (km) by Driving Mode (Within Jakarta)\",\n       x = \"Total Distance (km)\",\n       y = \"Density\") +\n  theme_gray() +\n  theme(plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\")) +\n  scale_fill_manual(values = c(\"lightblue\", \"pink2\"))\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n\nWe can further break this down into popular origins and destinations for **car** and **motorcycle** drivers respectively. It is rather intriguing that both modes of driving have similar top origin and destinations, as well as least popular origin and destinations travelled. Once again, indicating how both vehicle types are **equally demanded** in Jakarta.\n\n**1) For Car Drivers**\n\n\n::: {.cell code-true='false'}\n\n```{.r .cell-code}\n# Filter trips for cars only\ncar_trips <- trips %>%\n  filter(driving_mode == 'car')\n\n# Calculate counts for origin districts\norigin_counts <- car_trips %>%\n  count(origin_district) %>%\n  rename(total_trips = n) %>%\n  arrange(desc(total_trips))\n\n# Get top 5 origin districts\ntop_5_origin_districts <- origin_counts %>%\n  slice_head(n = 5)\n\n# Get least 5 origin districts\nbottom_5_origin_districts <- origin_counts %>%\n  slice_tail(n = 5)\n\n# Set factor levels for top and bottom origin districts\ntop_5_origin_districts$origin_district <- factor(top_5_origin_districts$origin_district, \n                                                  levels = top_5_origin_districts$origin_district)\n\nbottom_5_origin_districts$origin_district <- factor(bottom_5_origin_districts$origin_district, \n                                                     levels = bottom_5_origin_districts$origin_district)\n\n# Plot for Top 5 Origin Districts in descending order\np1 <- ggplot(top_5_origin_districts, aes(y = reorder(origin_district, total_trips), x = total_trips)) +\n  geom_bar(stat = \"identity\", fill = \"lightgreen\") +\n  theme_gray() +\n  labs(title = \"Top 5 Popular Origin Districts (Cars)\", y = \"District\", x = \"Number of Trips\") +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\")\n  )\n\n# Plot for Least 5 Origin Districts\np2 <- ggplot(bottom_5_origin_districts, aes(y = origin_district, x = total_trips)) +\n  geom_bar(stat = \"identity\", fill = \"lightcoral\") +\n  theme_gray() +\n  labs(title = \"Least 5 Popular Origin Districts (Cars)\", y = \"District\", x = \"Number of Trips\") +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\")\n  )\n\n# Calculate counts for destination districts\ndestination_counts <- car_trips %>%\n  count(destination_district) %>%\n  rename(total_trips = n) %>%\n  arrange(desc(total_trips))\n\n# Get top 5 destination districts\ntop_5_destination_districts <- destination_counts %>%\n  slice_head(n = 5)\n\n# Get least 5 destination districts\nbottom_5_destination_districts <- destination_counts %>%\n  slice_tail(n = 5)\n\n# Set factor levels for top and bottom destination districts\ntop_5_destination_districts$destination_district <- factor(top_5_destination_districts$destination_district, \n                                                             levels = top_5_destination_districts$destination_district)\n\nbottom_5_destination_districts$destination_district <- factor(bottom_5_destination_districts$destination_district, \n                                                               levels = bottom_5_destination_districts$destination_district)\n\n# Plot for Top 5 Destination Districts\np3 <- ggplot(top_5_destination_districts, aes(y = reorder(destination_district, total_trips), x = total_trips)) +\n  geom_bar(stat = \"identity\", fill = \"lightblue\") +\n  theme_gray() +\n  labs(title = \"Top 5 Popular Destination Districts (Cars)\", y = \"District\", x = \"Number of Trips\") +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\")\n  )\n\n# Plot for Least 5 Destination Districts\np4 <- ggplot(bottom_5_destination_districts, aes(y = destination_district, x = total_trips)) +\n  geom_bar(stat = \"identity\", fill = \"pink2\") +\n  theme_gray() +\n  labs(title = \"Least 5 Popular Destination Districts (Cars)\", y = \"District\", x = \"Number of Trips\") +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\")\n  )\n\ngrid.arrange(p1, p2, p3, p4, ncol = 2)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-24-1.png){width=960}\n:::\n:::\n\n\n**2) For Motorcycle Drivers**\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n# Filter trips for motorcycles only\nmotorcycle_trips <- trips %>%\n  filter(driving_mode == 'motorcycle')\n\n# Calculate counts for origin districts\norigin_counts <- motorcycle_trips %>%\n  count(origin_district) %>%\n  rename(total_trips = n) %>%\n  arrange(desc(total_trips))\n\n# Get top 5 origin districts\ntop_5_origin_districts <- origin_counts %>%\n  slice_head(n = 5)\n\n# Get least 5 origin districts\nbottom_5_origin_districts <- origin_counts %>%\n  slice_tail(n = 5)\n\n# Set factor levels for top and bottom origin districts\ntop_5_origin_districts$origin_district <- factor(top_5_origin_districts$origin_district, \n                                                  levels = top_5_origin_districts$origin_district)\n\nbottom_5_origin_districts$origin_district <- factor(bottom_5_origin_districts$origin_district, \n                                                     levels = bottom_5_origin_districts$origin_district)\n\n# Plot for Top 5 Origin Districts in descending order\np1 <- ggplot(top_5_origin_districts, aes(y = reorder(origin_district, total_trips), x = total_trips)) +\n  geom_bar(stat = \"identity\", fill = \"lightgreen\") +\n  theme_gray() +\n  labs(title = \"Top 5 Popular Origin Districts (Motorcycles)\", y = \"District\", x = \"Number of Trips\") +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\")\n  )\n\n# Plot for Least 5 Origin Districts\np2 <- ggplot(bottom_5_origin_districts, aes(y = origin_district, x = total_trips)) +\n  geom_bar(stat = \"identity\", fill = \"lightcoral\") +\n  theme_gray() +\n  labs(title = \"Least 5 Popular Origin Districts (Motorcycles)\", y = \"District\", x = \"Number of Trips\") +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\")\n  )\n\n# Calculate counts for destination districts\ndestination_counts <- motorcycle_trips %>%\n  count(destination_district) %>%\n  rename(total_trips = n) %>%\n  arrange(desc(total_trips))\n\n# Get top 5 destination districts\ntop_5_destination_districts <- destination_counts %>%\n  slice_head(n = 5)\n\n# Get least 5 destination districts\nbottom_5_destination_districts <- destination_counts %>%\n  slice_tail(n = 5)\n\n# Set factor levels for top and bottom destination districts\ntop_5_destination_districts$destination_district <- factor(top_5_destination_districts$destination_district, \n                                                             levels = top_5_destination_districts$destination_district)\n\nbottom_5_destination_districts$destination_district <- factor(bottom_5_destination_districts$destination_district, \n                                                               levels = bottom_5_destination_districts$destination_district)\n\n# Plot for Top 5 Destination Districts\np3 <- ggplot(top_5_destination_districts, aes(y = reorder(destination_district, total_trips), x = total_trips)) +\n  geom_bar(stat = \"identity\", fill = \"lightblue\") +\n  theme_gray() +\n  labs(title = \"Top 5 Popular Destination Districts (Motorcycles)\", y = \"District\", x = \"Number of Trips\") +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\")\n  )\n\n# Plot for Least 5 Destination Districts\np4 <- ggplot(bottom_5_destination_districts, aes(y = destination_district, x = total_trips)) +\n  geom_bar(stat = \"identity\", fill = \"pink2\") +\n  theme_gray() +\n  labs(title = \"Least 5 Popular Destination Districts (Motorcycles)\", y = \"District\", x = \"Number of Trips\") +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\")\n  )\n\ngrid.arrange(p1, p2, p3, p4, ncol = 2)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-25-1.png){width=960}\n:::\n:::\n\n\n## 4.2 Temporal Trends\n\n### **4.2.1 Distribution of Trips Throughout the [*Week*]{.underline}**\n\nIt will also be interesting to investigate how the demand for Grab trips changes based on time, in particular by day of week. Here, I counted the number of trips for each day of the week and driving mode by using functions from the `dplyr` package.\n\nWe plot the `geom_bar()` from `ggplot2` package here. We can see that **weekends** have **slightly fewer** number of trips taken than during the **weekdays**. Additionally, the choice between motorcycle or car is almost equal, with a **marginally higher number of motorcycle trips** taken across all days. Out of all days of the week, Thursdays have the highest number of trips taken which coincides with a school and work day, while Sunday which coincides with a rest day showed the least number of trips.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nweekly_trips <- trips %>%\n  group_by(origin_day, driving_mode) %>%\n  summarise(total_trips = n(), .groups = 'drop') %>%\n  arrange(match(origin_day, c(\"monday\", \"tuesday\", \"wednesday\", \"thursday\", \"friday\", \"saturday\", \"sunday\")))\n\nweekly_trips$origin_day <- factor(weekly_trips$origin_day, \n                                   levels = c(\"monday\", \"tuesday\", \"wednesday\", \"thursday\", \"friday\", \"saturday\", \"sunday\"))\n\nggplot(weekly_trips, aes(x = origin_day, y = total_trips, fill = driving_mode)) +\n  geom_bar(stat = \"identity\", position = \"stack\") +  # Stacked bar chart\n  labs(title = \"Number of Trips Throughout the Week by Driving Mode\",\n       x = \"Day of the Week\",\n       y = \"Number of Trips\") +\n  scale_fill_manual(values = c(\"car\" = \"lightblue\", \"motorcycle\" = \"pink2\")) +  # Custom colors\n  theme_gray() +\n  theme(plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\")) +\n  geom_text(aes(label = total_trips), \n            position = position_stack(vjust = 0.5), \n            color = \"black\", \n            size = 4, \n            show.legend = FALSE)  \n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\n\n### **4.2.2 Distribution of number of trips throughout the [*Day*]{.underline}**\n\n**1) By Individual Hours**\n\nBy using the `geom_bar` function, we can plot the count of Grab trips taken for each hour of a day. The peak traffic time appears to be at **10am** while the quietest period is at **7pm** in the evening. We cna also see the the demand for traffic rising from 12am onward which then declines in number of Grab trips past 10am.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhourly_trips <- trips %>%\n  group_by(origin_hour) %>%\n  summarise(number_of_trips = n(), .groups = 'drop') %>%\n  arrange(origin_hour)\n\nhourly_trips$origin_hour <- factor(hourly_trips$origin_hour, \n                                    levels = sort(unique(trips$origin_hour)))\n\nggplot(hourly_trips, aes(x = origin_hour, y = number_of_trips, group = 1)) +  # Set group = 1\n  geom_line(color = \"lightblue3\", linewidth = 1) + \n  geom_point(color = \"lightblue3\", size = 2) + \n  geom_text(aes(label = number_of_trips), vjust = -0.5, color = \"black\", size = 3) +\n  labs(title = \"Distribution of Number of Trips Throughout the Day\",\n       x = \"Hour of the Day\",\n       y = \"Number of Trips\") +\n  theme_gray() +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\"),\n    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis text for readability\n  ) +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n:::\n\n\n**2) By Aggregated Hour Category**\n\nAdditionally, we can also aggregate the `hour_category` column into morning, afternoon, evening and midnight, including whether they are peak or lull periods, as such. This allows for easier interpretability of the data charts.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrips <- trips %>%\n  mutate(hour_category = case_when(\n    origin_hour %in% 1:3 ~ \"midnight_peak\",\n    origin_hour %in% 4:6 ~ \"midnight_lull\",\n    origin_hour %in% 7:9 ~ \"morning_peak\",\n    origin_hour %in% 10:12 ~ \"morning_lull\",\n    origin_hour %in% 13:15 ~ \"afternoon_peak\",\n    origin_hour %in% 16:18 ~ \"afternoon_lull\",\n    origin_hour %in% 19:21 ~ \"evening_peak\",\n    origin_hour %in% c(22:24,0) ~ \"evening_lull\"\n  )) %>%\n  mutate(hour_category = factor(hour_category, \n                                 levels = c(\"midnight_peak\", \"midnight_lull\", \n                                            \"morning_peak\", \"morning_lull\", \n                                            \"afternoon_peak\", \"afternoon_lull\", \n                                            \"evening_peak\", \"evening_lull\")))\n```\n:::\n\n\nAs shown, the **morning peak** hours of 6am to 9am have the **highest number of Grab trips** while the **evening peak** periods of 6pm to 9pm have the least number of trips taken.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhourly_trips <- trips %>% \n  group_by(hour_category) %>% \n  summarise(number_of_trips = n(), .groups = 'drop')\n\nhourly_trips$hour_category <- factor(hourly_trips$hour_category, \n                                     levels = unique(hourly_trips$hour_category))\n\nggplot(hourly_trips, aes(x = hour_category, y = number_of_trips, group = 1)) +\n  geom_line(color = \"lightblue3\", linewidth = 1) + \n  geom_point(color = \"lightblue3\", size = 2) +\n  geom_text(aes(label = number_of_trips), vjust = -0.5, color = \"black\", size = 3.5) +\n  labs(title = \"Distribution of Number of Trips By Hour Category\",\n       x = \"Hour Category\",\n       y = \"Number of Trips\") +\n  theme_gray() +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\"),\n    axis.text.x = element_text(angle = 45, hjust = 1)\n  ) +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-29-1.png){width=672}\n:::\n:::\n\n\n### **4.2.3 Distribution of Trip Duration**\n\n**1) By Time of Day**\n\nSimilar to the distribution of trip distance, by using `geom_violin()` from ggplot2 package, we can visualise the spread of **trip duration (in minutes)** from origin to destination, based on each **hour category**. Here, we randomly sample **2000 trip data** to enable more readability since plotting the entire dataset will result in a chunk of dots that do not offer insights into the spread of trip distance.\n\nAcross each hour category, the total duration spent on Grab journeys tend to be **similar** in their median values. Perhaps, we see the most outliers in trip distances for trips taken during the **morning lull** and **evening lull** where extremely long trip distances are observed.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsampled_trips <- trips %>%\n  sample_n(2000)\n\nggplot(sampled_trips, aes(x = hour_category, y = total_duration_minutes, fill = hour_category)) +\n  geom_violin(trim = FALSE, alpha = 0.6, draw_quantiles = c(\"0.5\")) +\n  geom_jitter(width = 0.2, size = 0.5, alpha = 0.2, color = \"black\") +  \n  labs(title = \"Distribution of Trip Duration (minutes) by Hour Category\",\n       x = \"Hour Category\",\n       y = \"Total Duration (minutes)\") +\n  theme_gray() +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\"),\n    axis.text.x = element_text(angle = 45, hjust = 1)  # Tilt x-axis labels\n  ) +\n  scale_fill_manual(values = c(\"lightblue\", \"lightcoral\", \"lightgreen\", \"lightpink\", \"lightyellow\", \"lightgray\", \"lightcyan\", \"lightgoldenrod\")) +\n  theme(legend.position = \"none\") \n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-30-1.png){width=672}\n:::\n:::\n\n\nWhen I remove outliers in `total_duration_minutes` that fall below Q1 - 1.5 \\* IQR or above Q3 + 1.5 \\* IQR, we can once again observe that the median duration taken is the same across all time of day.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate IQR and filter outliers in total_duration_minutes\nfiltered_trips <- trips %>%\n  filter(between(total_duration_minutes, \n                 quantile(total_duration_minutes, 0.25) - 1.5 * IQR(total_duration_minutes), \n                 quantile(total_duration_minutes, 0.75) + 1.5 * IQR(total_duration_minutes))) %>%\n  sample_n(2000)\n\n# Plot without outliers\nggplot(filtered_trips, aes(x = hour_category, y = total_duration_minutes, fill = hour_category)) +\n  geom_violin(trim = FALSE, alpha = 0.6, draw_quantiles = c(\"0.5\")) +\n  geom_jitter(width = 0.2, size = 0.5, alpha = 0.2, color = \"black\") +  \n  labs(title = \"Distribution of Trip Duration (minutes) by Hour Category - No Outliers\",\n       x = \"Hour Category\",\n       y = \"Total Duration (minutes)\") +\n  theme_gray() +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\"),\n    axis.text.x = element_text(angle = 45, hjust = 1)  # Tilt x-axis labels\n  ) +\n  scale_fill_manual(values = c(\"lightblue\", \"lightcoral\", \"lightgreen\", \"lightpink\", \"lightyellow\", \"lightgray\", \"lightcyan\", \"lightgoldenrod\")) +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-31-1.png){width=672}\n:::\n:::\n\n\n**2) By Day of Week**\n\nIn terms of day of the week, **Mondays, Tuesdays** and **Wednesdays** tend to have a slightly shorter trip duration than the rest of the days of the week.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Sample 2000 trips\nsampled_trips <- trips %>%\n  sample_n(2000)\n\n# Reorder origin_day as a factor with levels from Monday to Sunday\nsampled_trips$origin_day <- factor(sampled_trips$origin_day, \n                                    levels = c(\"monday\", \"tuesday\", \"wednesday\", \"thursday\", \"friday\", \"saturday\", \"sunday\"))\n\n# Create the violin plot\nggplot(sampled_trips, aes(x = origin_day, y = total_duration_minutes, fill = origin_day)) +\n  geom_violin(trim = FALSE, alpha = 0.6, draw_quantiles = c(\"0.5\")) +\n  geom_jitter(width = 0.2, size = 0.5, alpha = 0.2, color = \"black\") +  \n  labs(title = \"Distribution of Trip Duration (minutes) by Day of Week\",\n       x = \"Day of Week\",\n       y = \"Trip Duration (minutes)\") +\n  theme_gray() +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\"),\n    axis.text.x = element_text(angle = 45, hjust = 1)  # Tilt x-axis labels\n  ) +\n  scale_fill_manual(values = c(\"lightblue\", \"lightcoral\", \"lightgreen\", \"lightpink\", \"lightyellow\", \"lightgray\", \"lightcyan\")) +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-32-1.png){width=672}\n:::\n:::\n\n\nWe have a clearer view of the spread of trip duration when we remove all outliers. We can see that trips taken on **Wednesday** tend to be shorter journeys than other days of the week.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Remove outliers based on IQR and then sample 2000 trips\nfiltered_trips <- trips %>%\n  filter(between(total_duration_minutes, \n                 quantile(total_duration_minutes, 0.25) - 1.5 * IQR(total_duration_minutes), \n                 quantile(total_duration_minutes, 0.75) + 1.5 * IQR(total_duration_minutes))) %>%\n  sample_n(2000)\n\n# Reorder origin_day as a factor with levels from Monday to Sunday\nfiltered_trips$origin_day <- factor(filtered_trips$origin_day, \n                                    levels = c(\"monday\", \"tuesday\", \"wednesday\", \"thursday\", \"friday\", \"saturday\", \"sunday\"))\n\n# Create the violin plot without outliers\nggplot(filtered_trips, aes(x = origin_day, y = total_duration_minutes, fill = origin_day)) +\n  geom_violin(trim = FALSE, alpha = 0.6, draw_quantiles = c(\"0.5\")) +\n  geom_jitter(width = 0.2, size = 0.5, alpha = 0.2, color = \"black\") +  \n  labs(title = \"Distribution of Trip Duration (minutes) by Day of Week - No Outliers\",\n       x = \"Day of Week\",\n       y = \"Trip Duration (minutes)\") +\n  theme_gray() +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\"),\n    axis.text.x = element_text(angle = 45, hjust = 1)  # Tilt x-axis labels\n  ) +\n  scale_fill_manual(values = c(\"lightblue\", \"lightcoral\", \"lightgreen\", \"lightpink\", \"lightyellow\", \"lightgray\", \"lightcyan\")) +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-33-1.png){width=672}\n:::\n:::\n\n\n**3) By Driving Mode**\n\nWe can also use the `driving_mode` column of the **trips** data to plot the distribution of trip duration. We can see that **motorcycles** are slighty more preferred for **shorter trip duration** than cars,though cars are almost equally as demanded. In terms of longer journeys which involve more minutes, taking the **car** is more preferred as a mode of driving.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(trips, aes(x = total_duration_minutes, fill = driving_mode)) +\n  geom_density(alpha = 0.8) +\n  labs(title = \"Trip Duration (minutes) by Driving Mode (All Trips)\",\n       x = \"Total Duration (minutes)\",\n       y = \"Density\") +\n  theme_gray() +\n  theme(plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\")) +\n  scale_fill_manual(values = c(\"lightblue\", \"pink2\"))\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-34-1.png){width=672}\n:::\n:::\n\n\nWe can also observe the distribution of trip duration **within Jakarta only**, meaning we filter out all origin and destinations that are discovered to be outside of Jakarta. Likewise, **cars** are slightly more preferred than **motorcycles** for longer trip duration.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(trips_inside_jakarta, aes(x = total_duration_minutes, fill = driving_mode)) +\n  geom_density(alpha = 0.8) +\n  labs(title = \"Trip Duration (minutes) by Driving Mode (Within Jakarta)\",\n       x = \"Total Duration (minutes)\",\n       y = \"Density\") +\n  theme_gray() +\n  theme(plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\")) +\n  scale_fill_manual(values = c(\"lightblue\", \"pink2\"))\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-35-1.png){width=672}\n:::\n:::\n\n\n### **4.2.4 Distribution of Trip Distance**\n\n**1) By Time of Day**\n\nAgain, we randomly sample 2000 trip data to plot the violin plot of `total_distance_km` against hour categories. We can observe that longer distances are traveled during the **afternoon lull** and **evening peak** periods on average which could be attributed to high traffic volumes or jams on the road.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsampled_trips <- trips %>%\n  sample_n(2000)\n\nggplot(sampled_trips, aes(x = hour_category, y = total_distance_km, fill = hour_category)) +\n  geom_violin(trim = FALSE, alpha = 0.6, draw_quantiles = \"0.5\") +\n  geom_jitter(width = 0.2, size = 0.5, alpha = 0.2, color = \"black\") +  \n  labs(title = \"Distribution of Trip Distance (km) by Hour Category\",\n       x = \"Hour Category\",\n       y = \"Total Distance (km)\") +\n  theme_gray() +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\"),\n    axis.text.x = element_text(angle = 45, hjust = 1)  # Tilt x-axis labels\n  ) +\n  scale_fill_manual(values = c(\"lightblue\", \"lightcoral\", \"lightgreen\", \"lightpink\", \"lightyellow\", \"lightgray\", \"lightcyan\", \"lightgoldenrod\")) +\n  theme(legend.position = \"none\") \n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-36-1.png){width=672}\n:::\n:::\n\n\n**2) By Day of Week**\n\nThe chart suggests that trips taken on **Saturday** and **Sunday** have the highest average distance travelled, meaning that people are more willing to travel to destinations further away from where they stay on these days.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(dplyr)\n\n# Sample 2000 trips\nsampled_trips <- trips %>%\n  sample_n(2000)\n\n# Reorder origin_day as a factor with levels from Monday to Sunday\nsampled_trips$origin_day <- factor(sampled_trips$origin_day, \n                                    levels = c(\"monday\", \"tuesday\", \"wednesday\", \"thursday\", \"friday\", \"saturday\", \"sunday\"))\n\n# Create the violin plot\nggplot(sampled_trips, aes(x = origin_day, y = total_distance_km, fill = origin_day)) +\n  geom_violin(trim = FALSE, alpha = 0.6, draw_quantiles = \"0.5\") +\n  geom_jitter(width = 0.2, size = 0.5, alpha = 0.2, color = \"black\") +  \n  labs(title = \"Distribution of Trip Distance (km) by Day of Week\",\n       x = \"Day of Week\",\n       y = \"Total Distance (km)\") +\n  theme_gray() +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\"),\n    axis.text.x = element_text(angle = 45, hjust = 1)  # Tilt x-axis labels\n  ) +\n  scale_fill_manual(values = c(\"lightblue\", \"lightcoral\", \"lightgreen\", \"lightpink\", \"lightyellow\", \"lightgray\", \"lightcyan\")) +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-37-1.png){width=672}\n:::\n:::\n\n\n### 4.2.5 Day of Week and Hourly Patterns in Ride-hailing Demand\n\nNow, let's generate a **heatmap** displaying the distribution of trips across different **days of the week** (using the `origin_day` column) and the specified **hour categories**, with the fill color indicating the **number of trips**. The days are ordered from Monday to Sunday, making it easier to interpret the data.\n\nWe can observe the **highest number of trips** taken during both morning peak and lull periods on Thursdays, as well as, Saturday midnight lull periods. On the other hand, Monday and Tuesday evening peaks have the **lowest number of trips**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a new summary data frame using hour_category\nheatmap_data <- trips %>%\n  group_by(origin_day, hour_category) %>%\n  summarise(number_of_trips = n(), .groups = 'drop') %>%\n  arrange(origin_day, hour_category)\n\n# Convert origin_day to a factor with specific order\nheatmap_data$origin_day <- factor(heatmap_data$origin_day, \n                                   levels = c(\"monday\", \"tuesday\", \"wednesday\", \"thursday\",\n                                              \"friday\", \"saturday\", \"sunday\"))\n\n# Convert hour_category to a factor for better ordering\nheatmap_data$hour_category <- factor(heatmap_data$hour_category, \n                                      levels = c(\"midnight_peak\", \"midnight_lull\", \n                                                 \"morning_peak\", \"morning_lull\", \n                                                 \"afternoon_peak\", \"afternoon_lull\", \n                                                 \"evening_peak\", \"evening_lull\")) \n\n# Create the heatmap\nggplot(heatmap_data, aes(x = hour_category, y = origin_day)) +\n  geom_tile(aes(fill = number_of_trips), color = \"white\") +\n  geom_text(aes(label = number_of_trips), color = \"black\", size = 4) +\n  scale_fill_gradient(low = \"lightblue\", high = \"darkblue\", name = \"Number of Trips\") +\n  labs(title = \"Heatmap of Number of Trips by Day and Hour Category\",\n       x = \"Hour Category\",\n       y = \"Day\") +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 16, face = \"bold\"),\n    axis.text.x = element_text(angle = 45, hjust = 1) \n  )\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-38-1.png){width=960}\n:::\n:::\n\n\n## 4.3 Impact of Weather\n\n### **4.3.1 How does the volume of trips change with weather conditions (rain vs. no rain)?**\n\n-   **Plot/Graph: Boxplot comparing rainy vs. non-rainy days**\n\n-   **Analysis/Conclusion: Understand how adverse weather affects overall trip volume. This can reveal if people use ride-hailing more or less in different weather conditions.**\n\n### **4.3.2 Do weather conditions affect trip demand differently for motorbikes vs. cars?**\n\n-   **Plot/Graph: Side-by-side boxplots for cars and motorbikes**\n\n-   **Analysis/Conclusion: Analyze how weather influences the use of motorbikes versus cars. Motorbike demand may drop significantly during rain.**\n\n## 4.4 Point of Interest (POI) Analysis\n\n### **4.4.1 Distribution of POIs Across Districts**\n\nWe can visualise the distribution of POIs across each district using the `district_dest` augmented dataframe we created previously. With that said, we can observe that the top three highest number POIs are found in the districts Kebayoran Baru, Setia Budi and Grogol Petamburan.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot the distribution of POIs across districts\nggplot(district_dest, aes(x = reorder(district, num_of_pois), y = num_of_pois)) +\n  geom_bar(stat = \"identity\", fill = \"lightblue3\") +\n  labs(title = \"Distribution of POIs Across Districts\",\n       x = \"District\",\n       y = \"Number of POIs\") +\n  theme_gray() +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\"),\n    axis.text.x = element_text(angle = 45, hjust = 1)\n  )\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-39-1.png){width=672}\n:::\n:::\n\n\nNext, let us use the `pois_num` dataframe created earlier. I will plot a heatmap plot using the `geom_tile()` function of the **ggplot2** package to understand how the number of trips demanded vary by district and POI category. We can evidently see that districts like ***Danau Sunter*** have **low to no POIs**, with only **essentials** (e.g. clinics, veteranarians) found in the district. However, in districts that may be more populated or urbanised, we see a higher number of POIs for the **office businesses, restaurants and food, and shops** as marked by the darker shades of blue below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Count the number of POIs by district\npois_num_cat <- pois %>%\n  st_drop_geometry() %>%\n  group_by(district, category) %>%\n  summarise(num_of_pois = n(), .groups = 'drop')\n\nheatmap_plot <- ggplot(pois_num_cat, aes(x = category, y = district, fill = num_of_pois)) +\n  geom_tile(color = \"white\") +\n  scale_fill_gradient(low = \"lightblue\", high = \"darkblue\") +\n  labs(\n    title = \"Heatmap of Points of Interest by District and Category\",\n    x = \"POI Category\",\n    y = \"District\",\n    fill = \"Number of POIs\"\n  ) +\n  theme_minimal() + # Clean theme\n  theme(\n    axis.text.x = element_text(angle = 45, hjust = 1),\n    plot.title = element_text(hjust = 0.5, size = 16, face = \"bold\") \n  )\n\nprint(heatmap_plot)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-40-1.png){width=960}\n:::\n:::\n\n\n### **4.4.2 Demand of Ride-hailing Services by POI**\n\nTo prepare the dataset for the analysis involving POIs, I will augment the `jakarta_pois.rds` dataset by aggregating the trips data from the `trips` simple dataframe. Restaurants, office businesses and shops seem to dominate the POIs available in Jakarta, while cultural attractions and recreation entertainment suggests to be less available.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncategory_counts <- pois %>%\n  group_by(category) %>%\n  summarise(num_of_pois = n()) %>%\n  arrange(desc(num_of_pois))\n\nggplot(category_counts, aes(x = reorder(category, -num_of_pois), y = num_of_pois, fill = num_of_pois)) +\n  geom_bar(stat = \"identity\") +\n  geom_text(aes(label = num_of_pois), vjust = -0.5, size = 4) +\n  labs(\n    title = \"Distribution of POIs Across Jakarta\",\n    x = \"Category\",\n    y = \"Number of POIs\"\n  ) +\n  theme_gray() +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 16, face = \"bold\"),\n    axis.text.x = element_text(angle = 45, hjust = 1, color = \"grey30\"),\n    legend.position = \"none\"\n  ) +\n  scale_fill_gradient(low = \"lightblue\", high = \"darkblue\") \n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-41-1.png){width=960}\n:::\n:::\n\n\nWe can also plot the number of POIs discovered across each POI category type by using a radar chart. Here, I am employing the **`radarchart()`** function of the **fmsb** package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncategory_counts <- pois %>%\n  group_by(category) %>%\n  summarise(num_of_pois = n()) %>%\n  arrange(desc(num_of_pois))\n\nmax_value <- max(category_counts$num_of_pois)\nmin_value <- 0\n\nradar_data <- rbind(\n  rep(max_value, nrow(category_counts)),\n  rep(min_value, nrow(category_counts)),\n  t(category_counts$num_of_pois)\n)\n\nradar_data <- as.data.frame(radar_data)\ncolnames(radar_data) <- category_counts$category\n\nradarchart(\n  radar_data,\n  axistype = 1,\n  pcol = rgb(0.2, 0.4, 0.4, 0.6),  # Line color\n  pfcol = rgb(0.2, 0.2, 0.2, 0.2),  # Fill color\n  plwd = 2,  # Line width\n  cglcol = \"lightblue3\",  # Grid line color\n  cglty = 1,  # Grid line type\n  axislabcol = \"black\",  # Axis label color\n  caxislabels = seq(0, max_value, length.out = 5),  # Axis labels\n  cglwd = 1.2,  # Grid line width\n  vlcex = 1  # Category label size\n)\n\ntitle(\"Distribution of POIs Across Jakarta\", cex.main = 1.4)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-42-1.png){width=960}\n:::\n:::\n\n\nNext, I will go deeper into finding out how many Grab trips were taken to these destinations at the district level. It can be observed that a l**arger number of POIs** **(pink)** within a district lead to similarly **higher number of Grab trips taken (blue)** to the district.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Reshape the data for plotting\ndistrict_long <- district_dest %>%\n  pivot_longer(cols = c(num_of_trips, num_of_pois), \n               names_to = \"metric\", \n               values_to = \"count\")\n\n# Plot the line charts\nggplot(district_long, aes(x = district, y = count, group = metric, color = metric)) +\n  geom_line(linewidth = 1) +\n  geom_point(size = 2) +\n  labs(\n    title = \"Trends in Number of Trips and Availability of POIs by District\",\n    x = \"District\",\n    y = \"Number of Trips\",\n    color = \"Metric\"\n  ) +\n  scale_color_manual(values = c(\"num_of_trips\" = \"lightblue3\", \"num_of_pois\" = \"pink3\")) + \n  theme_gray() +\n  theme(\n    axis.text.x = element_text(angle = 45, hjust = 1),\n    plot.title = element_text(size = 16, hjust = 0.5, face = \"bold\")\n  )\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-43-1.png){width=960}\n:::\n:::\n\n\nThe scatterplot below indicates that **more Grab trips** are taken for **smaller average distances travelled** from the passenger's origin, suggesting most trips are **bounded within shorter distances**. This is surprising since I would have assumed a higher demand for Grab services for when the destination is far from the passenger's origin.\n\nIn addition, we can also observe that destinations with a **higher number of POI** **(darker shades of blue)** tend to result in **more Grab trips** taken. This means that passengers are more likely to take a trip to districts in Jakarta that offer **more POIs.**\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndistrict_pois_5 <- district_dest %>%\n  mutate(pois_category = cut(num_of_pois, \n                              breaks = 5, \n                              labels = c(\"100\", \"200\", \"300\", \"400\", \"500\"), \n                              include.lowest = TRUE))\n\ncolor_palette <- c(\"100\" = \"#A3C6E4\",   # Light blue\n                   \"200\" = \"#76A4D6\",      # Medium light blue\n                   \"300\" = \"#4A83C6\",   # Medium blue\n                   \"400\" = \"#1F5DA0\",     # Dark blue\n                   \"500\" = \"#003C71\") # Darker blue\n\nggplot(district_pois_5, aes(x = num_of_trips, y = avg_distance_km, size = num_of_pois, color = pois_category)) +\n  geom_point(alpha = 0.7) +\n  labs(\n    title = \"Correlation of Number of Trips and Average Distance by Number of POIs\",\n    x = \"Number of Trips\",\n    y = \"Average Distance (km)\",\n    size = \"Number of POIs\",\n    color = \"Number of POIs\"  # Renamed here\n  ) +\n  scale_size(range = c(1, 6)) +  # Adjust point size range\n  scale_color_manual(values = color_palette) +  # Apply custom color palette\n  theme_gray() +\n  theme(\n    plot.title = element_text(size = 16, hjust = 0.5, face = \"bold\"),\n    legend.position = \"right\"\n  )\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-44-1.png){width=960}\n:::\n:::\n\n\n### **4.4.3 Correlation of Number of Trips and POIs**\n\nWe can observe a **positive correlation** between the number of trips taken to a destination and the availability of POIs in the destination district based on the linear regression model below. This means that more trips are demanded to the destination when there are more POIs available, typically these districts might be within the city with more amenities for people to eat, shop and work.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load required libraries\nlibrary(dplyr)\nlibrary(ggplot2)\n\n# Calculate the correlation coefficient\ncorrelation_result <- cor(district_dest$num_of_trips, district_dest$num_of_pois)\n\n# Create a scatter plot with a regression line\nggplot(district_dest, aes(x = num_of_pois, y = num_of_trips)) +\n  geom_point(color = \"blue\", size = 3, alpha = 0.6) +  # Points\n  geom_smooth(method = \"lm\", se = TRUE, color = \"red\") +  # Linear regression line\n  labs(\n    title = \"Correlation between Number of Trips and Number of POIs\",\n    x = \"Number of POIs\",\n    y = \"Number of Trips\"\n  ) +\n  theme_gray() +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 16, face = \"bold\")\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-45-1.png){width=960}\n:::\n\n```{.r .cell-code}\n# Print the correlation result\nprint(paste(\"Correlation between Number of Trips and Number of POIs:\", round(correlation_result, 2)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Correlation between Number of Trips and Number of POIs: 0.8\"\n```\n\n\n:::\n:::\n\n\nBy including the average distance traveled, we can see that **fewer passengers** tend to take ride-hailing services like Grab for when the **average distance of trips are shorter.** For district destinations with higher number of POIs available, trip distances tend to be **shorter** too, which could mean that passengers likely **reside near to these POIs**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndistrict_dist_6 <- district_dest %>%\n  mutate(distance_category = cut(avg_distance_km, \n                                  breaks = 6, \n                                  labels = c(\"5.0\", \"5.5\", \"6.0\", \"6.5\", \"7.0\", \"7.5\"), \n                                  include.lowest = TRUE))\n\ndistance_color_palette <- c(\"5.0\" = \"#A3C6E4\",   # Light blue\n                             \"5.5\" = \"#76A4D6\",   # Medium light blue\n                             \"6.0\" = \"#4A83C6\",   # Medium blue\n                             \"6.5\" = \"#1F5DA0\",   # Dark blue\n                             \"7.0\" = \"#003C71\",   # Darker blue\n                             \"7.5\" = \"midnightblue\")  # Deepest blue\n\ndistrict_dist_6 <- district_dist_6 %>%\n  mutate(distance_category = factor(distance_category))\n\nggplot(district_dist_6, aes(x = num_of_trips, y = num_of_pois)) +\n  geom_point(aes(color = distance_category, size = distance_category), alpha = 0.7) + \n  labs(\n    title = \"Relationship between Number of Trips and Number of POIs by Average Distance\",\n    x = \"Number of Trips\",\n    y = \"Number of POIs\",\n    size = \"Average Distance Category (km)\",  \n    color = \"Average Distance Category (km)\"  \n  ) +\n  scale_size_manual(values = c(1, 2, 3, 4, 5, 6)) +  \n  scale_color_manual(values = distance_color_palette) + \n  theme_gray() +\n  theme(\n    plot.title = element_text(size = 16, hjust = 0.5, face = \"bold\"),\n    axis.title = element_text(size = 12),\n    legend.position = \"right\"\n  )\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-46-1.png){width=960}\n:::\n:::\n\n\n### **4.4.3 Traffic Volumes By Time of Day and POI Type**\n\nNext, i will want to understand traffic volumes by Hour Category and POI Category. Before that, I will create a new dataframe `district_hour_pois` to aggregate the 8 hour categories into 4 instead, namely morning, afternoon, evening and midnight.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n# Define time-of-day categories based on hour_category labels\ntrips_num <- trips %>%\n  group_by(destination_district, hour_category) %>%\n  summarise(num_of_trips = n(), .groups = 'drop') %>%\n  rename(district = destination_district) %>%\n  mutate(\n    district = tolower(district),\n    # Group hour_category into broader time-of-day groups\n    time_of_day = case_when(\n      hour_category %in% c(\"morning_peak\", \"morning_lull\") ~ \"morning\",\n      hour_category %in% c(\"afternoon_peak\", \"afternoon_lull\") ~ \"afternoon\",\n      hour_category %in% c(\"evening_peak\", \"evening_lull\") ~ \"evening\",\n      hour_category %in% c(\"midnight_peak\", \"midnight_lull\") ~ \"midnight\",\n      TRUE ~ \"other\"\n    ),\n    # Set specific ordering for time_of_day\n    time_of_day = factor(time_of_day, levels = c(\"morning\", \"afternoon\", \"evening\", \"midnight\"))\n  ) %>%\n  # Group by district and new time_of_day categories, summing num_of_trips\n  group_by(district, time_of_day) %>%\n  summarise(num_of_trips = sum(num_of_trips), .groups = 'drop')\n\n# Count the number of POIs by district & category\npois_num_cat <- pois %>%\n  st_drop_geometry() %>%\n  group_by(district, category) %>%\n  summarise(num_of_pois = n(), .groups = 'drop')\n\n# Combine the two datasets by district\ndistrict_hour_pois <- trips_num %>%\n  inner_join(pois_num_cat, by = \"district\", relationship = \"many-to-many\") %>%\n  arrange(district, time_of_day)\n\n# View the combined dataset\nhead(district_hour_pois)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 5\n  district time_of_day num_of_trips category                 num_of_pois\n  <chr>    <fct>              <int> <chr>                          <int>\n1 cakung   morning              357 Cultural_Attractions               1\n2 cakung   morning              357 Essentials                        12\n3 cakung   morning              357 Facilities_Services               16\n4 cakung   morning              357 Offices_Business                  18\n5 cakung   morning              357 Recreation_Entertainment           2\n6 cakung   morning              357 Restaurants_Food                   3\n```\n\n\n:::\n:::\n\n\nAcross all POI types, districts offering **restaurants** and **shops** tend to garner the **highest demand** for Grab services. In constrast, **recreation entertainment** showed to be **least demanded** by Grab users.\n\n-   In the **morning**, Grab services are most demanded to destinations that offer **facilities services, shops and essentials**, where commuters are likely headed to work or settle household errands. This trend can also be observed in the **afternoon**.\n\n-   When it comes to **evening** time, the number of trips taken to **restaurants** are seen to rise likely since commuters are done with the day and are headed for dinner. It is also surprising that Grab transport are also **highly active during midnight (12am - 6pm)**, namely where destinations are facilities services, shops and restaurants. This could be due to commuters ending work late or heading out for work in the early morning.\n\n\n::: {.cell}\n\n```{.r .cell-code}\naggregated_pois <- district_hour_pois %>%\n  group_by(category, time_of_day) %>%\n  summarise(num_of_trips = sum(num_of_trips, na.rm = TRUE), .groups = \"drop\")  \n\nggplot(aggregated_pois, aes(x = category, y = num_of_trips, fill = time_of_day)) +\n  geom_bar(stat = \"identity\") + \n  geom_text(aes(label = num_of_trips), \n            position = position_stack(vjust = 0.5),  \n            color = \"black\", \n            size = 3.5) +\n  labs(\n    title = \"Number of POIs Visited Using Grab by Time of Day\",\n    x = \"POI Category\",\n    y = \"Number of POIs\"\n  ) +\n  theme_gray() +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 16, face = \"bold\"), \n    axis.text.x = element_text(angle = 45, hjust = 1)\n  ) + \n  scale_fill_brewer(palette = \"Blues\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-48-1.png){width=960}\n:::\n:::\n\n\n# 5. Exploratory Spatial Data Analysis (ESDA)\n\n## **5.1 Spatial Distribution of Ride-Hailing Traffic**\n\n### **5.1.1 What is the spatial distribution of trips originating from different districts across Jakarta?**\n\n-   **Plot/Graph: Choropleth map**\n\n-   **Analysis/Conclusion: Observe areas of high and low trip origins. These insights can help in identifying underserved regions or overly concentrated areas.**\n\n### **5.1.2 How do origin-destination flows vary spatially across the city (e.g., desire lines or flow maps)?**\n\n-   **Plot/Graph: Desire line map (spatial flow map)**\n\n-   **Analysis/Conclusion: Highlight major commuting or movement corridors. High flow between districts suggests popular commuting routes.**\n\n### **5.1.3 Are there specific clusters of high ride-hailing demand that form around particular locations (e.g., central business districts, residential areas)?**\n\n-   **Plot/Graph: Kernel density map**\n\n-   **Analysis/Conclusion: Detect spatial clusters of high demand. Business districts might be heavy traffic zones during office hours.**\n\n## **5.2 Spatial Correlation & Hotspot Detection**\n\n### **5.2.1 Are there spatial patterns or clusters of high ride-hailing traffic (using techniques like spatial autocorrelation or hotspot analysis)?**\n\n-   **Plot/Graph: Hotspot map or Moran’s I for spatial autocorrelation**\n\n-   **Analysis/Conclusion: Identify areas where traffic demand is spatially concentrated. Hotspots can inform traffic management strategies.**\n\n### **5.2.2 Where are the spatial hotspots of traffic congestion or high demand for rides?**\n\n-   **Plot/Graph: Heatmap or kernel density map**\n\n-   **Analysis/Conclusion: Analyze where demand is so high that congestion becomes an issue. Look for recurring patterns to adjust traffic flow or driver distribution.**\n\n## **5.3 Spatial Relationships with Points of Interest**\n\n### **5.3.1 How does the distance from key POIs (e.g., schools, hospitals, malls, offices) impact ride-hailing traffic patterns in surrounding districts?**\n\n-   **Plot/Graph: Bubble map with distance from POIs**\n\n-   **Analysis/Conclusion: Correlate traffic density with proximity to POIs. Shorter distances from key locations might lead to higher demand.**\n\n### **5.3.2 Are there spatial relationships between POIs and the volume of trips originating or terminating nearby?**\n\n-   **Plot/Graph: Heatmap for POIs vs. trip volumes**\n\n-   **Analysis/Conclusion: Understand how certain POIs contribute to trip volume. This is important for prioritizing service areas.**\n\n## **5.4 Impact of Weather on Spatial Patterns**\n\n### **5.4.1 How does rainy weather influence spatial traffic patterns? Do people travel more or less between certain districts during rain?**\n\n-   **Plot/Graph: Comparative maps for rainy vs. non-rainy days**\n\n-   **Analysis/Conclusion: Compare spatial flows under different weather conditions. Some areas may see drops in traffic due to adverse weather.**\n\n## **5.5 Origin-Destination Spatial Flows**\n\nNext, we can also delve into the spatial flows between origin and destination districts. To do so, I will leverage the `geom_alluviam()` function of the **ggplot2** and **ggalluvial** packages to map the flows. I will also ientify the top 5 origin / destination districts by doing a filter() on the data as shown.\n\n### **5.5.1 Flow from All Origins to Top 5 Destinations**\n\nWe can see how complex the spread of origin districts are, where a thicker line connecting the origin and destination resembles a higher demand for Grab. In this case, we can see tha trips taken **outside of Jakarta** into the district of **Kebayoran Lama** are the highest. Likewise, Grab trips moving from **Kebayoran Lama** to **outside of Jakarta** are the highest.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Identify the top 5 destination districts\ntop_5_destinations <- trips %>%\n  count(destination_district) %>%\n  top_n(5, wt = n) %>%\n  pull(destination_district)\n\n# Filter the data to include only top 5 destinations\nflow_data <- trips %>%\n  filter(destination_district %in% top_5_destinations) %>%\n  count(origin_district, destination_district) %>%\n  rename(count = n)\n\n# Plot the alluvial diagram\nggplot(flow_data, aes(axis1 = origin_district, axis2 = destination_district, y = count)) +\n  geom_alluvium(aes(fill = destination_district)) +\n  geom_stratum() +\n  geom_text(stat = \"stratum\", aes(label = after_stat(stratum))) +\n  labs(title = \"Flow from Origin to Top 5 Destination Districts\", \n       x = \"Districts\", \n       y = \"Number of Trips\") +\n  theme_minimal() +\n  theme(plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\"))\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-49-1.png){width=960}\n:::\n:::\n\n\n### **5.5.2 Flow Pattern from Top 5 Origins to All Destinations**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Identify the top 5 origin districts based on the number of trips\ntop_5_origins <- trips %>%\n  count(origin_district) %>%\n  top_n(5, wt = n) %>%\n  pull(origin_district)\n\n# Filter the data to include only top 5 origins and their corresponding destination districts\nflow_data <- trips %>%\n  filter(origin_district %in% top_5_origins) %>%\n  count(origin_district, destination_district) %>%\n  rename(count = n)\n\n# Plot the alluvial diagram\nggplot(flow_data, aes(axis1 = origin_district, axis2 = destination_district, y = count)) +\n  geom_alluvium(aes(fill = origin_district)) +  # Use origin_district for fill\n  geom_stratum() +\n  geom_text(stat = \"stratum\", aes(label = after_stat(stratum)), size = 4) +\n  labs(title = \"Flow from Top 5 Origin Districts to Destination Districts\", \n       x = \"Districts\", \n       y = \"Number of Trips\") +\n  theme_minimal() +\n  theme(plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\"),\n        axis.text.x = element_text(angle = 45, hjust = 1))  # Tilt x-axis labels for better readability\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-50-1.png){width=960}\n:::\n:::\n\n\n### **5.5.3 Flow Patterns from Top 5 Origins to Top 5 Destinations**\n\nI believe we can make the most meaningful analysis when just looking at the **top 5 originating** and **top** **5 destination** districts where these districts had the highest number of Grab trips taken. We can observe that Setia Budi is a popular origin and destination for Grab services, in fact, many of the trips are found **within the district** itself.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Step 1: Identify the top 5 origin districts\ntop_5_origins <- trips %>%\n  count(origin_district) %>%\n  top_n(5, wt = n) %>%\n  pull(origin_district)\n\n# Step 2: Identify the top 5 destination districts\ntop_5_destinations <- trips %>%\n  count(destination_district) %>%\n  top_n(5, wt = n) %>%\n  pull(destination_district)\n\n# Step 3: Filter the trips data for top districts only\nflow_data <- trips %>%\n  filter(origin_district %in% top_5_origins & destination_district %in% top_5_destinations) %>%\n  count(origin_district, destination_district) %>%\n  rename(count = n)\n\n# Step 4: Create a new column to distinguish origins and destinations\nflow_data <- flow_data %>%\n  mutate(district_type = ifelse(origin_district %in% top_5_origins, \"Origin\", \"Destination\"))\n\n# Step 5: Plot the alluvial diagram\nggplot(flow_data, aes(axis1 = origin_district, axis2 = destination_district, y = count)) +\n  geom_alluvium(aes(fill = origin_district)) + \n  geom_stratum() +\n  geom_text(stat = \"stratum\", aes(label = after_stat(stratum)), size = 4, color = \"black\") +\n  labs(title = \"Flow of Trips Between Top 5 Origin and Top 5 Destination Districts in Jakarta\", \n       x = \"Districts\", \n       y = \"Number of Trips\") +\n  theme_minimal() +\n  theme(plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\"),\n        axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-51-1.png){width=960}\n:::\n:::\n\n\n## **What are the major spatial flow patterns (origin to destination) across different districts in Jakarta?**\n\n-   **Plot/Graph: Flow map or desire line map**\n\n-   **Analysis/Conclusion: Analyze directional flows to understand commuter or travel behavior between regions.**\n\n## **6.3 Do spatial flow patterns change depending on the vehicle type or time of day?**\n\n-   **Plot/Graph: Comparative flow maps for motorbikes and cars**\n\n-   **Analysis/Conclusion: Identify different flow patterns for vehicle types, potentially revealing different uses of motorbikes versus cars.**\n",
    "supporting": [
      "Take-home_Ex3_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}